DROP TABLE EGWTR_CONNECTION CASCADE;
DROP SEQUENCE SEQ_EGWTR_CONNECTION;
DROP TABLE EGWTR_CONNECTIONDETAILS CASCADE;
DROP SEQUENCE SEQ_EGWTR_CONNECTIONDETAILS;

CREATE TABLE EGWTR_CONNECTION
(
	ID			bigint NOT NULL,
	MOBILENUMBER		integer,
	CONSUMERCODE		character varying(50),
	PROPERTYIDENTIFIER	character varying(50),
	BPAIDENTIFIER		character varying(50),
	METERNUMBER		character varying(50),
	METER			bigint,
	PARENTCONNECTION	bigint,
	CREATEDBY		bigint NOT NULL,
	CREATEDDATE     	timestamp without time zone NOT NULL,
	LASTMODIFIEDDATE	timestamp without time zone NOT NULL,
	LASTMODIFIEDBY		bigint NOT NULL,
	VERSION			numeric NOT NULL
);
COMMENT ON COLUMN EGWTR_CONNECTION.CONSUMERCODE IS 'Nullable, as the consumer code will be generated upon approval of application';
COMMENT ON COLUMN EGWTR_CONNECTION.PARENTCONNECTION IS 'Applicable only for additional connection application';
ALTER TABLE EGWTR_CONNECTION ADD CONSTRAINT PK_CONNECTION PRIMARY KEY (ID);
ALTER TABLE EGWTR_CONNECTION ADD CONSTRAINT FK_CONNECTION_ADDITIONAL FOREIGN KEY (PARENTCONNECTION) REFERENCES EGWTR_CONNECTION (ID);
ALTER TABLE EGWTR_CONNECTION ADD CONSTRAINT FK_CONNECTION_METER FOREIGN KEY (METER) REFERENCES EGWTR_METERCOST (ID);
ALTER TABLE EGWTR_CONNECTION ADD CONSTRAINT FK_CONNECTION_CREATEDBY FOREIGN KEY (CREATEDBY) REFERENCES EG_USER (ID);
ALTER TABLE EGWTR_CONNECTION ADD CONSTRAINT FK_CONNECTION_LASTMODIFIEDBY FOREIGN KEY (LASTMODIFIEDBY) REFERENCES EG_USER (ID);
CREATE INDEX IDX_CONNECTION_CONSUMERCODE ON EGWTR_CONNECTION USING BTREE (CONSUMERCODE);
CREATE INDEX IDX_CONNECTION_PROPTAXID ON EGWTR_CONNECTION USING BTREE (PROPERTYIDENTIFIER);
CREATE INDEX IDX_CONNECTION_BPAID ON EGWTR_CONNECTION USING BTREE (BPAIDENTIFIER);
CREATE INDEX IDX_CONNECTION_PARENT ON EGWTR_CONNECTION USING BTREE (PARENTCONNECTION);
CREATE INDEX IDX_CONNECTION_METER ON EGWTR_CONNECTION USING BTREE (METER);
CREATE SEQUENCE SEQ_EGWTR_CONNECTION;

CREATE TABLE EGWTR_CONNECTIONDETAILS
(
	ID			bigint NOT NULL,
	APPLICATIONTYPE		bigint NOT NULL,
	CONNECTION		bigint NOT NULL,
	APPLICATIONNUMBER	character varying(50),
	APPLICATIONDATE		date,
	DISPOSALDATE		date,
	CONNECTIONTYPE		character varying(20) NOT NULL,	
	CATEGORY		bigint NOT NULL,
	WATERSOURCE		bigint NOT NULL,
	USAGETYPE		bigint NOT NULL,
	PROPERTYTYPE		bigint NOT NULL,
	PIPESIZE		bigint NOT NULL,
	SUMPCAPACITY		double precision NOT NULL,
	PLOTSIZE		double precision,
	PLINTHAREA		double precision,
	NUMBEROFPERSON		integer,
	CONNECTIONSTATUS	character varying(20) NOT NULL,
	STATE			bigint,
	APPROVALNUMBER		character varying(25),
	APPROVALDATE		date,
	DEMAND			bigint,
	CREATEDBY		bigint NOT NULL,
	CREATEDDATE     	timestamp without time zone NOT NULL,
	LASTMODIFIEDDATE	timestamp without time zone NOT NULL,
	LASTMODIFIEDBY		bigint NOT NULL,
	VERSION			numeric NOT NULL
);
COMMENT ON COLUMN EGWTR_CONNECTIONDETAILS.APPLICATIONNUMBER IS 'Nullable, as this might not be available for migrated data. System generated ULBID+6digit running number';
ALTER TABLE EGWTR_CONNECTIONDETAILS ADD CONSTRAINT PK_CONNDTL PRIMARY KEY (ID);
ALTER TABLE EGWTR_CONNECTIONDETAILS ADD CONSTRAINT FK_CONNDTL_APPLTYPE FOREIGN KEY (APPLICATIONTYPE) REFERENCES EGWTR_APPLICATION_TYPE (ID);
ALTER TABLE EGWTR_CONNECTIONDETAILS ADD CONSTRAINT FK_CONNDTL_CONNECTION FOREIGN KEY (CONNECTION) REFERENCES EGWTR_CONNECTION (ID);
ALTER TABLE EGWTR_CONNECTIONDETAILS ADD CONSTRAINT FK_CONNDTL_CATEGORY FOREIGN KEY (CATEGORY) REFERENCES EGWTR_CATEGORY (ID);
ALTER TABLE EGWTR_CONNECTIONDETAILS ADD CONSTRAINT FK_CONNDTL_SOURCE FOREIGN KEY (WATERSOURCE) REFERENCES EGWTR_WATER_SOURCE (ID);
ALTER TABLE EGWTR_CONNECTIONDETAILS ADD CONSTRAINT FK_CONNDTL_USAGE FOREIGN KEY (USAGETYPE) REFERENCES EGWTR_USAGE_TYPE (ID);
ALTER TABLE EGWTR_CONNECTIONDETAILS ADD CONSTRAINT FK_CONNDTL_PROPERTYTYPE FOREIGN KEY (PROPERTYTYPE) REFERENCES EGWTR_PROPERTY_TYPE (ID);
ALTER TABLE EGWTR_CONNECTIONDETAILS ADD CONSTRAINT FK_CONNDTL_PIPESIZE FOREIGN KEY (PIPESIZE) REFERENCES EGWTR_PIPESIZE (ID);
ALTER TABLE EGWTR_CONNECTIONDETAILS ADD CONSTRAINT FK_CONNDTL_STATE FOREIGN KEY (STATE) REFERENCES EG_WF_STATES (ID);
ALTER TABLE EGWTR_CONNECTIONDETAILS ADD CONSTRAINT FK_CONNDTL_DEMAND FOREIGN KEY (DEMAND) REFERENCES EG_DEMAND (ID);
ALTER TABLE EGWTR_CONNECTIONDETAILS ADD CONSTRAINT FK_CONNDTL_CREATEDBY FOREIGN KEY (CREATEDBY) REFERENCES EG_USER (ID);
ALTER TABLE EGWTR_CONNECTIONDETAILS ADD CONSTRAINT FK_CONNDTL_LASTMODIFIEDBY FOREIGN KEY (LASTMODIFIEDBY) REFERENCES EG_USER (ID);
CREATE INDEX IDX_CONNDTL_APPTYPE ON EGWTR_CONNECTIONDETAILS USING BTREE (APPLICATIONTYPE);
CREATE INDEX IDX_CONNDTL_CONNECTION ON EGWTR_CONNECTIONDETAILS USING BTREE (CONNECTION);
CREATE INDEX IDX_CONNDTL_APPNUMBER ON EGWTR_CONNECTIONDETAILS USING BTREE (APPLICATIONNUMBER);
CREATE INDEX IDX_CONNDTL_CONNTYPE ON EGWTR_CONNECTIONDETAILS USING BTREE (CONNECTIONTYPE);
CREATE INDEX IDX_CONNDTL_CATEGORY ON EGWTR_CONNECTIONDETAILS USING BTREE (CATEGORY);
CREATE INDEX IDX_CONNDTL_WATERSOURCE ON EGWTR_CONNECTIONDETAILS USING BTREE (WATERSOURCE);
CREATE INDEX IDX_CONNDTL_USAGETYPE ON EGWTR_CONNECTIONDETAILS USING BTREE (USAGETYPE);
CREATE INDEX IDX_CONNDTL_PROPTYPE ON EGWTR_CONNECTIONDETAILS USING BTREE (PROPERTYTYPE);
CREATE INDEX IDX_CONNDTL_PIPESIZE ON EGWTR_CONNECTIONDETAILS USING BTREE (PIPESIZE);
CREATE INDEX IDX_CONNDTL_CONSTATUS ON EGWTR_CONNECTIONDETAILS USING BTREE (CONNECTIONSTATUS);
CREATE SEQUENCE SEQ_EGWTR_CONNECTIONDETAILS;
--DROP TABLE EGWTR_CONNECTION CASCADE;
--DROP SEQUENCE SEQ_EGWTR_CONNECTION;
--DROP TABLE EGWTR_CONNECTIONDETAILS CASCADE;
--DROP SEQUENCE SEQ_EGWTR_CONNECTIONDETAILS;
