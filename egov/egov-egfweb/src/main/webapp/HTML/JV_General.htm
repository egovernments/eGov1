#-------------------------------------------------------------------------------
# eGov suite of products aim to improve the internal efficiency,transparency, 
#      accountability and the service delivery of the government  organizations.
#   
#       Copyright (C) <2015>  eGovernments Foundation
#   
#       The updated version of eGov suite of products as by eGovernments Foundation 
#       is available at http://www.egovernments.org
#   
#       This program is free software: you can redistribute it and/or modify
#       it under the terms of the GNU General Public License as published by
#       the Free Software Foundation, either version 3 of the License, or
#       any later version.
#   
#       This program is distributed in the hope that it will be useful,
#       but WITHOUT ANY WARRANTY; without even the implied warranty of
#       MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#       GNU General Public License for more details.
#   
#       You should have received a copy of the GNU General Public License
#       along with this program. If not, see http://www.gnu.org/licenses/ or 
#       http://www.gnu.org/licenses/gpl.html .
#   
#       In addition to the terms of the GPL license to be adhered to in using this
#       program, the following additional terms are to be complied with:
#   
#   	1) All versions of this program, verbatim or modified must carry this 
#   	   Legal Notice.
#   
#   	2) Any misrepresentation of the origin of the material is prohibited. It 
#   	   is required that all modified versions of this material be marked in 
#   	   reasonable ways as different from the original version.
#   
#   	3) This license does not grant any rights to any user of the program 
#   	   with regards to rights under trademark law for use of the trade names 
#   	   or trademarks of eGovernments Foundation.
#   
#     In case of any queries, you can reach eGovernments Foundation at contact@egovernments.org.
#-------------------------------------------------------------------------------
<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<script language="javascript">
var str="";
var isDrillDown=false;
var isIE;
var req2;
var req;
var codeArray=new Array();
var j=-1;
var k=-1;
var acccodeArray,functionArray;
var codeObj,functionObj ;
var yuiflag = new Array();

function onloadTasks(){
			document.getElementById('reverseSubmit').style.display ="none";
			 PageValidator.addCalendars();
			 PageManager.ListService.callListService();
			 var cgn=PageManager.DataService.getQueryField('cgNumber');
		 	 var sm=PageManager.DataService.getQueryField('showMode');

	 		 if(sm=="new"){
	 		 	document.getElementById('createdInfo').style.display ="none";
				document.getElementById('statusLabel').style.display ="none";
				document.getElementById('statusText').style.display ="none";
				document.getElementById('backbutton').style.display="none";
	 		 }
	 		 else if(cgn && (sm=="modify")){
		 	    isDrillDown=true;
				PageManager.DataService.setQueryField('cgNumber',cgn);
				PageManager.DataService.callDataService('getGeneralDetails');
				PageManager.DataService.callDataService('jvGeneralList');
				document.getElementById('modGrid').style.display='block';
				document.getElementById('voucherHeader_voucherNumber').setAttribute('exilDataType','exilAlphaNumeric');
				document.getElementById('submitGrid').style.display ="none";
					document.getElementById('cgnLabel').style.display='block';
					document.getElementById('backbutton').style.display="none";
				disableControls(0,true);
		 	 }
		 	 else if(cgn && (sm=="view")){
				isDrillDown=true;
				PageManager.DataService.setQueryField('cgNumber',cgn);
				PageManager.DataService.callDataService('getGeneralDetails');
				PageManager.DataService.callDataService('jvGeneralList');
				document.getElementById('modGrid').style.display='none';
				document.getElementById('submitGrid').style.display ="none";
					document.getElementById('cgnLabel').style.display='block';
					document.getElementById('backbutton').style.display='block';
				disableControls(0,true);
		 	 }
		 	 else if(cgn && (sm=="edit")){
				isDrillDown=true;
				PageManager.DataService.setQueryField('cgNumber',cgn);
					document.getElementById('voucherHeader_voucherNumber').setAttribute('exilDataType','exilAlphaNumeric');
				PageManager.DataService.callDataService('getGeneralDetails');
				PageManager.DataService.callDataService('jvGeneralList');
				document.getElementById('modGrid').style.display='none';
				document.getElementById('submitGrid').style.display ="none";
				//document.getElementById('saveandnewb').style.display ="none";
				//document.getElementById('saveandnewlb').style.display ="none";
				//document.getElementById('saveandnewrb').style.display ="none";
				document.getElementById('saveandnew').style.display ="none";
				document.getElementById('backbutton').style.display="none";
				document.getElementById('cgnLabel').style.display='block';
				//document.getElementById('screenName').innerHTML="General Voucher -Modify";

				//disableControls(0,true);
				edit();
		 	 }
		 	 if(!cgn){
				 PageManager.DataService.callDataService('cgNumber');
				 PageManager.DataService.callDataService('coaDetails');
				 PageManager.DataService.addNewRow('JV_GeneralGrid');
				// document.JV_General.voucherHeader_voucherNumber.focus();
				  obj=document.getElementById('modGrid').style.display="none";
				  document.getElementById('backbutton').style.display="none";
			 }
	/*
	 * The following code for account code implements Ajax autocomplete through YUI.
	 *
	 */
	       var type='getAllCoaCodesExceptCashBank';
            var url = "../commons/Process.jsp?type=" +type+ " ";
           	var req2 = initiateRequest();
            req2.onreadystatechange = function()
            {
	                  if (req2.readyState == 4)
	                  {
	                      if (req2.status == 200)
	                      {
	                      	var codes2=req2.responseText;
	                      	var a = codes2.split("^");
							var codes = a[0]; //alert(acccodeArray);
							acccodeArray=codes.split("+");
							codeObj = new YAHOO.widget.DS_JSArray(acccodeArray);
	                      }
	                  }
	        };
	        req2.open("GET", url, true);
	        req2.send(null);

		/*
		 * The following code implements Ajax autocomplete through YUI for function name.
		 *
		 */
			  var type='getAllFunctionName';
			  var url1 = "../commons/Process.jsp?type=" +type+ " ";
				var req3 = initiateRequest();

			  req3.onreadystatechange = function()
			  {		//codeObj=null;
					   if (req3.readyState == 4)
					   {
						  if (req3.status == 200)
						  {
							var codes2=req3.responseText;
							var a = codes2.split("^");
								var codes = a[0];
								functionArray=codes.split("+");// alert(functionArray);
								functionObj = new YAHOO.widget.DS_JSArray(functionArray);
						  }
					   }
			   };
			   req3.open("GET", url1, true);
			   req3.send(null);

		 }

		function autocompletecode(obj)
		{

			// set position of dropdown
			var src = obj;
			var target = document.getElementById('codescontainer');
			var posSrc=findPos(src);
			target.style.left=posSrc[0];
			target.style.top=posSrc[1]+25;
			target.style.width=500;

			var currRow=PageManager.DataService.getRow(obj);
			var coaCodeObj = obj;//PageManager.DataService.getControlInBranch(currRow,'chartOfAccounts_glCodeearning');
			//40 --> Down arrow, 38 --> Up arrow
			if(yuiflag[currRow.rowIndex] == undefined)
   			{
						if(event.keyCode != 40 )
						{
							if(event.keyCode != 38 )
							{
									var oAutoComp = new YAHOO.widget.AutoComplete(coaCodeObj,'codescontainer', codeObj);
									oAutoComp.queryDelay = 0;
									oAutoComp.prehighlightClassName = "yui-ac-prehighlight";
									oAutoComp.useShadow = true;
									oAutoComp.maxResultsDisplayed = 15;
   								oAutoComp.useIFrame = true;
							}
						}
				yuiflag[currRow.rowIndex] = 1;
   			}

		}

		 function autocompletecodeFunction(obj)
		{
			 // set position of dropdown
			var src = obj;
			var target = document.getElementById('codescontainer');
			//target.style.position="absolute";
			var posSrc=findPos(src);
			target.style.left=posSrc[0];
			target.style.top=posSrc[1]+25;
			target.style.width=200;

			var currRow=PageManager.DataService.getRow(obj);
			var coaCodeObj = obj;//PageManager.DataService.getControlInBranch(currRow,'function_code');
			//40 --> Down arrow, 38 --> Up arrow
			if(yuiflag[currRow.rowIndex] == undefined)
   		{
			if(event.keyCode != 40 )
			{
				if(event.keyCode != 38 )
				{
						var oAutoComp = new YAHOO.widget.AutoComplete(coaCodeObj,'codescontainer', functionObj);
						oAutoComp.queryDelay = 0;
						oAutoComp.prehighlightClassName = "yui-ac-prehighlight";
						oAutoComp.useShadow = true;
						oAutoComp.maxResultsDisplayed = 15;
   								oAutoComp.useIFrame = true;
				}
			}
			yuiflag[currRow.rowIndex] = 1;
   		}
		}

		 function fillNeibrAfterSplit(obj,neibrObjName)
		 {
		 	var temp = obj.value; temp = temp.split("`-`");
						obj.value=temp[0];
			 			PageManager.DescService.onblur(neibrObjName);
						var currRow=PageManager.DataService.getRow(obj);
						yuiflag[currRow.rowIndex] = undefined;
						neibrObj=PageManager.DataService.getControlInBranch(currRow,neibrObjName);

			if(temp[1]==null){ return; }else 	neibrObj.value = temp[1];
		 }


function colTotal(obj,target){
	      var a = document.getElementsByName(obj.name);
	      //alert(a);
 	      count = 0;
 	      for(var i = 0; i<=a.length-1;i++) if(a[i].value)
 		  count += parseFloat(a[i].value);
 		  count=Math.round(count*100)/100 ;
	      document.getElementById(target).value = count;
       }

function openSearch(obj){
if(PageManager.DataService.getQueryField('showMode')!=null && (PageManager.DataService.getQueryField('showMode')=='view' || PageManager.DataService.getQueryField('showMode')=='modify')) return false;
var a = new Array(2);
         //var sRtn = showModalDialog("Search.html?screenName=generalJV","","dialogLeft=300;dialogTop=210;dialogWidth=305pt;dialogHeight=300pt;status=no;");
         var sRtn =showModalDialog("Search.html?filterServiceID=6","","dialogLeft=300;dialogTop=210;dialogWidth=305pt;dialogHeight=300pt;status=no;");
         if ( sRtn != '' )
	       {
			 a = sRtn.split("`~`");

			  var x = PageManager.DataService.getControlInBranch(obj.parentNode,'chartOfAccounts_glCode');
			  x.value = a[0];
			  var y = PageManager.DataService.getControlInBranch(obj.parentNode.parentNode,'chartOfAccounts_name');
			  y.value = a[1];

		   }
         }
	function openSearch1(obj, tableName){
if(PageManager.DataService.getQueryField('showMode')!=null && (PageManager.DataService.getQueryField('showMode')=='view' || PageManager.DataService.getQueryField('showMode')=='modify')) return false;
var a = new Array(2);
		var sRtn;
		var str="";
		if(tableName.toLowerCase()=='function'){
		 str = "Search.html?tableNameForCode=function";

		sRtn= showModalDialog(str,"",
				"dialogLeft=300;dialogTop=210;dialogWidth=305pt;dialogHeight=300pt;status=no;");
		if(sRtn != '')
		{
			a = sRtn.split("`~`");

			if(tableName.toLowerCase() == 'function')
			{
				//alert("a 0 value= "+a[0]+" a 1 value = " +a[1]+" a 2 value ="+a[2]);
				var y = PageManager.DataService.getControlInBranch(obj.parentNode,'function_code');
				y.value = a[1];
				var x = PageManager.DataService.getControlInBranch(obj.parentNode,'cv_fromFunctionCodeId');
				x.value = a[2];

			}
		}
	}
  }
function ButtonPress(name)
{
	insertBlankRow('entities_grid',1);//insert blank row at position=1
	var dbDate=document.getElementById('databaseDate').value;
	var vhDate=document.getElementById('voucherHeader_voucherDate').value;
	if(compareDate(formatDateToDDMMYYYY1(vhDate),formatDateToDDMMYYYY1(dbDate)) == -1 )	{
	alert('Voucher Date should be less than or equal to '+dbDate);
	document.getElementById('voucherHeader_voucherDate').focus();
	return false;
	}
	if(!validate())
	return false;
		/* checking for duplicate account codes */
	if(!checkForFunction_AccountCode('JV_GeneralGrid','cv_fromFunctionCodeId','chartOfAccounts_glCode')) return false;

	var isHeaderNarrationDisabled=document.forms[0].voucherHeader_description.disabled;

	if(name.toLowerCase()=='savenew')
		str="new";
	else if(name.toLowerCase()=='saveclose')
		str="close";
	if(isHeaderNarrationDisabled)
	{
		var cgn=PageManager.DataService.getQueryField('cgNumber');
		if(cgn)
		{
			 disableControls(0,false);
		}
		else
		{
			if(!checkNarration('voucherHeader_description'))
			return false;
			if(!PageValidator.validateForm())
			return false;
    		if(!validate())
			return false;
			disableControls(0,false);
		}



		PageManager.UpdateService.submitForm('JV_General');
	}
	else
	{
		disableControls(0,false);
		//alert('HI - 1');//TBR
		PageManager.UpdateService.submitForm('JV_General');
		//alert('HI - 12');//TBR
	}
}

function validate(){
			var i, j, debit=0, credit=0,creditTotal=0,debitTotal=0;

			for(i=0; i<document.JV_General.voucherDetail_debitAmount.length; i++){
				debit = eval(document.JV_General.voucherDetail_debitAmount[i].value);
				credit = eval(document.JV_General.voucherDetail_creditAmount[i].value);
				debit = isNaN(debit)?0:debit;
				credit = isNaN(credit)?0:credit;
				debitTotal = debitTotal + debit;
				creditTotal = creditTotal + credit;

				if((credit>0 || debit>0) &&  document.JV_General.chartOfAccounts_glCode[i].value.length == 0){
					document.JV_General.chartOfAccounts_glCode[i].focus();
					alert('account code is missing for credit/debit supplied field');
					return false;
				}

				if(debit > 0 && credit > 0){
						document.JV_General.voucherDetail_debitAmount[i].focus();
					alert('one account can have only credit or debit...CHECK ACCOUNT : ' + document.JV_General.chartOfAccounts_glCode[i].value);
					return false;
				}


				if(debit==0 && credit == 0 && document.JV_General.chartOfAccounts_glCode[i].value.length!= 0){
					document.JV_General.voucherDetail_debitAmount[i].focus();
					alert('enter debit/credit amount for the account code ' + document.JV_General.chartOfAccounts_glCode[i].value);
					return false;
				}

			}
			if(Math.round(creditTotal*100)/100  != Math.round(debitTotal*100)/100){
				alert('total credit and total debit amount must be same');
				return false;
			}


			if(creditTotal<=0){
				alert('no transaction with no credit/debit');
				return false;
			}


			return true;
		}


function beforeRefreshPage(dc) {

	if(!isNaN(parseInt(dc.values['voucherHeader_cgn'])))
		dc.values['voucherHeader_cgn'] = 'JVG' + dc.values['voucherHeader_cgn'];
		if(isDrillDown && dc.values['serviceID']=='getGeneralDetails')
		dc=createRowIndex(dc,'JV_GeneralGrid','entities_grid');

		if (dc.values['serviceID']=='getGeneralDetails')
		{
			var entityGrid=dc.grids['entities_grid'];
			if(entityGrid.length==1)
			{
				entityGrid[1]=new Array();
				for (var i=0;i<4; i++)
					entityGrid[1][i]='';
				dc.grids['entities_grid']=entityGrid;
			}
		}

	}

function afterUpdateService(dc){
		disableControls(0,true);
		if(str=="new")	window.location="JV_General.htm?"
		if(str=="close") window.close()
		return true;
	}

function onClickCancel(){
	window.location="JV_General.htm";
}

  /*function disableControls(frmIndex, isDisable){
			for(var i=0;i<document.forms[frmIndex].length;i++)
				document.forms[frmIndex].elements[i].disabled =isDisable;
		}*/
	function disableControls(frmIndex, isDisable){
		for(var i=0;i<document.forms[frmIndex].length;i++)
			{
				document.forms[frmIndex].elements[i].disabled =isDisable;
				if(PageManager.DataService.getQueryField('showMode')=='view' &&
				document.forms[frmIndex].elements[i].parentNode.parentNode.getAttribute('id')=='backbutton')
				document.forms[frmIndex].elements[i].disabled =false;
				if(PageManager.DataService.getQueryField('showMode')=='modify'
				&& (document.forms[frmIndex].elements[i].parentNode.parentNode.getAttribute('id')=='modGrid' ||
				document.forms[frmIndex].elements[i].parentNode.parentNode.getAttribute('id')=='reverseSubmit' ))
				document.forms[frmIndex].elements[i].disabled =false;
			}

		}


	//This will enable all the narration fields in the detail
		function enableControls(frmIndex, isDisable){
		//alert(document.forms[frmIndex].elements[14].name);
		//document.forms[frmIndex].elements[12].disabled=false;
		for(var i=14;i<=document.forms[frmIndex].length-17;i=i+5){
			document.forms[frmIndex].elements[i].disabled =isDisable;

			}
		}
		function edit(){
				var cgn=PageManager.DataService.getQueryField('cgNumber');
		 		if(cgn){
		 			document.forms[0].voucherHeader_cgn.disabled=true;
		 			//document.forms[0].voucherHeader_voucherNumber.disabled=true;
		 			document.forms[0].voucherHeader_createdby.disabled=true;
		 			document.forms[0].voucherHeader_status.disabled=true;
		 			document.getElementById('submitGrid').style.display ="block";
					document.getElementById('modeOfExec').value="edit";
					enableControls(0,false);
		 	 	}
		}
		function modify(){
				var cgn=PageManager.DataService.getQueryField('cgNumber');
		 		if(cgn){
		  			document.getElementById('reverseRecord').style.display='block';
		 			var vcObj=document.getElementById('voucherHeader_newVcNo');
		 			vcObj.setAttribute('exilMustEnter','true');
		 			vcObj.disabled=false;
		 			var vdObj=document.getElementById('voucherHeader_effDate')
		 			vdObj.setAttribute('exilMustEnter','true');
		 			vdObj.disabled=false;
		 			document.getElementById('modeOfExec').value="modify";
		 			document.getElementById('reverseSubmit').style.display ="block";
		 	 	}
		}
		function hideButtons(){
			//document.getElementById('modGrid').style.display='none';
			document.getElementById('modGrid').style.display='block';
			document.getElementById('submitGrid').style.display ="none";
			//document.getElementById ('text1').style.display ="none";
		}
		function afterRefreshPage(dc){

			var sm=PageManager.DataService.getQueryField('showMode');
			if (sm=='edit' && dc.values['serviceID']=='getGeneralDetails' )
			{	//alert("inside jv edit mode");
				document.getElementById("voucherHeader_voucherNumberPrefix").style.display="block";
				var vnum=dc.values['voucherHeader_voucherNumber'];
				var subVnum=vnum.substring(0,2);
				document.getElementById("voucherHeader_voucherNumber").value=vnum.substring(2,vnum.length);
				document.getElementById("voucherHeader_voucherNumberPrefix").value=subVnum;
				if(document.getElementById("oldVoucherDate").value == "")
				{
					document.getElementById("oldVoucherDate").value=formatDate2(dc.values['voucherHeader_voucherDate']);
				}
		 		//alert(document.getElementById("oldVoucherDate").value);
			}

				if(dc.values['databaseDate']!='' && dc.values['serviceID']=='cgNumber')
				{
				var dt=dc.values['databaseDate']
				document.getElementById('voucherHeader_voucherDate').value=dt;
				}



				//calculateTotal();
				var voucherHeader_voucherDate=dc.values['voucherHeader_voucherDate'];
				if(voucherHeader_voucherDate){
					voucherDate=formatDate2(voucherHeader_voucherDate);
					document.getElementById('voucherHeader_voucherDate').value=voucherDate;
				}
				var sm=PageManager.DataService.getQueryField('showMode');
				if(sm=="new"){
		 		    var createdBy=dc.values['current_UserID'];
					document.getElementById('voucherHeader_createdby').value=createdBy;
	 		    }
	 		    else
	 		    {
	 		     var createdById=dc.values['voucherHeader_createdbyId'];
	 		    	if(createdById!="undefined" && createdById*1 >0){
	 		    		document.getElementById('voucherHeader_createdby').value=dc.values['voucherHeader_createdby'];
 		    		}
	 		    }
				var voucherStatus=dc.values['voucherHeader_status'];
				//alert(voucherStatus);
				var voucherConfirmed=dc.values['voucherHeader_confirmed'];
				if(voucherConfirmed=='0')
					document.getElementById('voucherHeader_status').value="Unconfirmed";
				else if(voucherConfirmed=='1' && voucherStatus=='0')
					document.getElementById('voucherHeader_status').value="Confirmed";
				else if(voucherStatus=='1')
					document.getElementById('voucherHeader_status').value="Reversed";
				else if(voucherStatus=='2')
					document.getElementById('voucherHeader_status').value="Reversal";


				var tab=dc.grids['JV_GeneralGrid'];
				if(tab){
					var count1 = 0,count2=0;
					for(var i=1;i<tab.length;i++){
						count1 += parseFloat(tab[i][4]);
						count1=Math.round(count1*100)/100 ;
						count2 += parseFloat(tab[i][5]);
						count2=Math.round(count2*100)/100 ;
					}
					document.getElementById("debitTotal").value = count1;
					document.getElementById("creditTotal").value = count2;
				}
		}
		function showglEntry()
		{
			if(!PageValidator.validateForm())
				return false;
			var trObj;
			var tObj=document.getElementById("showEntries");
			var cr=0,dr=0;
			tObj.style.display="block";
			var tableObj=document.getElementById("entries");
			var gltable= document.getElementById("JV_GeneralGrid");
			for(var i=tableObj.rows.length-1;i>=2;i--)
			{
				tableObj.deleteRow(i);
			}
			for(var i=1;i<gltable.rows.length;i++)
			{

				code=PageManager.DataService.getControlInBranch(gltable.rows[i],'chartOfAccounts_glCode').value;
				name=PageManager.DataService.getControlInBranch(gltable.rows[i],'chartOfAccounts_name').value;
				debit=PageManager.DataService.getControlInBranch(gltable.rows[i],'voucherDetail_debitAmount').value;
				dr=dr+debit;
				credit=PageManager.DataService.getControlInBranch(gltable.rows[i],'voucherDetail_creditAmount').value;
				cr=cr+credit
				var Obj=PageManager.DataService.getControlInBranch(tableObj.rows[1],"display_Code");
				trObj=PageManager.DataService.getRow(Obj);
				 if(i==1){
								newRow=trObj;
								objt1=PageManager.DataService.getControlInBranch(newRow,'display_Code');
								objt2=PageManager.DataService.getControlInBranch(newRow,'display_Head');
								objt3=PageManager.DataService.getControlInBranch(newRow,'display_Debit');
								objt4=PageManager.DataService.getControlInBranch(newRow,'display_Credit');
								if(code=="") code=" -"; if(name=="") name=" -"; if(debit=="") debit=" 0"; if(credit=="") credit=" 0";
								objt1.innerHTML=code;
								objt2.innerHTML=name;
								objt3.innerHTML=debit;
								objt4.innerHTML=credit;

				 }else{

						 var newRow=trObj.cloneNode(true);
						newRow=tableObj.tBodies[0].appendChild(newRow);
						objt1=PageManager.DataService.getControlInBranch(newRow,'display_Code');
						objt2=PageManager.DataService.getControlInBranch(newRow,'display_Head');
						objt3=PageManager.DataService.getControlInBranch(newRow,'display_Debit');
						objt4=PageManager.DataService.getControlInBranch(newRow,'display_Credit');

						if(code=="") code=" -"; if(name=="") name=" -"; if(debit=="") debit=" 0"; if(credit=="") credit=" 0";
						objt1.innerHTML=code;
						objt2.innerHTML=name;
						objt3.innerHTML=debit;
						objt4.innerHTML=credit;

				}
			}


			 var dSum=0;
			 var cSum=0;
			for(var i=1;i<tableObj.rows.length;i++)
			{

			  var dObj=PageManager.DataService.getControlInBranch(tableObj.rows[i],"display_Debit");
			  var cObj=PageManager.DataService.getControlInBranch(tableObj.rows[i],"display_Credit");
			 if(!isNaN(parseFloat(dObj.innerHTML)))
			 {
			   var sum=(parseFloat(dObj.innerHTML));
			   dSum=dSum+sum;
			 }
			 if(!isNaN(parseFloat(cObj.innerHTML)))
			 {
			   var sum=(parseFloat(cObj.innerHTML));
			   cSum=cSum+sum;
			 }
			}
			var newRow=trObj.cloneNode(true);
			newRow=tableObj.tBodies[0].appendChild(newRow);
			objt1=PageManager.DataService.getControlInBranch(newRow,'display_Code');
			objt2=PageManager.DataService.getControlInBranch(newRow,'display_Head');
			objt3=PageManager.DataService.getControlInBranch(newRow,'display_Debit');
			objt4=PageManager.DataService.getControlInBranch(newRow,'display_Credit');

			objt1.innerHTML=" ";
			objt2.innerHTML=" ";
			objt3.innerHTML=Math.round(dSum*100)/100 ;
			objt4.innerHTML=Math.round(cSum*100)/100 ;;
	}

       function funClear(obj, tableName)
		 {
		   if(tableName.toLowerCase() == 'chartofaccounts')
			{
				var v =PageManager.DataService.getControlInBranch(obj.parentNode.parentNode,'function_code')
				var w =PageManager.DataService.getControlInBranch(obj.parentNode.parentNode,'cv_fromFunctionCodeId')
				if(v.value=="")
				{
				v.value = "";
				w.value = "";
				}
			}

		}


</script>

	</head>
	<title>Jounal Voucher</title>
	<body bgcolor="#ffffff" bottommargin="0" topmargin="0" rightmargin="0" leftmargin="0"
		 marginheight="0" marginwidth="0" onLoad="onloadTasks();" onKeyDown ="CloseWindow(event); "><!------------------ Header Begins Begins--------------------->
		 <form name="JV_General">
		<input  type="hidden" id="glCode" name="glCode">
		<input type="hidden" name="oldVoucherDate" id="oldVoucherDate">
		<input type="hidden" name="budgetCheckRequired" id="budgetCheckRequired" value="true">
		<input type="hidden" name="modeOfExec" id="modeOfExec" value="new">
		<input type="hidden" name="tType" id="tType" value="J">
		<input type="hidden" name="cgnNum" id="cgnNum">
		<input type="hidden" name="voucherHeader_id" id="voucherHeader_id">
		<input type="hidden" name="databaseDate"  id="databaseDate">
	<table width="100%" border=0 cellpadding="1" cellspacing="0">
			<tr>
			<td valign="top" ><!------------Content begins here ------------------>
						<table width="100%" border=0 cellpadding="3" cellspacing="0">
        <TBODY>
							<tr  id="cgnLabel" name="cgnLabel" style="DISPLAY: none" >
									<td  width=20% ><div align="right" valign="center" class="labelcell"> CG&nbsp;Number</div>
									</td>
									<td width =35% >
										<span class="smallfieldcell"><input class="fieldcell" style="width:175px" name="voucherHeader_cgn" id="voucherHeader_cgn" readOnly exilMustEnter ="true" SIZE="20">
									</span></td>
									<td  width="20%">&nbsp;</td>
								<td >&nbsp;</td>

								</tr>

							<tr>
								<td  width =20% >
								<div  align="right" valign="center" class="labelcell"> Voucher Number<SPAN class=leadon>*</SPAN> </div>
								</td>
								<td width =35% >
								<table cellpadding="0" cellspacing="0">
							  		<tr >
							  		<td class="smallfieldcell"><input name="voucherHeader_voucherNumberPrefix" maxlength="2"  id="voucherHeader_voucherNumberPrefix" readonly style="display:none" style="width:25px" SIZE="1"></td>
							  		<td><span class="fieldcell"><input class="fieldcell" name="voucherHeader_voucherNumber" id="voucherHeader_voucherNumber" maxlength="10" exilMustEnter="true" exilDataType="exilAlphaNumeric" SIZE="20" ></td>
									</span></tr>
								</table>
								</td>
								<td  width=20%>
								<div  class="labelcell" align=right valign="center" style="align:right" > Voucher Date<span class="leadon">*</span></div>
								</td>
								<td><span class="smallfieldcell" >
								<INPUT  class="datefieldinput" name="voucherHeader_voucherDate" id="voucherHeader_voucherDate" style="WIDTH: 101px;  HEIGHT: 19px" size   ="13" onkeyup="DateFormat(this,this.value,event,false,'3')" exilMustEnter="true" exilDataType="exilAnyDate"exilCalendar="true"></span>

									</td>
								</tr>

							<tr >
								<td>
								<div  align="right" valign="center" class="labelcell">  Fund<SPAN class=leadon>*</SPAN> </div>
								</td>
								<td ><span class="smallfieldcell"><SELECT class="combowidth2" id=fund_id name="fund_id" exilMustEnter="true" exilListSource="fundName"></SELECT></span>&nbsp;
								</td>
								<td  width="20%" height="18"><div  align="right" valign="center" class="labelcell" align=right> Financing Source </div></td>
								<td ><span class="smallfieldcell"><SELECT class="combowidth1" id=fundSource_id name="fundSource_id" exilListSource="fundSourceName"></SELECT></span>&nbsp;
								</td>
							</tr>
							<tr >
							  <td class="labelcell"><div  align="right" valign="center" >Narration</div></td>
							  <td ><TEXTAREA class=narrationfieldinput id=voucherHeader_description name=voucherHeader_description  rows=3 cols=40 exilDataType="exilAnyChar" maxlength="250" cols="20"></TEXTAREA>
							  <td  id="statusLabel" width="20%"><div  align="right" valign="center" class="labelcell">Status</div></td>
							  <td  id="StatusText" width="231">
								<span class="fieldcell"><input class="fieldcell" name="voucherHeader_status" id="voucherHeader_status" SIZE="20">
							  </span></td>
							 </tr>

							<tr  id="createdInfo">
							  <td ><div  align="right" valign="center" class="labelcell" exilMustEnter="true">Created By</div></td>
							  <td ><span class="fieldcell"><input class="fieldcell" name="voucherHeader_createdby" id="voucherHeader_createdby" SIZE="20"></span></td>
							  <td >&nbsp;</td>
							  <td >&nbsp;</td>

						  	 </tr>


                              <tr >
							  <td align="middle" colspan=4 width="100%" >&nbsp;
							  </td>
							  </tr></TBODY>
                              </table>
						        <table width="95%" border="0" cellpadding="0" cellspacing="0" ID="Table1">
                                  <tr>
                                    <td>
                                    <table  width="92%" border="1" cellpadding="0" cellspacing="0" ID="JV_GeneralGrid">
                                      <tr class="rowheader">
                                        <td width="1%"  class="thStlyle">&nbsp;&nbsp;</td>
                                        <td width="15%"  class="thStlyle"><div align="center">Function Name</div></td>
                                        <td width="8%"  class="thStlyle"><div align="center" >Account&nbsp;Code</div></td>
                                        <td width="25%"><div align="center" class="thStlyle">Account Head</div></td>
                                        <td width="8%"><div align="center" class="thStlyle">Debit&nbsp;Amount</div></td>
                                        <td width="8%"><div align="center" class="thStlyle">Credit&nbsp;Amount</div></td>
                                        <td width="6%"><div align="center" class="thStlyle">Details</div></td>
                                     </tr>
                                     <tr class="smallfieldcell" >
                                     <td class="tdStlyle" width="1%"  onClick="changeColor(this,'JV_GeneralGrid');" name="selectTd" id="selectTd"></td>
                                       <td>
                                       <input type="hidden" name="cv_fromFunctionCodeId" id="cv_fromFunctionCodeId">
                                       <input class="normaltext" size=10 name="function_code" id="function_code"  style="WIDTH: 105px; HEIGHT:22px" value="" autocomplete="off" onkeyup="autocompletecodeFunction(this);"   exilDescField="cv_fromFunctionCodeId" exilDataSource="functionIdKey" onBlur="fillNeibrAfterSplit(this,'cv_fromFunctionCodeId');funClear(this, 'chartOfAccounts');" exilInGrid="true" size="20"><IMG   id=IMG1 onclick=openSearch1(this,'function')

                  height=22 src="/egi/resources/erp2/images/plus1.gif" width=25 align=top border=0 >
										</td>
                                        <td>
										<input class="fieldinput-right" size=10 name="chartOfAccounts_glCode" id="chartOfAccounts_glCode" autocomplete="off" onkeyup="autocompletecode(this);" onBlur="fillNeibrAfterSplit(this,'chartOfAccounts_name')" style="WIDTH: 60px; HEIGHT:
                  22px" exilDataType ="exilAlphaNumeric" exilInGrid="true" size="20"
                  exilDataSource=""
                  exilDescField="chartOfAccounts_name"><IMG
                  id=IMG1 onclick=openSearch(this)
                  height=22 src="/egi/resources/erp2/images/plus1.gif" width=25 align=top border=0 >
										</td>
                                        <td>
											<input class="labelcellforsingletd" NAME="chartOfAccounts_name" id="chartOfAccounts_name" style ="WIDTH: 260px; HEIGHT: 19px"
                  readOnly SIZE="20">
                                        </td>
                                        <td>
											<input class="fieldinput-right"  NAME="voucherDetail_debitAmount" id="voucherDetail_debitAmount" onBlur="colTotal(this,'debitTotal')" exilDataType="exilUnsignedDecimal" maxLength="16" exilMax="9999999999999.99" exilMin="0" style ="WIDTH: 120px; HEIGHT: 19px" SIZE="20">
										</td>
                                        <td>
											<INPUT class="fieldinput-right" name="voucherDetail_creditAmount" id="voucherDetail_creditAmount" onBlur="colTotal(this,'creditTotal')" onKeyDown ="addNewRow('JV_GeneralGrid','chartOfAccounts_glCode')" maxLength="16" exilDataType="exilUnsignedDecimal" exilMax="9999999999999.99" exilMin="0"  style ="WIDTH: 120px; HEIGHT: 19px" SIZE="20">
                                        </td>
                                       <td><A  id=A1 style="WIDTH: 10px; HEIGHT: 19px" onclick ="openDetails(this,'chartOfAccounts_glCode','generalJV','entities_grid','')"
                 href="#" >Click</A></td>
                                       </tr>

                                      </table>
                   <tr>
					<td>
					<table>
							<tr>
								<td colspan="2" align="center"><input type="button"  class="button" value="Delete Row" id="deleteDetail" name="deleteDetail" onclick=" deleteRowTable('JV_GeneralGrid');colAllTotal('voucherDetail_debitAmount','voucherDetail_creditAmount','debitTotal','creditTotal');" /></td>
								<td colspan="2" align="center"><input type="button"  class="button" value="Add Row" id="addDetail" name="addDetail" onclick="addNewRowFromButton('JV_GeneralGrid','chartOfAccounts_glCode','voucherDetail_accountName');" /></td>
					       </tr>
					</table>
                    </td>
                    </tr>
                                        <!--<tr><td id="auto-row">&nbsp;<td/></tr>-->
                                     <!--new -->


                                  <tr>
                                    <td>
										<table width="95%" border="1" cellpadding="0" cellspacing="0" ID="buttonInTable" >
                                      <tr >
                                        <td width="10%"><div align="center"></div></td>
                                        <td width="20%"><div align="center"></div></td>
                                        <td width="15%"><div align="center"></div></td>
                                        <td width="15%"><div align="center"></div></td>
                                        <td width="3%"><div align="center"></div></td>
                                     </tr>

				   <tr >
				    <td >
						<span style="WIDTH: 100px; HEIGHT: 19px"></span>
					</td>
					<td >
						<span style="WIDTH: 100px; HEIGHT: 19px"></span>
					</td>

					<td align="right">
						<span style ="WIDTH: 310px; HEIGHT: 15px" class="labelcell" >Total&nbsp;</span>
					</td>
					<td>
						<input class="fieldcellamount" size=18 id="debitTotal" name="debitTotal"  style   ="WIDTH: 120px; HEIGHT: 19px" readOnly>
					</td>
					<td>
						<INPUT class="fieldcellamount" id="creditTotal" name="creditTotal"
							style="WIDTH: 120px; HEIGHT: 19px" readOnly SIZE="20">

					</td>

					<td ><span style="WIDTH: 40px; HEIGHT: 19px"></span></td>
                                       </tr>

                                      </table>
                                      </td></tr>

                                      </table><div id="codescontainer"></div>

                  <table width="100%" border="0" cellpadding="0" cellspacing="0" ID="buttonTable">
                  <tr>
                  <td>

      			<tr>
				<td height="25" colspan="4" valign="bottom" class="smalltext"><p class="smalltext">
					<span class="leadon">*</span>- Mandatory Fields</p>
				</td>
			</tr><!--  Buttons for Request Form starts here -->
			<tr >
				<td colspan="4" align="middle"><!-- Buttons Start Here -->
					<table border="0" cellpadding="0" cellspacing="0"></table>
									<table border="0" cellpadding="0" cellspacing="0">
										<!--<tr id="modGrid">
											<td align="right">
											<IMG height=18 src="/egi/resources/erp2/images/Button_leftside.gif" width=6></td>
											<td bgcolor="#fe0000" valign="center" nowrap><A class=buttonprimary onclick=modify();  href="#">Reverse</A></td>
											<td>
											<IMG height=18 src="/egi/resources/erp2/images/Button_rightside.gif" width=6></td>
											<td><IMG src="/egi/resources/erp2/images/spacer.gif" width=8></td>

										</tr>-->

						<tr id="modGrid">
							<td width=100% colspan=4 align=center>
									<input type="button" class="button" value="Reverse" onclick="modify()" />
							</td>
						</tr>

										<tr>
													<td colspan="4" align="middle">
														<table border="0" cellpadding="0" cellspacing="0" id="buttons">
														<!--	<tr id="backbutton"><td align="center">
															<IMG height=18 src="/egi/resources/erp2/images/Button_leftside.gif" width=6></td>
															<td bgcolor="#fe0000" valign="center" nowrap><A class=buttonprimary onclick="back(window.self)"  href="#">Back</A></td>
															<td><IMG height=18 src="/egi/resources/erp2/images/Button_rightside.gif" width=6></td>
															<td><IMG src="/egi/resources/erp2/images/spacer.gif" width=8></td>
															</tr>-->
								<tr id="backbutton" >
									<td width=100% align=center colspan=4>
									<input   type="button" class="button" value="Back" onclick="back(window.self)" />

									</td>

															<!--<tr id="backbutton">
																<td width=100% align=center>
																		<input type="button" class="button"  value="Back" onclick="back(window.self)"; />
																</td>-->

														</table>
													</td>
												</tr>
										<tr>
										  <td colspan=4></td>
										<tr>
									<!--	<tr id="reverseRecord"  style="DISPLAY: none">
										<td>
													<div  align="right" valign="center" class="normaltext"> Voucher Number<SPAN class=leadon>*</SPAN> </div>
															</td>
															<td>
																<input class="fieldinput" name="voucherHeader_newVcNo" id="voucherHeader_newVcNo" maxlength="10"  exilDataType="exilAnyChar" >
															</td>

															<td><div  align="right" valign="center" class="normaltext" >Voucher Date<span class="leadon">*</span></div>
															</td>
															<td>
															<INPUT  class="datefieldinput" name="voucherHeader_effDate" id="voucherHeader_effDate" style="WIDTH: 101px;  HEIGHT: 19px" size   ="13"   exilDataType="exilPastDate"
																exilCalendar="true">

											</td>-->
											<!--<td ><span  align="right" valign="center" class="normaltext"> Voucher Number<SPAN class=leadon>*</SPAN>
												 <input name="voucherHeader_newVcNo" id="voucherHeader_newVcNo" maxlength="5"  style="WIDTH: 75px; HEIGHT: 22px" size="8"
												   exilDataType="exilAlphaNumeric"> </span> </td>
											<td></td>
											<td ><span  align="right" valign="center" class="" >Voucher Date<span class="leadon">*</span>
											<INPUT
																                  class="datefieldinput" name="voucherHeader_effDate" id="voucherHeader_effDate"
                  style="WIDTH: 101px; HEIGHT: 19px" size="13" onkeyup="DateFormat(this,this.value,event,false,'3')" exilDataType="exilAnyDate"
                  exilCalendar="true"></span></td>
											<td></td>
										</tr>-->
								<tr id="reverseRecord"  style="DISPLAY: none">
									<td align="right"><span   valign="center" class="labelcell"> Voucher Number<SPAN class=leadon>*</SPAN></span>
									</td>
									<td><span class=fieldcell><input  class=fieldcell name="voucherHeader_newVcNo" id="voucherHeader_newVcNo" maxlength="10"   exilDataType="exilAlphaNumeric" style="width:148; height:19"></span>
									</td>
									<td align="right">
										<span   valign="center" class="labelcell" >Voucher Date<span class="leadon">*</span>
									</td>
									<td><span class=smallfieldcell> <INPUT class="smallfieldcell" name="voucherHeader_effDate" exilDataType="exilAnyDate" id   ="voucherHeader_effDate" style="WIDTH: 120x; HEIGHT: 19px" size="13" onkeyup="DateFormat(this,this.value,event,false,'3')" exilCalendar="true"></span></span>
									</td>
									<!--<td><INPUT	 type   =hidden class   ="datefieldinput" name="diffDebit" id="diffDebit" style="WIDTH: 101px; HEIGHT: 19px"	size="13"></SPAN>
									</td>-->
								</tr>

										<tr>
										  <td colspan=4></td>
										<tr></tr>
			</table>
					<table border="0" cellpadding="0" cellspacing="0">
									<!--<tr id="submitGrid">
										<td align="right" id="saveandnewlb">
										<IMG height=18 src="/egi/resources/erp2/images/Button_leftside.gif" width=7></td>
										<td bgcolor="#fe0000" valign="center" nowrap id="saveandnewb"><A class=buttonprimary onclick="return ButtonPress('savenew');" href="#">Save & New</A></td>
										<td id="saveandnewrb">
										<IMG height=18 src="/egi/resources/erp2/images/Button_rightside.gif" width=7></td>
										<td><IMG src="/egi/resources/erp2/images/spacer.gif" width=8></td>
										<td><IMG height=18 src="/egi/resources/erp2/images/Button_leftside.gif" width=7></td>
										<td bgcolor="#fe0000" valign="center" nowrap><A class=buttonprimary onclick="return ButtonPress('saveclose');" href="#">Save & Close</A></td>
										<td>
										<IMG height=18 src="/egi/resources/erp2/images/Button_rightside.gif" width=7></td>
										<td><IMG src="/egi/resources/erp2/images/spacer.gif" width=8></td>
										<td align="right">
										<IMG height=18 src="/egi/resources/erp2/images/Button_second_leftside.gif" width=6></td>
										<td bgcolor="#ffffff" valign="center" nowrap background="/egi/resources/erp2/images/Button_second_middle.gif"><A class=buttonsecondary onclick=onClickCancel() href="#">Cancel</A></td>
										<td>
										<IMG height=18 src="/egi/resources/erp2/images/Button_second_rightside.gif" width=6></td>
										<td><IMG src="/egi/resources/erp2/images/spacer.gif" width=8></td>
										<td align="right">
										<IMG height=18 src="/egi/resources/erp2/images/Button_second_leftside.gif" width=6></td>
										<td bgcolor="#ffffff" valign="center" nowrap background="/egi/resources/erp2/images/Button_second_middle.gif"><A class=buttonsecondary onClick=window.close(); href="#">Close</A></td>
										<td><IMG height=18 src="/egi/resources/erp2/images/Button_second_rightside.gif" width=6></td>
										<td><IMG src="/egi/resources/erp2/images/spacer.gif" width=8></td>
										<td><IMG height=18 src="/egi/resources/erp2/images/Button_second_leftside.gif" width=6></td>
										<td bgcolor="#ffffff" valign="center" nowrap background="/egi/resources/erp2/images/Button_second_middle.gif"><A class=buttonsecondary onclick="showglEntry();" href="#">Show GLEntry</A></td>
										<td><IMG height=18 src="/egi/resources/erp2/images/Button_second_rightside.gif" width=6></td>
										</tr>-->
						<tr id="submitGrid">
							 <td>
							 <input  id="saveandnew" type="button" class="button" value="Save & New" onclick="return ButtonPress('savenew');"/>
							 <input   type="button" class="button" value="Save & Close" onclick="return ButtonPress('saveclose');" />
							 <input   type="button" class="button" value="Cancel" onclick="onClickCancel()" />
							 <input   type="button" class="button" value="Close" onclick=window.close(); />
							 <input   type="button" class="button" value="Show GlEntry" onclick=showglEntry(); />
							 </td>
						</tr>


										</table>
										<table border="0" cellpadding="0" cellspacing="0">
									<!--<tr id="reverseSubmit">

									<td align="right">
									<IMG height=18 src="/egi/resources/erp2/images/Button_leftside.gif" width=7></td>
									<td bgcolor="#fe0000" valign="center" nowrap><A class=buttonprimary onclick="return ButtonPress('saveclose');" href="#">Submit</A></td>
									<td>
									<IMG height=18 src="/egi/resources/erp2/images/Button_rightside.gif" width=7></td>
									<td><IMG src="/egi/resources/erp2/images/spacer.gif" width=8></td>
									<td align="right">
									<IMG height=18 src="/egi/resources/erp2/images/Button_second_leftside.gif" width=6></td>
									<td bgcolor="#ffffff" valign="center" nowrap background="/egi/resources/erp2/images/Button_second_middle.gif"><A class=buttonsecondary onClick=window.close(); href="#">Close</A></td>
									<td>
									<IMG height=18 src="/egi/resources/erp2/images/Button_second_rightside.gif" width=6></td>
						</tr>-->
						 <tr id="reverseSubmit">
					 						<td width=100% align=center><input type="button"  id="revsave" value="Submit" class="button" onclick="return ButtonPress('saveclose');"/>&nbsp;<input type="button" id="revclose" value="Close" class="button" onclick="window.close();" />
					 						</td>
						</tr>						</table>
							</tr></table><!-- Buttons End Here --></td></tr></table><!------------ Content ends here ------------------><!------------Right Navigation Ends here------------------><!---------------- Footer begins here ----------><!---------------- Footer ends here ---------->
							<table width="100%" border=0 cellpadding="3" cellspacing="0" id="showEntries" name="showEntries" style="DISPLAY: none">
							<tr>
							<td colspan=4>
							<table width="100%" align=center border="0" cellpadding="0" cellspacing="0" >
							<tr  height="25">
							 <TD class=displaydata align=center ><h4>GLEntry</h4></TD></tr>
							</table>
							</td>
							</tr>
							<tr ><td>
							<table width="80%" border="1" cellpadding="0" cellspacing="0" align=center id="entries" name="entries">
							<tr class="rowheader">
								<td  class="columnheader" height="16"><div align="center" valign="center" class="thStlyle"> Account Code</div></td>
								<td  class="columnheader" height="16"><div align="center" valign="center" class="thStlyle"> Account Head</div></td>
								<td  class="columnheader" height="16"><div align="center" valign="center" class="thStlyle"> Debit </div></td>
								<td  class="columnheader" height="16"><div align="center" valign="center" class="thStlyle"> Credit</div></td>
							</tr>
							<tr class="tdStlyle">
								<td ><div name="display_Code"  id="display_Code"   readOnly maxLength=10 tabIndex=0>&nbsp;</div></td>
								<td ><div name="display_Head"  id="display_Head"  readOnly maxLength=10 tabIndex=0>&nbsp;</div></td>
								<td ><div name="display_Debit"  id="display_Debit"  readOnly maxLength=16 tabIndex=0>&nbsp;</div></td>
								<td ><div name="display_Credit"  id="display_Credit"  readOnly maxLength=16 tabIndex=0>&nbsp;</div></td>
							</tr>
							</table>
							</td>
							</tr>
						</table>

	<table id="entities_grid" width="20%" style="DISPLAY: none">
		<tr>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
		</tr>
		<tr>
			<td><input id="grid_detTypeId" name="grid_detTypeId" style="WIDTH: 100px" size="20"></td>
			<td><input id="grid_detKeyId" name="grid_detKeyId" style="WIDTH: 100px" size="20"></td>
			<td><input id="grid_detValue" name="grid_detValue" style="WIDTH: 100px" size="20" ></td>
			<td><input id="grid_rowIndex" name="grid_rowIndex" style="WIDTH: 100px" size="20"></td>
			<td><input id="grid_amount" name="grid_amount" style="WIDTH: 100px" size="20"></td>
			<td><input id="grid_detCode" name="grid_detCode" style="WIDTH: 100px" size="20"></td>
          	<td><input id="grid_rowFunId" name="grid_rowFunId" style="WIDTH: 100px" size="20"></td>
		</tr>
	</table>

</form>
<!-- We will set the "left" position value inside autocompletion method -->
		 <div style="position: absolute;top:170px;width:118px;height:30px" id="menu-popup">
		 <table id="completeTable" bgcolor="#cae1ff" border="1"/>
		 </div>


</body>
</html>
