#-------------------------------------------------------------------------------
# eGov suite of products aim to improve the internal efficiency,transparency, 
#      accountability and the service delivery of the government  organizations.
#   
#       Copyright (C) <2015>  eGovernments Foundation
#   
#       The updated version of eGov suite of products as by eGovernments Foundation 
#       is available at http://www.egovernments.org
#   
#       This program is free software: you can redistribute it and/or modify
#       it under the terms of the GNU General Public License as published by
#       the Free Software Foundation, either version 3 of the License, or
#       any later version.
#   
#       This program is distributed in the hope that it will be useful,
#       but WITHOUT ANY WARRANTY; without even the implied warranty of
#       MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#       GNU General Public License for more details.
#   
#       You should have received a copy of the GNU General Public License
#       along with this program. If not, see http://www.gnu.org/licenses/ or 
#       http://www.gnu.org/licenses/gpl.html .
#   
#       In addition to the terms of the GPL license to be adhered to in using this
#       program, the following additional terms are to be complied with:
#   
#   	1) All versions of this program, verbatim or modified must carry this 
#   	   Legal Notice.
#   
#   	2) Any misrepresentation of the origin of the material is prohibited. It 
#   	   is required that all modified versions of this material be marked in 
#   	   reasonable ways as different from the original version.
#   
#   	3) This license does not grant any rights to any user of the program 
#   	   with regards to rights under trademark law for use of the trade names 
#   	   or trademarks of eGovernments Foundation.
#   
#     In case of any queries, you can reach eGovernments Foundation at contact@egovernments.org.
#-------------------------------------------------------------------------------
<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>

<SCRIPT LANGUAGE="javascript">

var sameWindow=0;
var modeOfOperation='new';


function ButtonPress(name)
{
	if(name.toLowerCase()=='savenew')
 		sameWindow=1;
	//   ***1 only FO***,  ***2 FO***,  ***Admin, 3 All***    //
	if(!isValidUser(2, CookieManager.getCookie('userRole')) ) return false;

	if(!checkNarration('bank_narration')) return false;
	if(PageValidator.validateForm())
	{
		//if(document.getElementById('submitButton').innerHTML=='Insert'){
		if(modeOfOperation=='new'){
			 /*   if(document.getElementById('bank_codeCheck').value =='getting value from server....'){
					alert('Verifying Bank Code.... Wait and press Insert again');
					return false;
				}
				else if(document.getElementById('bank_codeCheck').value !='getting value from server....'){
					if(document.getElementById('bank_codeCheck').value!='Invalid value entered.'){
						alert('This Bank Code Exists, Enter different code');
						return false;
					}
				}*/
			bankCode();
			doInsert();
		}
		else{
			doUpdate()
		}
	}
}
function bankCode()
{
   bankName=document.getElementById('bank_name').value;
   narration=document.getElementById('bank_narration').value;
   active=document.getElementById('bank_isActive').checked?"1":"0";
   bank=bankName.split(" ");
   var bankCode="";
   bankCode=document.getElementById('bank_code').value;
   /*for(i=0;i<bank.length;i++)
   {
     bankCode=bankCode+bank[i];
   }*/

  document.getElementById('bank_code').value=bankCode;
  url="BankBranchAdd.htm?bank_code="+bankCode+"&bank_name="+bankName+"&bank_Narration="+narration+"&bank_active="+active+"&newBank=1";
  return url;
 // window.location="BankBranchAdd.htm?bank_code="+bankCode+"&bank_name="+bankName+"&bank_Narration="+narration+"&bank_active="+active+"&newBank=1";
 // alert(document.getElementById('bank_code').value);
}
function beforeRefreshPage(dc){

	return true;
}
function afterRefreshPage(dc){
	return true;
}
function doInsert(){
	//Remove remove egf-bank from Master Data Cache
	var url = "../commons/MasterDataCacheRemove.jsp?type=removeBank";
	var req2 = initiateRequest();
	req2.open("GET", url, false);
	req2.send(null);

	PageManager.UpdateService.submitForm('newBankInsert');
}
function doUpdate(){
	//Remove remove egf-bank from Master Data Cache
	var url = "../commons/MasterDataCacheRemove.jsp?type=removeBank";
	var req2 = initiateRequest();
	req2.open("GET", url, false);
	req2.send(null);

	PageManager.UpdateService.submitForm('newBankUpdate');
}

function getDataOnLoad(){
	var bank_code = PageManager.DataService.getQueryField('bank_code');
	PageManager.ListService.callListService();
	if (bank_code){
		modeOfOperation='modify';
		PageManager.DataService.callDataService('getBankDetail');
		//document.getElementById('submitButton').innerHTML="Modify";
		//document.getElementById('screenName').innerHTML="Bank - Modify";
		document.getElementById('trModify').style.display='block';
		document.getElementById('trNew').style.display='none';
		document.getElementById('bank_name').focus();
	} else {
		//document.getElementById('submitButton').innerHTML="Insert";
		//document.getElementById('screenName').innerHTML="Bank - New";
		document.getElementById('trModify').style.display='none';
		document.getElementById('trNew').style.display='block';
		document.getElementById('savenNew').style.display='none';
		document.getElementById('bank_name').focus();
	}

	document.getElementById('egUser_id').value = CookieManager.getCookie('currentUserId');
	var bankCode=PageManager.DataService.getQueryField('bank_code');
	var bankName=PageManager.DataService.getQueryField('bankName');
	if(bankCode && bankName && bankCode!='' && bankName!='')
		document.getElementById('bank_name').value=bankName;
	PageManager.DataService.setQueryField(bank_code,'')
	PageManager.DataService.setQueryField(bankName,'')
}
function onClickCancel(){
	window.location="BankAdd.htm?";
}

function afterUpdateService(dc){

	if(sameWindow == 1){
	  window.location="BankAdd.htm";
      }

	  else{
	window.location="BankEnquiry.htm?bank_code="+document.getElementById('bank_code').value+"&newBank=0";
	}
	sameWindow=0;
	return true;
}

function verifyBankCode(evnt){
	PageManager.DescService.onblur(evnt);
}
function addBranch()
{
	 var url=bankCode();
	 var bankStatus=chkBank();
	 if(bankStatus==1 )
	 {
	    alert("This Bank Exists.");
	    return;
	 }
	 if(bankStatus==0 )
	 {
	    //alert("Enter Bank Name");
	 }
   if(!isValidUser(2, CookieManager.getCookie('userRole')) ) return false;
	//alert(document.getElementById('bank_name').value);
	//alert(document.getElementById('bank_code').value);
	//alert(document.getElementById('bank_lastModified').value);
	if(!checkNarration('bank_narration')) return false;
	if(PageValidator.validateForm())
	{
		  window.location=url;

	}
}
/*
  if chkBank() function returns:
     0: Bank Name not specified
     1: Bank Name already Exists in Database
     2: New Bank Name
*/
function chkBank()
{
  var bankCode=document.getElementById('bank_code').value;
  var bankFull="";
   var length=document.getElementById('Bank_List').length;
   if(!bankCode)
  {
    // alert("Enter Bank Name");
     return 0;
  }

  for(i=1;i<length;i++)
  {
    bankName="";
    bankFull="";
    bankName=document.getElementById('Bank_List')[i].text;
  	var bank=bankName.split(" ");
    for(j=0;j<bank.length;j++)
	{
	   bankFull=bankFull+bank[j];
	}
	//alert(bankFull+" == "+bankCode);
	if(bankCode.toLowerCase()==bankFull.toLowerCase())
	  return 1;
  }
	  return 2;
}
</SCRIPT>
</head>

<body bgcolor="#ffffff" onKeyDown ="CloseWindow(event);" bottommargin="0" topmargin="0" rightmargin="0" leftmargin="0" marginheight="0" marginwidth="0" onLoad="getDataOnLoad()"><!------------------ Header Begins Begins--------------------->

<form name="journalVoucher">
<input type="hidden" name="egUser_id" id="egUser_id">
	<table width="100%" border=0 cellpadding="3" cellspacing="0">

		<tr >
		   <td align="right" valign="center" width="12%"><div align="right" >
				Bank Code<span class="leadon" >*</span></div></td>
			<td width="41%" class="fieldinput" colspan="2">
				<input type="hidden" name="bank_id" id="bank_id">
				<input type="hidden" name="bank_codeCheck" id="bank_codeCheck">
				<input type="hidden" name="bank_lastModified" id="bank_lastModified">
				<input class="fieldinput" name="bank_code" id="bank_code" MaxLength="50" onBlurr="verifyBankCode(event);" exilDescField4="bank_codeCheck" exilDataSource4="bankCodeVerification" exilDataType="exilAlphaNumeric" exilMustEnte4r="false" >
			</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
			<td width="5%"><span class="labelcell2" ><b>&nbsp;&nbsp;&nbsp;List Of Existing Banks:</b></span></td>
		</tr>
		<tr >
			<td align="right" valign="center" width="12%" ><div align="right" class="smalllabelcell">Bank Name<span class="leadon">*</span></div></td>
			<td  align="left" valign="center" colspan="3" >
				<span class="fieldcell"><input  align=left  name="bank_name" id="bank_name" MaxLength="50" exilDataType="exilAnyChar" exilMustEnter="true" style="width:398;height:21" onkeyup="validateIgnoreNumber(this)"></span>
			</td>
			<td width="30%" align=left rowspan="2">
				<SELECT id="Bank_List"  name="Bank_List" class="labelcell" multiple style="WIDTH: 250px; HEIGHT: 124px" exilListSource="ListOfBanks">
				<option></option>
			 </SELECT>

			</td>
		</tr>

		<!-- <tr >
			<td align="right" valign="center" class="labelcell"><div align="right">Bank Type<span class="leadon">*</span></div></td>
			<td>
				<select class="fieldinput" name="bank_type" id="bank_type" MaxLength="50">
					<option value="Nationalised Banks" selected>Nationalised Banks</option>
					<option value="Other Scheduled Banks" >Other Scheduled Banks</option><OPTION
        value="Co-operative Banks">Co-operative Banks</OPTION><OPTION
        value="Post Office">Post Office</OPTION><OPTION
        value="Treasury Account">Treasury Account</OPTION>
				</select>
			</td>		 -->

			<!--<td><div align=right class="labelcell">Fund<span class="leadon">*</span></div></td>
			<td align=left><SELECT class=fieldinput id=bank_fundid name=bank_fundid exilMustEnter="true"
				 exilListSource="fundNameList"></SELECT></td>-->

		<!-- </tr> -->

		<tr >
			<td align="right" width="12%"><div align="right" class="smalllabelcell" valign="center">Narration</div></td>
			<td width="22%"><TEXTAREA class=narrationfieldinput id=bank_narration name=bank_narration rows=5 cols=40 exilDataType="exilAnyChar"></TEXTAREA>
			</td>
			<td width="19%" align="right"><div align="right" class="labelcell">Active</div></td>
			<td width="3%" align=left>
			<input type="checkbox"  name="bank_isActive" id="bank_isActive" value="1" checked="true">
			</td>
		</tr>

		<tr >
			<td colspan="4"><p class="smalltext"><span class="leadon">*</span>
			- Mandatory Fields</p>
			</td>
		</tr>
</table>
<table width="100%" border=0 cellpadding="3" cellspacing="0">
		<tr >
			<td colspan="4" align="middle"><!-- Buttons Start Here -->
				<table border="0" cellpadding="0" cellspacing="0">
					<tr name="trModify" id="trModify">
	 						<td width=100% align=center>
		 						<input type="button"  id="revsave" value="Submit" class="button" onclick="return ButtonPress('saveclose');"/>
		 						<input type="button" id="revclose" value="Close" class="button" onclick="window.close();" />
	 						</td>
					</tr>
					<tr name="trNew" id="trNew">
						 <td>
						 <input  id="savenNew" type="button" class="button" value="Save & New" onclick="return ButtonPress('savennew');"/>
						 <input   type="button" class="button" value="Save & Close" onclick="return ButtonPress('savenclose');" />
						 <input   type="button" class="button" value="Add Branch" onclick="addBranch()" />
						 <input   type="button" class="button" value="Cancel" onclick=onClickCancel(); />
						 <input   type="button" class="button" value="Close" onclick=window.close(); />
						 </td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

</form>

</body>
</html>
