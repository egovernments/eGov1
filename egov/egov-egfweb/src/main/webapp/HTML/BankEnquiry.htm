#-------------------------------------------------------------------------------
# eGov suite of products aim to improve the internal efficiency,transparency, 
#      accountability and the service delivery of the government  organizations.
#   
#       Copyright (C) <2015>  eGovernments Foundation
#   
#       The updated version of eGov suite of products as by eGovernments Foundation 
#       is available at http://www.egovernments.org
#   
#       This program is free software: you can redistribute it and/or modify
#       it under the terms of the GNU General Public License as published by
#       the Free Software Foundation, either version 3 of the License, or
#       any later version.
#   
#       This program is distributed in the hope that it will be useful,
#       but WITHOUT ANY WARRANTY; without even the implied warranty of
#       MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#       GNU General Public License for more details.
#   
#       You should have received a copy of the GNU General Public License
#       along with this program. If not, see http://www.gnu.org/licenses/ or 
#       http://www.gnu.org/licenses/gpl.html .
#   
#       In addition to the terms of the GPL license to be adhered to in using this
#       program, the following additional terms are to be complied with:
#   
#   	1) All versions of this program, verbatim or modified must carry this 
#   	   Legal Notice.
#   
#   	2) Any misrepresentation of the origin of the material is prohibited. It 
#   	   is required that all modified versions of this material be marked in 
#   	   reasonable ways as different from the original version.
#   
#   	3) This license does not grant any rights to any user of the program 
#   	   with regards to rights under trademark law for use of the trade names 
#   	   or trademarks of eGovernments Foundation.
#   
#     In case of any queries, you can reach eGovernments Foundation at contact@egovernments.org.
#-------------------------------------------------------------------------------
<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<SCRIPT LANGUAGE="javascript" SRC="../exility/PageManager.js"></SCRIPT>
<SCRIPT LANGUAGE="javascript" SRC="../exility/ExilityParameters.js"></SCRIPT>
<SCRIPT LANGUAGE="javascript" SRC="../exility/CookieManager.js"></SCRIPT>
<SCRIPT LANGUAGE="javascript" SRC="../exility/PageValidator.js"></SCRIPT>
<script language="javascript" src="../script/jsCommonMethods.js"></script>
<SCRIPT type="text/javascript" src="../script/calendar.js" type="text/javascript" ></SCRIPT>

<script language="javascript">
function getData(){
	//document.getElementById('bank_name').innerHTML="";
	var bankCode=document.getElementById('bank_name1').options[document.getElementById('bank_name1').selectedIndex].value;
	// commented by sumit
	//document.getElementById('bank_type').innerHTML="";
	document.getElementById('bank_narration').innerHTML="";
	document.getElementById('bank_isActive').innerHTML="";
	//document.getElementById('bank_fundname').innerHTML="";
	//var bankCode=document.getElementById('bank_code').value;
	if(bankCode == null || bankCode == ""){
		alert ('What do you want me to search on??');//changed from " to '
	}
	else{
		PageManager.DataService.setQueryField('bank_code',bankCode);
		PageManager.DataService.callDataService('bankData');
		var table=document.getElementById('bankBranchGrid');
		table.style.display="block";
		var gridHeading=document.getElementById('gridHeading');
		gridHeading.style.display="block";
	}
}
function loadBanksOnclick(obj)
{
	if(obj.checked)
		loadBanks('1');
	else
		loadBanks('0');
}
function loadBanks(objvalue)
{
	if(objvalue!="")
	{
		document.getElementById('bank_name1').options.length=0;
		var table=document.getElementById('bankBranchGrid');
		table.style.display="none";
		var obj=document.getElementById('bank_name1');
		obj.setAttribute('exilListSource','bankgrid');
		if(objvalue=='1')
			PageManager.DataService.setQueryField("isactive",objvalue);
		PageManager.DataService.callDataService("ListOfBanks");
	}
	
}
function getDataOnLoad()
{
	loadBanks('1');
		var bank_code = PageManager.DataService.getQueryField('bank_code');
	if (bank_code){
		PageManager.DataService.setQueryField('bank_code',bank_code);
		PageManager.DataService.callDataService('bankData');
		var table=document.getElementById('bankBranchGrid');
		table.style.display="block";
	}
	hideColumn(0);
}
function addNewBank(){
	//   ***1 only FO***,  ***2 FO***,  ***Admin, 3 All***    //
	if(!isValidUser(2, CookieManager.getCookie('userRole')) ) return false;

	window.location="BankAdd.htm";
}

function addNewBranch(){
	//   ***1 only FO***,  ***2 FO***,  ***Admin, 3 All***    //
	if(!isValidUser(2, CookieManager.getCookie('userRole')) ) return false;

	var bank_code=document.getElementById('bank_code').value;
	var bank_name=document.getElementById('bank_name1').innerHTML;

	if(bank_code && bank_code.length!=0 && bank_name && bank_name.length!=0){
		window.location="BankBranchAdd.htm?newBank=0&bank_code="+document.getElementById('bank_code').value;
	}
	else{
		alert('Please give Code and Name of the Bank');
	}
}
function branchEnquiry(obj){
	var row=PageManager.DataService.getRow(obj);
	var table=document.getElementById('bankBranchGrid');
	var v=PageManager.DataService.getControlInBranch(table.rows[row.rowIndex],"bankBranch_branchId");
	var branchId=v.innerHTML;
	window.location="BankBranchEnquiry.htm?newBank=0&bankBranch_branchId="+branchId+"&bank_code="+document.getElementById('bank_code').value;

}
function hideColumn(index){
	var table=document.getElementById('bankBranchGrid');
   	for(var i=0;i<table.rows.length;i++){
   		table.rows[i].cells[index].style.display="none";
   	}
}
function beforeRefreshPage(dc){

	if(dc.values['serviceID']!='ListOfBanks')
	{
		var tObj=dc.grids['bankBranchGrid'];
		if(!tObj) return false;
		for(var i=1; i<tObj.length; i++){
			if(!tObj[i][3] || tObj[i][3].length==0){
				tObj[i][3]="---";
				}
			if(!tObj[i][5] || tObj[i][5].length==0){
				tObj[i][5]="---";
				}
		}
		dc.grids['bankBranchGrid']=tObj;
		return true;
	}
}
function afterRefreshPage(dc)
{
	if(dc.values['serviceID']=='ListOfBanks')
	{
		PageManager.DataService.removeQueryField("isactive");
	}
	if(dc.values['bank_isActive']=='1')
		document.getElementById('bank_isActive').innerHTML="Yes";
	else if(dc.values['bank_isActive']=='0')
		document.getElementById('bank_isActive').innerHTML="No";
	if(dc.values['serviceID']=='bankData')
		{
			var bankCodeToSelect=PageManager.DataService.getQueryField('bank_code');
			var bankNamesObj=document.getElementById('bank_name1'); 
			for(var i=0;i<bankNamesObj.length;i++)
			if(bankNamesObj.options[i].value==bankCodeToSelect) { bankNamesObj.selectedIndex=i;  break; }
		}
	return true;
	
}

function onClickModify(){
	//   ***1 only FO***,  ***2 FO***,  ***Admin, 3 All***    //
	var retVal = isValidUser(2, CookieManager.getCookie('userRole'));
	if(!retVal ) return false;
	
	var bank_code=document.getElementById('bank_code').value;
	var bank_name=document.getElementById('bank_name1').innerHTML;
	var bankObj=document.getElementById('bank_name1');
	
	var bankName=new Object();
	if(bankObj.selectedIndex!=-1)
		bankName=bankObj.options[bankObj.selectedIndex].text ; 

	if(bank_code && bank_code.length!=0 && bank_name && bank_name.length!=0){
		window.location="BankAdd.htm?bank_code="+bank_code+"&bankName="+bankName;
	}
	else{
		alert('Please give Code and Name of the Bank');
	}
}
/*function openSearch(obj){
         var a = new Array(2);
         var sRtn = showModalDialog("Search.html?tableNameForCode=bank","","dialogLeft=300;dialogTop=210;dialogWidth=305pt;dialogHeight=300pt;status=no;");
         if ( sRtn != '' )
	       {
	        a = sRtn.split(",");
			var x =PageManager.DataService.getControlInBranch(obj.parentNode,'bank_code');
			var y =PageManager.DataService.getControlInBranch(obj.parentNode.parentNode ,'bank_name1');

			x.value = a[0];
			y.innerHTML = a[1];
		   }
		   getData();
         }*/
</script>
</head>
<body bgcolor="#ffffff" onKeyDown ="CloseWindow(event);" bottommargin="0" topmargin="0" rightmargin="0" leftmargin="0" marginheight="0" marginwidth="0" onLoad="getDataOnLoad()"><!------------------ Header Begins Begins--------------------->

<form name="BankEnquiry">
	<table width="100%" border=0 cellpadding="3" cellspacing="0">

		
		<tr  >
		    <td align="right" width="10%"><div class="labelcell" >Bank&nbsp;Name </div></td>
			<td width=20%> 
			<div class="smallfieldcell">
				<select id="bank_name1" name="bank_name1" exilMustEnter="true" style="width:413; height:16" onchange="getData();" exilListSource="ListOfBanks">
			 </select> </div>
            </td>
            <td align="right" width="10%"><div class="labelcell" >Active Banks</div></td>
            <td>
            	<input type="checkbox"  name="loadActive" id="loadActive" checked=true value=1 onclick=loadBanksOnclick(this)>
            </td>
			
			<td width=10%><div class="labelcell" align="right" style="display:none">Bank Code<span class="leadon">*</span></div></td>
						<td ><input type="hidden" name="bank_id" id="bank_id">
				<input name="bank_code" class="fieldinput" id="bank_code"
      MaxLength="50" size="10" exilMustEnter="true" exilDataType="exilAlphaNumeric" style="DISPLAY:NONE">
				<!--IMG onclick=openSearch(this) height=22 src="/egi/resources/erp2/images/plus1.gif" width=25 align=top border=0 >&nbsp;&nbsp;<input type="button" value="Go" class="leadon" onClick="getData();" id=button1 name=button1-->
			</td>			
			<!--span id="bank_name" name="bank_name" class="displayData" width="213" exilTrimLength="20"></span--></td>
		</tr>
		<!-- Commented By sumit -->
		<!-- <tr  >
			<td align="right" class="labelcell" >Bank&nbsp;Type</td>
			<td ><span id="bank_type" name="bank_type" class="displayData"></span>
			</td>
					<!--<td align="right" class="labelcell" >Fund</td>
					<td  ><span id="bank_fundname" name="bank_fundname" class="displayData"></span>
					</td>--> <!-- commented Earlier -->
			<!-- <td></td>
			<td></td>
		</tr>
		 -->
		<tr  >
			<td align="right"  ><div class="labelcell" >Narration</div></td>
			<td ><span id="bank_narration" class="displayData" exilTrimLength="20"></span>
			</td>
			<td align="right" ><div class="labelcell">Active</div></td>
			<td width=10%><span id="bank_isActive" name="bank_isActive" class="displayData">&nbsp;</span>
			</td>
		</tr>

		<tr  >
			<td height="25" colspan="4" valign="bottom" class="smalltext" ><p class="smalltext"><span class="leadon">*</span>
			- Mandatory Fields</p>
			</td>
		</tr>

		<tr   width="100%">
			<td colspan="4" align="middle" ><!-- Buttons Start Here -->
				<table border="0" cellpadding="0" cellspacing="0"  align="center">
							 <tr>
							 <td>
							 <input  id="saveandnew" type="button" class="button" value="Modify" onclick="onClickModify();"/>
							 <input  style="display:none" type="button" class="button" value="Add Bank" onclick="addNewBank();" />
							 <input   type="button" class="button" value="Add Branch" onclick="addNewBranch()" />
							 <input   type="button" class="button" value="Close" onclick=window.close(); />
							 </td>
						</tr></table>
			</td>
		</tr>

		<tr   id="gridHeading" style="DISPLAY: none">
			<td colspan="4"  align="middle"><span class="headerblack2" >Branch&nbsp;Detail</span></td>
		</tr>

		<tr  >
			<td colspan="4" align="center" ><!-- Buttons Start Here -->
				<table border="1" width="100%" cellpadding="0" cellspacing="0" name="bankBranchGrid" ID="bankBranchGrid" style="DISPLAY: none">
					<tr class="thStlyle">
						<td><div align="center" >&nbsp;</div></td>
						<td ><div align="center" >Branch Name</div></td>
						<td ><div align="center" >Address</div></td>
						<td><div align="center" >Contact Person</div></td>
						<td ><div align="center" >Phone No</div></td>
						<td ><div align="center" >Narration</div></td>
					</tr>

					<tr class=labelcell>
						<td><div  name="bankBranch_branchId" id="bankBranch_branchId" >&nbsp;</div></td>
						<td><A onclick=branchEnquiry(this) href="#"><div name="bankBranch_branchName" id="bankBranch_branchName" class=labelcell  exilTrimLength="20" style="width:" >&nbsp;</div></A></td>
						<td><div name="bankBranch_branchAddress" id="bankBranch_branchAddress" class="labelcell" exilTrimLength="20" style="width:">&nbsp;</div></td>
						<td><div name="bankBranch_contactPerson" id="bankBranch_contactPerson" class="smalllabelcell" exilTrimLength="15" style="width:">&nbsp;</div></td>
						<td><div name="bankBranch_branchPhone" id="bankBranch_branchPhone" class="labelcell" style="width:">&nbsp;</div></td>
						<td><div name="bankBranch_narration" id="bankBranch_narration" class="labelcell" exilTrimLength="15" style="width:">&nbsp;</div></td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
</form>

</body>
</html>
