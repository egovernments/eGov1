#-------------------------------------------------------------------------------
# eGov suite of products aim to improve the internal efficiency,transparency, 
#      accountability and the service delivery of the government  organizations.
#   
#       Copyright (C) <2015>  eGovernments Foundation
#   
#       The updated version of eGov suite of products as by eGovernments Foundation 
#       is available at http://www.egovernments.org
#   
#       This program is free software: you can redistribute it and/or modify
#       it under the terms of the GNU General Public License as published by
#       the Free Software Foundation, either version 3 of the License, or
#       any later version.
#   
#       This program is distributed in the hope that it will be useful,
#       but WITHOUT ANY WARRANTY; without even the implied warranty of
#       MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#       GNU General Public License for more details.
#   
#       You should have received a copy of the GNU General Public License
#       along with this program. If not, see http://www.gnu.org/licenses/ or 
#       http://www.gnu.org/licenses/gpl.html .
#   
#       In addition to the terms of the GPL license to be adhered to in using this
#       program, the following additional terms are to be complied with:
#   
#   	1) All versions of this program, verbatim or modified must carry this 
#   	   Legal Notice.
#   
#   	2) Any misrepresentation of the origin of the material is prohibited. It 
#   	   is required that all modified versions of this material be marked in 
#   	   reasonable ways as different from the original version.
#   
#   	3) This license does not grant any rights to any user of the program 
#   	   with regards to rights under trademark law for use of the trade names 
#   	   or trademarks of eGovernments Foundation.
#   
#     In case of any queries, you can reach eGovernments Foundation at contact@egovernments.org.
#-------------------------------------------------------------------------------
<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
		<meta http-equiv="KEYWORDS" content="">
		<meta http-equiv="DESCRIPTION" content="">
		<!-- Inclusion of the CSS files that contains the styles -->
		<link rel="stylesheet" href="../css/egov.css" type="text/css">
		<SCRIPT LANGUAGE="javascript" SRC="../exility/PageValidator.js"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="../exility/PageManager.js"></SCRIPT>
			<script language="javascript" src="../script/jsCommonMethods.js"></script>
		<SCRIPT LANGUAGE="javascript" SRC="../exility/ExilityParameters.js"></SCRIPT>
		<SCRIPT LANGUAGE="javascript" SRC="../exility/CookieManager.js"></SCRIPT>
		  <SCRIPT type="text/javascript" src="../script/calendar.js" type="text/javascript" ></SCRIPT>

	<script language="javascript">
	/*
	function formatDates(ctrl){
		ctrl.innerHTML=formatDate(ctrl.innerHTML.substring(0, 10));
	}

	function openSearch(obj){
		var a = new Array(2);
		var sRtn = showModalDialog("Search.html?tableNameForCode=chartOfAccounts","","dialogLeft=300;dialogTop=210;dialogWidth=305pt;dialogHeight=300pt;status=no;");
		if(sRtn != '')
		{
			a = sRtn.split(",");

	 		var x = PageManager.DataService.getControlInBranch(obj.parentNode,'chartOfAccounts_glCode');
	 		x.value = a[0];
	 		document.getElementById('chartOfAccounts_name').innerHTML = a[1];
		}
	}
	function getFiscalPeriod(){
		if(!document.setUp.radioAction[0].checked && !document.setUp.radioAction[1].checked){
			alert('please select activity first');
			return false;
		}

		var ctrl = document.getElementById('financialYear_id');
		var financialYearId = ctrl.options[ctrl.selectedIndex].value;

		PageManager.DataService.setQueryField('financialYearId', financialYearId);
		if(document.setUp.radioAction[0].checked)
			PageManager.DataService.callDataService('fiscalPeriodToOpen');
		else if(document.setUp.radioAction[1].checked)
			PageManager.DataService.callDataService('fiscalPeriodToClose');

		var obj = document.getElementById('checkAll');
		obj.checked = false;
		onClickCheckAll(obj);
	}
	function onClickIsActive(obj){
		if(!obj.checked) document.getElementById('checkAll').checked = false;
		row=PageManager.DataService.getRow(obj);
		table = document.getElementById('gridFiscalPeriod');
		t=PageManager.DataService.getControlInBranch(table.rows[row.rowIndex].cells[3],"fiscalPeriod_isActive");
		t.value = obj.checked ? 1 : 0;

		var i, tableObj = document.getElementById('gridFiscalPeriod');
			if(!tableObj) return ;

		document.getElementById('fiscalPeriod_isActiveAll').value = 0;
		for(i=1; i<tableObj.rows.length; i++)
		{
			if(tableObj.rows.length == 2) obj = document.setUp.isActive;
			else obj = document.setUp.isActive[i-1];
			if(!obj.checked) return;
		}
		document.getElementById('checkAll').checked = true;
		document.getElementById('fiscalPeriod_isActiveAll').value = 1;
	}
	function onClickCheckAll(obj){
		var checkValue = false, textValue = 0, len=0, i;
		if(obj.checked) {
			checkValue = true,
			textValue = 1;
			document.getElementById('fiscalPeriod_isActiveAll').value = 1;
		}
		else
			document.getElementById('fiscalPeriod_isActiveAll').value = 0;

		tableObj = document.getElementById('gridFiscalPeriod');
			if(!tableObj) return ;

		for(i=1; i<tableObj.rows.length; i++)
		{
			if(tableObj.rows.length == 2) obj = document.setUp.isActive;
			else obj = document.setUp.isActive[i-1];

			row=PageManager.DataService.getRow(obj);
			table = document.getElementById('gridFiscalPeriod');

			obj.checked = checkValue;
			t=PageManager.DataService.getControlInBranch(table.rows[row.rowIndex].cells[3],"fiscalPeriod_isActive");
			t.value = textValue;
		}
	}
	function submitForm(){
		//   ***1 only FO***,  ***2 FO***,  ***Admin, 3 All***    //
		if(!isValidUser(2, CookieManager.getCookie('userRole')) ) return false;

		if(!validate()){
			alert('please check any fiscal period');
			return false;
		}

		if(!PageValidator.validateForm())
			return false;

		PageManager.UpdateService.submitForm('setUp');
	}
	function validate(){
		var i, tableObj;

		tableObj = document.getElementById('gridFiscalPeriod');
			if(!tableObj) return false;

		for(i=1; i<tableObj.rows.length; i++)
		{
			if(tableObj.rows.length == 2) obj = document.setUp.isActive;
			else obj = document.setUp.isActive[i-1];

			row=PageManager.DataService.getRow(obj);
			table = document.getElementById('gridFiscalPeriod');

			t=PageManager.DataService.getControlInBranch(table.rows[row.rowIndex].cells[3],"isActive");
			if(t.checked) return true;
		}
		return false;
	}*/

	function onBodyLoad(){
		PageValidator.addCalendars();
		PageManager.DataService.callDataService('databaseDate');
		//PageManager.ListService.callListService();
	}

	function beforeRefreshPage(dc){}
	function afterRefreshPage(dc){}

	function onRadioClick(){
		var gridFinancialYear = document.getElementById('gridFinancialYear');
		var gridButtons = document.getElementById('gridButtons');
		var rowPeriodOpen = gridFinancialYear.rows[1];
		var rowFY = gridFinancialYear.rows[2];
		var rowCalcCB = gridFinancialYear.rows[3];
		var rowPeriodClose = gridFinancialYear.rows[4];
		var rowhardClose = gridFinancialYear.rows[5];


		rowPeriodOpen.style.display = 'none';
		rowFY.style.display = 'none';
		rowCalcCB.style.display = 'none';
		rowPeriodClose.style.display = 'none';
		rowhardClose.style.display = 'none';
		document.getElementById('closedPeriods_startingDate').removeAttribute('exilMustEnter');
		document.getElementById('closedPeriods_endingDate').removeAttribute('exilMustEnter');
		document.getElementById('financialYear_id').removeAttribute('exilMustEnter');
		document.getElementById('closedPeriods_id').removeAttribute('exilMustEnter');
		clearFields();
		if(document.setUp.radioAction[0].checked){
			document.getElementById('activity').value = 'OFY'; //Open Financial Year
			rowFY.style.display = 'block';
			PageManager.DataService.callDataService('financialYearToOpen');
			document.getElementById('financialYear_id').setAttribute('exilMustEnter','true');
		}
		else if(document.setUp.radioAction[1].checked){
			document.getElementById('activity').value = 'CFY'; //Close Financial Year
			rowFY.style.display = 'block';
			rowCalcCB.style.display = 'block';
			PageManager.DataService.callDataService('financialYearToClose');
			document.getElementById('financialYear_id').setAttribute('exilMustEnter','true');
		}
		else if(document.setUp.radioAction[2].checked){
			document.getElementById('activity').value = 'OP'; //Open Period
			rowPeriodOpen.style.display = 'block';
			PageManager.DataService.callDataService('periodToOpen');
			document.getElementById('closedPeriods_id').setAttribute('exilMustEnter','true');
		}
		else if(document.setUp.radioAction[3].checked){
			document.getElementById('activity').value = 'CP'; //Close Period
			rowPeriodClose.style.display = 'block';
			rowhardClose.style.display = 'block';
			rowFY.style.display = 'block';
			PageManager.DataService.callDataService('financialYearToClose');
			document.getElementById('financialYear_id').setAttribute('exilMustEnter','true');
			document.getElementById('closedPeriods_startingDate').setAttribute('exilMustEnter','true');
			document.getElementById('closedPeriods_endingDate').setAttribute('exilMustEnter','true');
			document.getElementById('hardClose').setAttribute('exilMustEnter','true');
		}else if(document.setUp.radioAction[4].checked){
			document.getElementById('activity').value = 'CB'; //Closing Balance
			rowFY.style.display = 'block';
			PageManager.DataService.callDataService('financialYearToCB');
			document.getElementById('financialYear_id').setAttribute('exilMustEnter','true');
		}

		gridFinancialYear.style.display = 'block';
		gridButtons.style.display = 'block';
		document.getElementById('buttonTableClose').style.display = 'none';
	}

	function onHardClose(obj){
		if(obj.checked) document.getElementById('rangehardClose').value = 1;
		else document.getElementById('rangehardClose').value = 0;
	}

	function ButtonPress(name){
		//   ***1 only FO***,  ***2 FO***,  ***Admin, 3 All***    //
		if(!isValidUser(2, CookieManager.getCookie('userRole')) ) return false;
		var startDate = document.getElementById('closedPeriods_startingDate').value;
		var endDate = document.getElementById('closedPeriods_endingDate').value;
		var todayDate = document.getElementById('databaseDate').value;
		if(compareDate(formatDate6(startDate), formatDate6(endDate)) == -1){
			alert('Starting Date is greater than Ending Date');
			return false;
		}
		if(!PageValidator.validateForm())
			{
			return false;
			}
		if(document.setUp.radioAction[3].checked && compareDate(formatDate6(endDate), formatDateToDDMMYYYY4(todayDate)) != 1){
			alert('todays date can not be closed');
			return false;
		}
	
		if(document.setUp.radioAction[1].checked && !(document.setUp.calcClBal.checked)){
		}
		else if(document.setUp.radioAction[1].checked && document.setUp.calcClBal.checked){
			document.getElementById('activity').value = 'CFNEW';

			}
		PageManager.UpdateService.submitForm('setUp'); 
	}
	function clearFields(){
		document.getElementById('closedPeriods_startingDate').value = '';
		document.getElementById('closedPeriods_endingDate').value = '';
		var yrCombo = document.getElementById('financialYear_id');
		var rangeCombo = document.getElementById('closedPeriods_id');
		var i;
		for(i=yrCombo.length-1; i>=0; i--)
			yrCombo.remove(i);
		for(i=rangeCombo.length-1; i>=0; i--)
			rangeCombo.remove(i);
	}

	function afterUpdateService(){
		window.location = "/EGF/HTML/SetUp.htm"
	}
	function onClickCancel()
	{
	window.location="SetUp.htm";
	}
	</script>

	</head>

	<body onLoad="onBodyLoad()" bgcolor="#ffffff" bottommargin="0" topmargin="0" rightmargin="0" leftmargin="0"
		 marginheight="0" marginwidth="0" onKeyDown ="CloseWindow(event);" ><!------------------ Header Begins Begins--------------------->

		<form name="setUp">
			<table width="100%" border="0" cellpadding="1" cellspacing="0" id=TABLE1>
				<tr>
					<td valign="top"><!------------Content begins here ------------------>
						<table width="100%" border="0" cellpadding="3" cellspacing="0" name="TABLE1" id=TABLE1>
							<tr  >
								<td colspan=4>
									<table width="100%" border="0" cellpadding="1" cellspacing="0" id=TABLE1>
										<tr  >
											<td width="30%" class="labelcell" align="right"></td>
											<td width="10%" align="left" style="VISIBILITY: hidden"><input type="radio" value="activate" id=radioAction name=radioAction onClick="onRadioClick()"  ></td>
											<td width="30%"   align="right"><span class="labelcell">Close&nbsp;Financial Year</span></td>
											<td width="20%" align="left"><input type="radio" id=radioAction value="close" name=radioAction onClick="onRadioClick()"></td>
										</tr>
										<tr  >
											<td   align="right"><span class="labelcell">Re Open Date Range</span></td>
											<td align="left"><input type="radio" value="activate" id=radioAction name=radioAction onClick="onRadioClick()" ></td>
											<td   align="right"> <span class="labelcell">Close&nbsp;Date Range</span></td>
											<td align="left"><input type="radio" id=radioAction value="close" name=radioAction onClick="onRadioClick()"><INPUT type="hidden" id=activity name=activity></td>
										</tr>
										<tr  >
											<td   align="right"><span class="labelcell">Transfer&nbsp;Closing Balance</span></td>
											<td align="left"><input type="radio" value="activate" id=radioAction name=radioAction onClick="onRadioClick()" ></td>
											<td></td>
											<td></td>
										</tr>
									</table>
								</td>
							</tr>
							<tr  >
								<td colspan=4>
									<table width="100%" border="0" cellspacing="0" name="gridFinancialYear" cellpdding="1" id='gridFinancialYear' style="DISPLAY: none">
										<tr  >
											<td width="25%">&nbsp;</td>
											<td width="25%"></td>
											<td width="25%"></td>
											<td width="25%"></td>
										</tr>
										<tr   style="DISPLAY: none">
											<td colspan=2 align="right" valign="center"  ><span class="labelcell">Select Date Range<span class="leadon">*</span></span></td>
											<td colspan=2><span class="smallfieldcell">
											<SELECT id="closedPeriods_id" name="closedPeriods_id" class="fieldinput" exilListSource="periodList" style="width:163; height:17"></SELECT></span></td>
										</tr>
										<tr   style="DISPLAY: none">
											<td colspan=2 align="right" valign="center"  ><span class="labelcell">Select Financial Year<span class="leadon">*</span></span></td>
											<td colspan=2><span class="smallfieldcell"><SELECT id="financialYear_id" name="financialYear_id" class="fieldinput" exilListSource="financialYearList"></SELECT></span></td><!--<td class="labelcell">Hard Close&nbsp;<input type="checkbox" id="fy_hardClose" name="fy_hardClose" onClick="hardClose(this)"><input type="hidden" id="financialYear_hardClose" name="financialYear_hardClose"></td>-->
										</tr>
										<tr   style="DISPLAY: none">
											<td colspan=2 align="right" valign="center"  ><span class="labelcell">Transfer&nbsp;Closing Balance</span></td>
											<td colspan=2><input type="checkbox" name="calcClBal" id="calcClBal"></td>
										</tr>
										<tr   style="DISPLAY: none">
											<td align="right" valign="center" ><span class="labelcell">Starting Date<SPAN class=leadon>*</SPAN></span></td>
											<td align="left"><span class="smallfieldcell"><input name="closedPeriods_startingDate" id="closedPeriods_startingDate" maxlength="11" size="12" onkeyup="DateFormat(this,this.value,event,false,'3')"  exilCalendar="true" exilDataType="exilPastDate"></span></td>
											<td align="right" valign="center" ><span class="labelcell">Ending&nbsp;Date<SPAN class=leadon>*</SPAN></span></td>
											<td><span class="smallfieldcell"><input class=datefieldinput id=closedPeriods_endingDate maxLength=11 name="closedPeriods_endingDate" onkeyup="DateFormat(this,this.value,event,false,'3')"  exilCalendar="true" exilDataType="exilPastDate" exilMustEnter="true"></span></td>
										</tr>
										<tr   style="DISPLAY: none">
											<td align="right" valign="center" ><span class="labelcell">Hard Close<SPAN class=leadon>*</SPAN></span></td>
											<td align="left"><input type="checkbox" name="hardClose" id="hardClose" onClick="onHardClose(this)"><input type="hidden" name="rangeHardClose" id="rangeHardClose"></td>
											<td></td>
											<td></td>
										</tr>
									</table>
								</td>
							</tr><!--
							<tr  >
								<td colspan=4>
									<table width="80%" align=center border="1" cellpadding="0" cellspacing="0" name="gridFiscalPeriod" id="gridFiscalPeriod" style="VISIBILITY: hidden">
										<tr class="rowheader" style="HEIGHT: 15px">
											<td width="30%" align=middle><span class="headerwhite2">Fiscal Period
							  Name</span></td>
											<td width="30%" align=middle><span class="headerwhite2">Starting Date</span></td>
											<td width="30%" align=middle><span class="headerwhite2">Ending Date</span></td>
											<td width="10%" align=middle><span class="headerwhite2"><INPUT id=checkAll onclick=onClickCheckAll(this) type=checkbox name=checkAll><input type="hidden" value=0 name="fiscalPeriod_isActiveAll" id="fiscalPeriod_isActiveAll">&nbsp;Check</span></td>
										</tr>
										<tr >
											<td class="labelcell"><div align="center" name="fiscalPeriod_name" id="fiscalPeriod_name">&nbsp;</div><input type="hidden" name="fiscalPeriod_id" id="fiscalPeriod_id" exilDataType="exilAnyChar"></td>
											<td class="labelcell"><div align="center" name="fiscalPeriod_startingDate" id="fiscalPeriod_startingDate">&nbsp;</div></td>
											<td class="labelcell"><div align="center" name="fiscalPeriod_endingDate" id="fiscalPeriod_endingDate">&nbsp;</div></td>
											<td class="labelcell" align=middle><input type="checkbox" name="isActive" id="isActive" onClick="onClickIsActive(this)"><input type="hidden" value=0 name="fiscalPeriod_isActive" id="fiscalPeriod_isActive"></td>
										</tr>
									</table>
								</td>
							</tr>
							-->
						</table>
					</td>
				</tr><!--  Buttons for Request Form starts here -->
				<tr  >
					<td align=left height="25" colspan="4" valign="bottom" class="smalltext"><p class="smalltext"><span class="leadon">*</span>
						- Mandatory Fields</p>
					</td>
				</tr>
				<tr  >
					<td colspan="4" align="middle"><!-- Buttons Start Here -->
						<table border="0" cellpadding="0" cellspacing="0"  align="center" name="gridButtons" id="gridButtons" style="DISPLAY: none">
							 <tr >
							 <td>
							 <input   type="button" class="button" value="Submit" onclick="ButtonPress('savenew');" />
							 <input   type="button" class="button" value="Cancel" onclick="onClickCancel()" />
							 <input   type="button" class="button" value="Close" onclick=window.close(); />
							 </td>
						</tr></table><!-- Buttons End Here -->

					</td>
				</tr>

			</table><!------------ Content ends here ------------------>
			<table border="0" cellpadding="0" cellspacing="0"  align="center"   ID="buttonTableClose">
				 <tr >
				 <td>
				 <input   type="button" class="button" value="Close" onclick=window.close(); />
				 </td>
			</tr></table><!------------ Content ends here ------------------><!------------Right Navigation Ends here------------------><!---------------- Footer begins here ----------><!---------------- Footer ends here ---------->
		<input type=hidden name=databaseDate  id=databaseDate>
		</form>

	</body>
</html>
