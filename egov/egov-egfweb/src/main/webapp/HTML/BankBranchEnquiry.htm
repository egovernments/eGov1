#-------------------------------------------------------------------------------
# eGov suite of products aim to improve the internal efficiency,transparency, 
#      accountability and the service delivery of the government  organizations.
#   
#       Copyright (C) <2015>  eGovernments Foundation
#   
#       The updated version of eGov suite of products as by eGovernments Foundation 
#       is available at http://www.egovernments.org
#   
#       This program is free software: you can redistribute it and/or modify
#       it under the terms of the GNU General Public License as published by
#       the Free Software Foundation, either version 3 of the License, or
#       any later version.
#   
#       This program is distributed in the hope that it will be useful,
#       but WITHOUT ANY WARRANTY; without even the implied warranty of
#       MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#       GNU General Public License for more details.
#   
#       You should have received a copy of the GNU General Public License
#       along with this program. If not, see http://www.gnu.org/licenses/ or 
#       http://www.gnu.org/licenses/gpl.html .
#   
#       In addition to the terms of the GPL license to be adhered to in using this
#       program, the following additional terms are to be complied with:
#   
#   	1) All versions of this program, verbatim or modified must carry this 
#   	   Legal Notice.
#   
#   	2) Any misrepresentation of the origin of the material is prohibited. It 
#   	   is required that all modified versions of this material be marked in 
#   	   reasonable ways as different from the original version.
#   
#   	3) This license does not grant any rights to any user of the program 
#   	   with regards to rights under trademark law for use of the trade names 
#   	   or trademarks of eGovernments Foundation.
#   
#     In case of any queries, you can reach eGovernments Foundation at contact@egovernments.org.
#-------------------------------------------------------------------------------
<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>

<script LANGUAGE="javascript">
var bankBranch_Id_Old;

function getDataOnLoad(){
	var bank_code = PageManager.DataService.getQueryField('bank_code');
	bankBranch_Id_Old=PageManager.DataService.getQueryField('bankBranch_branchId');
	var bankBranch_branchId = PageManager.DataService.getQueryField('bankBranch_branchId');
	if (bank_code && bankBranch_branchId){
		PageManager.DataService.callDataService('branchEnquiryNew');
	}
	hideColumn(0);
	window.accRowIndex=-1;
}

function getData(){
	//document.getElementById('bankBranch_branchName').innerHTML="";
	document.getElementById('bankBranch_branchAddress1').innerHTML="";
	document.getElementById('bankBranch_branchAddress2').innerHTML="";
	document.getElementById('bankBranch_branchCity').innerHTML="";   
	document.getElementById('bankBranch_branchPin').innerHTML="";
	document.getElementById('bankBranch_branchMICR').innerHTML="";
	document.getElementById('bankBranch_branchPhone').innerHTML="";
	document.getElementById('bankBranch_branchFax').innerHTML="";
	document.getElementById('bankBranch_contactPerson').innerHTML="";
	document.getElementById('bankBranch_narration').innerHTML="";
	document.getElementById('bankBranch_isActive').innerHTML="";
	var branchId=document.getElementById('bankBranch_branchName1').options[document.getElementById('bankBranch_branchName1').selectedIndex].value;
	if(branchId == null || branchId == ""){
		alert ("what do you want me to search on??");
	}
	else{
	
		PageManager.DataService.setQueryField('bankBranch_branchId',branchId);   
		PageManager.DataService.callDataService('branchEnquirySearch');
	}
}
function hideColumn(index){
   		var table=document.getElementById('bankAccountGrid');
   		for(var i=0;i<table.rows.length;i++){
   			 table.rows[i].cells[index].style.display="none";
   		}
}
function addNewBranch(){
	//   ***1 only FO***,  ***2 FO***,  ***Admin, 3 All***    //
	if(!isValidUser(2, CookieManager.getCookie('userRole')) ) return false;

	var bank_code=document.getElementById('bank_code').innerHTML;

	if(bank_code){
		window.location="BankBranchAdd.htm?bank_code="+bank_code+"&newBank=0";
	}
	else{
		alert('Please give Code and Name of the Bank');
	}
}

function afterRefreshPage(dc){
//alert(dc.values['serviceID']);

	if('branchEnquiryNew'==dc.values['serviceID'] )//&& !(occurance==0)
    {
       tempList=dc.grids['bankBranch_branchName'];
		var brchName=document.getElementById('bankBranch_branchName1');
		
		//var acctType=PageManager.DataService.getControlInBranch(table.rows[rowActType],'bankAccount_accountTypeID');
		var option;
		//for(var i=0; i<accEntityList.length; i++)
		//alert("now works");
		if(tempList!=null && tempList.length>0)
		{
		
		//alert(brchName.options.length);
			for(var i=0;i<brchName.options.length;i++)
			{
			
			brchName.remove(i);
			
			}   
			brchName.options.length=0;
			for(var i=0;i<tempList.length;i++)
			{
				option=new Option(tempList[i][1],tempList[i][0]);
				brchName.options.add(option);
			}
			brchName.value=bankBranch_Id_Old;
			    
		}
	
	}

	if(dc.values['bankBranch_isActive']=='1')
		document.getElementById('bankBranch_isActive').innerHTML="Active";
	else if(dc.values['bankBranch_isActive']=='0')
		document.getElementById('bankBranch_isActive').innerHTML="InActive";
	var chkObjs=document.getElementsByName('bankAccount_isActiveCB');
	for(var i=0;i<chkObjs.length;i++){
		if(chkObjs[i].innerHTML=="0") chkObjs[i].innerHTML="InActive";
		else chkObjs[i].innerHTML="Active";

	}
	tempList=dc.grids['bankAccountGrid'];
	return true;
}
//added by rashmi
function addAccount(){
	//   ***1 only FO***,  ***2 FO***,  ***Admin, 3 All***    //
	if(!isValidUser(2, CookieManager.getCookie('userRole')) ) return false;

	//var table=document.getElementById('bankAccountGrid');
	var BranchId=document.getElementById('bankBranch_branchId').value;
	//var fundTemp=document.getElementById('fund_name').innerHTML	//added by sumit
	//var fundTemp = PageManager.DataService.getControlInBranch(table.rows[window.fundRowIndex], "fund_name").innerHTML;
	//var accNoTemp = PageManager.DataService.getControlInBranch(table.rows[window.accRowIndex], "bankAccount_accountNumber").innerHTML;//added by sumit

	//var accTypeTemp = PageManager.DataService.getControlInBranch(table.rows[window.accRowIndex], "bankAccount_accountType").innerHTML;//added by sumit

	//alert(accNoTemp);

	if(BranchId){
	//window.location="BankBranchAdd.htm?bankBranch_branchId="+BranchId+"&bank_code="+document.getElementById('bank_code').innerHTML;//changed by sumit
	var url="BankBranchAdd.htm?newAccount=1&bankBranch_branchId="+BranchId+"&bank_code="+document.getElementById('bank_code').innerHTML;
				window.open(url,"","height=650,width=900,scrollbars=yes,left=0,top=0,status=yes");
	}
	else{
		alert('Please give Code and Name of the Branch');
	}
}
//added by chetan, To get modify Bank Branch screen.
function onClickBranchModify(){
	if(!isValidUser(2, CookieManager.getCookie('userRole')) ) return false;
	var BranchId=document.getElementById('bankBranch_branchId').value;
	//var temp_rao = 0;
	if(BranchId){	window.location="BankBranchAdd.htm?newAccount=0&addAccDisp=0&bankBranch_branchId="+BranchId+"&bank_code="+document.getElementById('bank_code').innerHTML;
	}
}

function onClickModify(){
	//   ***1 only FO***,  ***2 FO***,  ***Admin, 3 All***    //
	if(!isValidUser(2, CookieManager.getCookie('userRole')) ) return false;
	if(window.accRowIndex<=0) {
			alert(' Select Account No ');
			return;
		}//added by sumit
	var table=document.getElementById('bankAccountGrid');
	var BranchId=document.getElementById('bankBranch_branchId').value;
	var fundTemp=PageManager.DataService.getControlInBranch(table.rows[window.accRowIndex], "fund_id").value;  
	var pay_To=PageManager.DataService.getControlInBranch(table.rows[window.accRowIndex], "pay_To").innerHTML;
	if( pay_To==' ') pay_To='';
	//var fundTemp=document.getElementById('fund_name').innerHTML	//added by sumit
	//var fundTemp = PageManager.DataService.getControlInBranch(table.rows[window.fundRowIndex], "fund_name").innerHTML;
	var accNoTemp = PageManager.DataService.getControlInBranch(table.rows[window.accRowIndex], "bankAccount_accountNumber").innerHTML;//added by sumit

	//var accTypeTemp = PageManager.DataService.getControlInBranch(table.rows[window.accRowIndex], "bankAccount_accountType").innerHTML;//added by sumit

	//alert(accNoTemp);

	if(BranchId){	window.location="BankBranchAdd.htm?newAccount=0&bankBranch_branchId="+BranchId+"&pay_To="+pay_To+"&bankAccount_accountNumber="+accNoTemp+"&fund="+fundTemp+"&bank_code="+document.getElementById('bank_code').innerHTML;//changed by sumit
	}
	else{
		alert('Please give Code and Name of the Branch');
	}
}
// added by msahoo
function onClickAddCheque(){
	if(window.accRowIndex<=0) {
			alert('Please Select Account No ');
			return;
		}
	var table=document.getElementById('bankAccountGrid');
	var bankAccId = PageManager.DataService.getControlInBranch(table.rows[window.accRowIndex], "bankAccount_id").innerHTML;
	window.location = "../masters/accountCheque!manipulateCheques.action?bankAccId="+bankAccId;
}
var accountNumber;
var accStatus;

function getSelected(obj){
		var row=PageManager.DataService.getRow(obj);
		var table=document.getElementById('bankAccountGrid');
		var v=PageManager.DataService.getControlInBranch(table.rows[row.rowIndex],"bankAccount_id");
		var s=PageManager.DataService.getControlInBranch(table.rows[row.rowIndex],"bankAccount_isActiveCB");
		//var temp=PageManager.DataService.getControlInBranch(table.rows[row.rowIndex],"fund_name");
		//var temp=PageManager.DataService.getControlInBranch(table.rows[row.rowIndex],"bankAccount_accountType");// added by sumit
		var temp=PageManager.DataService.getControlInBranch(table.rows[row.rowIndex],"bankAccount_accountNumber");// added by sumit

		accountNumber=v.innerHTML;
		accStatus=s.innerHTML;
		window.accRowIndex = row.rowIndex;
	}
function openSearch(obj){
         var a = new Array(2);
         var bank_id=document.getElementById('bank_id').value;
         var sRtn = showModalDialog("Search.html?tableNameForCode=bankBranch&bank_id="+bank_id,"","dialogLeft=300;dialogTop=210;dialogWidth=305pt;dialogHeight=300pt;status=no;");

         if ( sRtn != '' )
	       {
	        a = sRtn.split(",");
			var x =PageManager.DataService.getControlInBranch(obj.parentNode,'bankBranch_branchCode');
			var y =PageManager.DataService.getControlInBranch(obj.parentNode.parentNode ,'bankBranch_branchName1');
			x.value = a[0];
			y.innerHTML = a[1];
		   }
		   getData();
         }

/* function otherPages(obj){
var branchId=document.getElementById('bankBranch_branchId').value;
	if(accStatus && accStatus=='0'){
	 alert('Selected Account is Inactive');
	 return false;
	 }
	if(accountNumber && branchId){
		if(obj.innerHTML =='Receive Property Tax'){
			if(!checkForActive())
				return false;
			window.location="PT_Bank.htm?branchId="+branchId+"&accNo="+accountNumber;
		}
		if(obj.innerHTML =='Payment'){
			if(!checkForActive())
				return false;
			window.location="DirectBankPayment.htm?bankBranch_branchId="+branchId+"&bankAccount_accountNumber="+accountNumber;
		}
		if(obj.innerHTML =='Advance'){
			if(!checkForActive())
				return false;
			window.location="AdvanceJournal.htm?bankBranch_branchId="+branchId+"&bankAccount_accountNumber="+accountNumber;
		}
		if(obj.innerHTML =='Pay To Supplier/Contractor'){
			if(!checkForActive())
				return false;
			window.location="SubLedgerPayment.htm?bankBranch_branchId="+branchId+"&bankAccount_accountNumber="+accountNumber;
		}
		if(obj.innerHTML =='Cash WithDrawal'){
			if(!checkForActive())
				return false;
			window.location="JV_Contra_BToC.htm?bankBranch_branchId="+branchId+"&bankAccount_accountNumber="+accountNumber;
		}
		if(obj.innerHTML =='Cash Deposit'){
			if(!checkForActive())
				return false;
			window.location="JV_Contra_CToB.htm?bankBranch_branchId="+branchId+"&bankAccount_accountNumber="+accountNumber;
		}
		if(obj.innerHTML =='Cheque Deposit'){
				if(!checkForActive())
				return false;
					window.location="PayInSlip.htm?branchId="+branchId+"&accNo="+accountNumber;
		}
		if(obj.innerHTML =='Transfer To'){
			if(!checkForActive())
				return false;
			window.location="JV_Contra_BToB.htm?bankBranch_branchId="+branchId+"&bankAccount_accountNumber="+accountNumber;
		}
		if(obj.innerHTML =='Fund To Fund'){
			if(!checkForActive())
				return false;
			window.location="JV_Contra_FToF.htm?bankBranch_branchId="+branchId+"&bankAccount_accountNumber="+accountNumber;
		}
	}
	else	alert('Select the Account');
} */

 /* function checkForActive(){
  	var actv=document.getElementById('bankAccount_isActiveCB').innerHTML;
  	if(actv=='Active')
  	return true;
  	else{
  	alert('Bank Account is Inactive');
  	return false;
  }
 } */

</script>
</head>
<body bgcolor="#ffffff" onKeyDown ="CloseWindow(event);" bottommargin="0" topmargin="0" rightmargin="0" leftmargin="0" marginheight="0" marginwidth="0" onload="getDataOnLoad()"><!------------------ Header Begins Begins--------------------->

<form name="journalVoucher" onSubmit="return PageValidator.validateForm()">
	<table width="100%" border=0 cellpadding="3" cellspacing="0">

		<tr >

			<td align="right" width=10%><div align="right" class="labelcell">Bank&nbsp;Name</div></td>
			<td>
				<div id="bank_name" name="bank_name" exilTrimLength="20" class="displayData">&nbsp;</div>
			</td>
			<td align="right" width="10%"><div align="right" class="labelcell" style="Display:none" >Bank&nbsp;Code</div></td>
		  	<td>
				<div id="bank_code" name="bank_code" class="displayData" style="Display:none">&nbsp;</div>
			</td>
		</tr>
		<tr >

			<td  align="right"><div align="right" class="labelcell" >Branch&nbsp;Name</div></td>
			<td width="30%">
			   <select id="bankBranch_branchName1" name="bankBranch_branchName1" exilMustEnter="true" class="fieldinput" exilListSource="ListOfBranches" onchange="getData();">
			   		<option></option>
			   </select>

			</td>
			<td  align="right">
            <div align="right" class="labelcell" style="Display:none">Branch&nbsp;Code</div></td>
			<td width="25%">
				<input type="hidden" name="bankBranch_branchId" id="bankBranch_branchId">
				<input type="hidden" name="bank_id" id="bank_id">
				<input type="hidden" name="addAccDisp" id="addAccDisp">
				<input name="bankBranch_branchCode" class="fieldinput" id="bankBranch_branchCode"  size="10" exilDataType="exilAlphaNumeric" style="Display:none">
				<!--IMG onclick=openSearch(this) height=22 src="/egi/resources/erp2/images/plus1.gif" width=25 align=top border=0>&nbsp;<input type=button value="Go" class="leadon" onclick="getData();" id=button1 name=button1-->
			</td>
		</tr>
		<tr >
			<td  align="right"><div align="right" class="labelcell" >Address</div></td>
			<td >
				<div id="bankBranch_branchAddress1" class="displayData" exilTrimLength="20" >&nbsp;</div>
			</td>
			<td ><div align="right" class="displayData" >&nbsp;</div></td>
			<td >&nbsp;</td>
		</tr>
		<tr >
			<td  align="right"><div align="right" class="displayData" ></div></td>
			<td >
			<div id="bankBranch_branchAddress2" class="displayData" exilTrimLength="20">&nbsp;</div>
			</td>
			<td  align="right"><div align="right" class="labelcell" >MICR</div></td>
			<td ><div id="bankBranch_branchMICR" class="displayData">&nbsp;</div></td>
		</tr>
		<tr >
			<td  align="right"><div align="right" class="labelcell" >City</div></td>
			<td >
			<div id="bankBranch_branchCity" class="displayData">&nbsp;</div>
			</td>
			<td  align="right"><div align="right" class="labelcell" >Pin</div></td>
			<td ><div id="bankBranch_branchPin" class="displayData">&nbsp;</div></td>
		</tr>
		<tr >
			<td height="22"  align="right"><div align="right" class="labelcell" >Phone</div></td>
			<td height="22" >
				<div id="bankBranch_branchPhone" class="displayData">&nbsp;</div>
			</td>
			<td height="22"  align="right"><div align="right" class="labelcell" >Fax</div></td>
			<td height="22" >
				<div id="bankBranch_branchFax" class="displayData" >&nbsp;</div>
			</td>
		</tr>

		<tr >
			<td align="right" ><div class="labelcell" align="right">Contact&nbsp;Person</div></td>
			<td   >
				<div id="bankBranch_contactPerson" class="displayData" exilTrimLength="20">&nbsp;</div>
			</td>
			<td  align="right"><div align="right" class="labelcell">Narration</div></td>
			<td><div id="bankBranch_narration" class="displayData" exilTrimLength="20">&nbsp;</div></td>
		</tr>
		<tr >
			<td  align="right"><div align="right" class="labelcell">Status</div></td>
			<td >
			<div id="bankBranch_isActive" style="WIDTH: 125px; HEIGHT: 19px" class="displayData"></div>
			</td>
			<td  >&nbsp;</td>
			<td >&nbsp;</td>
		</tr>
		<tr  >
        	<td  colspan=4 width="100%">
        	<div  id="hdiv" style="width:795px;overflow-x:scroll">
				<table width="100%" border="1" cellpadding="0" cellspacing="0" name="bankAccountGrid" ID="bankAccountGrid">
					<tr class="thStlyle">
                    	<td><span align="center" >&nbsp;</span></td>
                        <td><span align="center" >Account No</span></td>
                        <td ><span align="center" >Account Type</span></td>
                        <td ><span align="center" >Fund</span></td>
                        <td ><span align="center" >Description</span></td>
                        <td ><span align="center" >Account	Code</span></td>
                        <td ><span align="center" >Pay To</span></td>
                        <td><div align="center" >Type</div></td>

                        <td ><span align="center" >Status</span></td>
                        <td ><span align="center" >Select</span></td>
					</tr>
                    <tr >
                    	<input type="hidden" name="fund" id="fund">
                    	<input type="hidden" name="fund_id" id="fund_id">
						<td><span  name="bankAccount_id" id="bankAccount_id">&nbsp;</div></td>
                        <td><span><div name="bankAccount_accountNumber" exilTrimLength="25" id="bankAccount_accountNumber" class="labelcell" style="width:80px">&nbsp;</span></span></td>
                        <td><span>
						<span name="bankAccount_accountType" exilTrimLength="50" id="bankAccount_accountType" class="labelcell" style="width:">&nbsp;</span></span></td>
                        <td><span><span name="fund_name" exilTrimLength="20" id="fund_name" class="labelcell" style="width:">&nbsp;</span></span></td>
                        <td><span><span name="bankAccount_narration" exilTrimLength="20" id="bankAccount_narration" class="labelcell">&nbsp;</span></span></td>
                        <td><span><span name="chartOfAccounts_glCode" exilTrimLength="20" id="chartOfAccounts_glCode" class="labelcell" style="width:25">&nbsp;</span></span></td>
                        <td><span><div name="pay_To" id="pay_To" style="width:80" class="labelcell">&nbsp;</div></span></td>
					   <td><span><div name="bankAccount_type" id="bankAccount_type" style="width:120px" class="labelcell">&nbsp;</div></span></td>
                        <td><span align="center" name="bankAccount_isActiveCB" id="bankAccount_isActiveCB" class="labelcell" style="width:10"></SPAN></span></td>
                        <td><input type=radio name="operateOn" id="operateOn" onClick="getSelected(this);" style="width:"></td>
					</tr>
				</table>
				</div>
			</td>
		</tr>
		<tr >
			<td colspan="4" align="middle" width="100%"><!-- Buttons Start Here -->
				<table border="0" cellpadding="0" cellspacing="0">
					<tr>
						 <td>
						 <input  id="savenNew" type="button" class="button" value="Add Branch" onclick="addNewBranch();"/>
						 <input  id="branchModify" type="button" class="button" value="Modify Branch" onclick="onClickBranchModify();"/>
						 <input   type="button" class="button" value="Add Account" onclick="addAccount();" />
						 <input   type="button" class="button" value="Modify Account" onclick=onClickModify(); />
						 <input   type="button" class="button" value="Modify" onclick=onClickModify(); />
						  <input   type="button" class="button" value="Add Cheque" onclick=onClickAddCheque(); />
						 <input   type="button" class="button" value="Close" onclick=window.close(); />
						 </td>
					</tr>
				</table>
			</td>
			<!-- Buttons End Here -->
								</td>
							</tr>
				</table>
</form>

</body>
</html>
