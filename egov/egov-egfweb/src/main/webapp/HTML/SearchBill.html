#-------------------------------------------------------------------------------
# eGov suite of products aim to improve the internal efficiency,transparency, 
#      accountability and the service delivery of the government  organizations.
#   
#       Copyright (C) <2015>  eGovernments Foundation
#   
#       The updated version of eGov suite of products as by eGovernments Foundation 
#       is available at http://www.egovernments.org
#   
#       This program is free software: you can redistribute it and/or modify
#       it under the terms of the GNU General Public License as published by
#       the Free Software Foundation, either version 3 of the License, or
#       any later version.
#   
#       This program is distributed in the hope that it will be useful,
#       but WITHOUT ANY WARRANTY; without even the implied warranty of
#       MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#       GNU General Public License for more details.
#   
#       You should have received a copy of the GNU General Public License
#       along with this program. If not, see http://www.gnu.org/licenses/ or 
#       http://www.gnu.org/licenses/gpl.html .
#   
#       In addition to the terms of the GPL license to be adhered to in using this
#       program, the following additional terms are to be complied with:
#   
#   	1) All versions of this program, verbatim or modified must carry this 
#   	   Legal Notice.
#   
#   	2) Any misrepresentation of the origin of the material is prohibited. It 
#   	   is required that all modified versions of this material be marked in 
#   	   reasonable ways as different from the original version.
#   
#   	3) This license does not grant any rights to any user of the program 
#   	   with regards to rights under trademark law for use of the trade names 
#   	   or trademarks of eGovernments Foundation.
#   
#     In case of any queries, you can reach eGovernments Foundation at contact@egovernments.org.
#-------------------------------------------------------------------------------
<!-- ramesh modified on 20-12-2004 at 12:00 -->
<html>
	<head>
	<link rel=stylesheet href="../exility/global.css" type="text/css">
		<title>Search Screen</title>
			<script language="javascript" src="../exility/jsCommonMethods.js"></script>
			<script language="JavaScript" type="text/JavaScript"></script>
			<SCRIPT language="javascript" src="../exility/CommonMenus.js"></SCRIPT>
			<SCRIPT LANGUAGE="JavaScript" SRC="../exility/HM_Settings.js" TYPE='text/javascript'></SCRIPT>
			<SCRIPT LANGUAGE="javascript" SRC="../exility/datefunctions.js"></SCRIPT>
			<SCRIPT LANGUAGE="javascript" SRC="../exility/PageManager.js"></SCRIPT>
			<SCRIPT LANGUAGE="javascript" SRC="../exility/PageValidator.js"></SCRIPT>
			<SCRIPT LANGUAGE="javascript" SRC="../exility/GridSort.js"></SCRIPT>
			<SCRIPT LANGUAGE="javascript" SRC="../exility/ExilityParameters.js"></SCRIPT>

<script language='javascript'>
function getData(){
	var tableName = PageManager.DataService.getQueryField('tableNameForCode');
	var scrName = PageManager.DataService.getQueryField('screenName');
	var filter=PageManager.DataService.getQueryField('filter');
	var lvlNumber=PageManager.DataService.getQueryField('lvlNumber');
	var filter2=PageManager.DataService.getQueryField('filter2');
	var filter3=PageManager.DataService.getQueryField('filter3');
	var filter4=PageManager.DataService.getQueryField('filter4');
	var filter5=PageManager.DataService.getQueryField('filter5');
	var filter6=PageManager.DataService.getQueryField('filter6');
	var filter7=PageManager.DataService.getQueryField('filter7');
	var filter8=PageManager.DataService.getQueryField('filter8');



	var filterServiceID=PageManager.DataService.getQueryField('filterServiceID');



	if(filter)
		PageManager.DataService.setQueryField('filter',filter);

	if(lvlNumber)
		PageManager.DataService.setQueryField('lvlNumber',lvlNumber);

	if(filter2)
		PageManager.DataService.setQueryField('filter2',filter2);

	if(filter3)
		PageManager.DataService.setQueryField('filter3',filter3);

	if(filter4)
		PageManager.DataService.setQueryField('filter4',filter4);

	if(filter5)
		PageManager.DataService.setQueryField('filter5',filter5);

	if(filter6)
		PageManager.DataService.setQueryField('filter6',filter6);

	if(filter7)
		PageManager.DataService.setQueryField('filter7',filter7);

	if(filter8)
		PageManager.DataService.setQueryField('filter8',filter8);


	var relType=PageManager.DataService.getQueryField('relationType');

	if(relType)
		PageManager.DataService.setQueryField('relationType', relType);

	var bank_id = PageManager.DataService.getQueryField('bank_id');
	var type = PageManager.DataService.getQueryField('type');
	PageManager.DataService.setQueryField('tableNameForCode',tableName);
	var serviceId;


	if(filterServiceID){
		serviceId='mappedCodes';
	}else if(tableName) {
		if(tableName.toLowerCase()=='chartofaccounts')
			serviceId='glCodeAndDescription';
		
		else if(tableName.toLowerCase()=='chartofaccounts_txnsummary')
			serviceId='glCodeAndDescOpBalance'; 
		else if(tableName.toLowerCase()=='chartofaccounts_txnsummaryupdate')
			serviceId='glCodeAndDescOpBalUpdate';
		else if(tableName.toLowerCase()=='chartofaccounts_controlcodes')
			serviceId='glCodeAndDescControlCodes';
		else if(tableName.toLowerCase()=='chartofaccounts_all')
			serviceId='glCodeAndDescriptionAll';
		else if(tableName.toLowerCase()=='bankbranch')
			serviceId='branchCodeAndDescription';
		else if(tableName.toLowerCase()=='bankaccount')
			serviceId='bankNameAndBranchName';
		else if(tableName.toLowerCase()=='financialyear')
			serviceId='finYearCodeAndDescription';
		else if(tableName.toLowerCase()=='organizationstructure'){
				if(type=='GeographicalBoundary')
					serviceId='wardCodeAndDescription';
				else
					serviceId='regionCodeAndDescription';
			}
		else if(tableName.toLowerCase()=='depreciation')
			serviceId='depreciationRate';
		else if(tableName.toLowerCase()=='tds')
			serviceId='getTdsRate';
		else if(tableName.toLowerCase()=='month')
			serviceId='getMonth';
		else if(tableName.toLowerCase()=='scheme')
			serviceId='getScheme';
		else if(tableName.toLowerCase()=='costcentre')
			serviceId='getScheme';
		else if(tableName.toLowerCase()=='department')
			serviceId='getScheme';
		else if(tableName.toLowerCase()=='division')
			serviceId='getScheme';
		else if(tableName.toLowerCase()=='eg_billregister')
			serviceId='getBillRegister';
			
		else
			serviceId='codeAndDescription';
	} else if(scrName){
		if(scrName.toLowerCase()=='othertaxes'){
			serviceId='glCodeAndDescriptionOtherTaxes';
		} else if(scrName.toLowerCase() == 'miscreceipts'){
			serviceId='glCodeAndDescriptionMiscReceipts';
		} else if(scrName.toLowerCase() == 'directpayment'){
			serviceId='glCodeAndDescriptionDirectPayment';
		} else if(scrName.toLowerCase() == 'salaryjvearn'){
			serviceId='glCodeAndDescriptionSalaryJVEarnings';
		} else if(scrName.toLowerCase() == 'salaryjvdeduct'){
			serviceId='glCodeAndDescriptionSalaryJVDeductions';
		} else if(scrName.toLowerCase() == 'supplierjv'){
			serviceId='glCodeAndDescriptionSupplierJV';
		}else if(scrName.toLowerCase() == 'contractorjvorgwrks'){
			serviceId='glCodeAndDescriptionContractorJVOrgWorks';
		}else if(scrName.toLowerCase() == 'contractorjvrepwrks'){
			serviceId='glCodeAndDescriptionContractorJVRepWorks';
		}else if(scrName.toLowerCase() == 'generaljv'){
			serviceId='glCodeAndDescriptionGeneralJV';
		}else if(scrName.toLowerCase() == 'cashbook'){
			serviceId='cashBook';
		}else if(scrName.toLowerCase() == 'bankbook'){
			serviceId='bankBook';
		}else if(scrName.toLowerCase() == 'report'){
			serviceId='reportOut';
		}else if(scrName.toLowerCase() == 'cashName'){
			serviceId='cashName';
		}else if(scrName.toLowerCase() == 'tdsadd'){
				serviceId='getDedCodes';
		}else if(scrName.toLowerCase() == 'condec'){
				serviceId='getConDedCodes';
		}else if(scrName.toLowerCase() == 'tdsdec'){
				serviceId='getTdsDedCodes';
		}
		
	}
	PageManager.DataService.callDataService(serviceId);
}
function afterRefreshPage(dc){

}

</script>

	</head>
	<body  bottommargin="0" topmargin="0" rightmargin="0" leftmargin="0"

		 marginheight="0" marginwidth ="0" onLoad="getData();"  OnUnload="window.returnValue = document.all.ret.value;" bgColor=white><!-- makeSortable('tblCodeDes'); -->
		<form name="frmPwsSearch" method="post" id="frmPwsSearch" runat="server" >
			<table width="100%" border="0" cellpadding="3" cellspacing="0" id="Table1">
  <TBODY bgColor=white>
				<tr>
					<td width="96%" colspan="9" valign="center" class="normaltext-Content"><!--<div id="divError" style="DISPLAY:none;VISIBILITY:hidden">-->
						<div id="divError" style="DISPLAY: none; VISIBILITY: hidden" >
							<script language="javascript">
							</script>
						</div>
					</td>
				</tr>
				<tr>
					<td colspan="9" align="right" valign="center" class="normaltext">
						<div align="left" class="header" id="scrHdr" name="scrHdr"></div>
						<input type="hidden" name="ret" ID="Hidden1">
					</td>
				</tr>
				<tr>
					<td colspan="9" align="right" valign="center" class="normaltext"><div align="left">
							<table width="100%" border="1" cellpadding="0" cellspacing="0" bordercolor="#808080" ID="Table2">
								<tr bgcolor="white" >
									<td width="108" height="26" align="right" valign="center" class="normaltext"><div align="left">Sort
											Order
										</div>
									</td>
									<td width="390" align="right" valign="center" class="normaltext"><div id="hdrCode">Bill Number</div>
									</td>
									<td width="29" align="right" valign="center" class="normaltext"><div align="left">
											<input id="rdoCode" name="radiobutton1" type="radio" value="radiobutton" checked onClick="sort(this)">
										</div>
									</td> 
									<td colspan="3" align="right" valign="center" class="normaltext"><div id="hdrDescription">procurement Order </div>
									</td>
									<td width="35" align="right" valign="center" class="normaltext"><div align="left">
											<input id="rdoDescription" name="radiobutton1" type="radio" value="radiobutton"  onClick="sort(this)">
										</div>
									</td>
								</tr> 
								<tr >
									<td height="18" align="right" valign="center" class="normaltext"><div align="left">Filter</div>
									</td>
									<td align="right" valign="center" class="normaltext" width="390" >Left</td>
									<td align="right" valign="center" class="normaltext" width=29><div align="left">
											<input id="rboLeft" name="radiobutton" type="radio" value="radiobutton">
										</div>
									</td>
									<td width="154" align="right" valign="center" class="normaltext" >Within</td>
									<td width="30" align="right" valign="center" class="normaltext"><div align="left">
											<input id="rboWithIn" name="radiobutton" type="radio" value="radiobutton"  checked>
										</div>
									</td>
									<td width="233" align="right" valign="center" class="normaltext" >Right</td>
									<td align="right" valign="center" class="normaltext"><div align="left">
											<input id="rboRight" name="radiobutton" type="radio" value="radiobutton">
										</div>
									</td>
								</tr>
								<tr>
									<td height="24" align="right" valign="center" class="normaltext"><div align="left">Bill Number</div>
									</td>
									<td colspan="6" align="right" valign="center" class="normaltext"><div align="left">
											<input name="txtSearch" id="txtSearch" class="fieldinput" style="WIDTH: 250px" size="20">
											<input name="btnFilter" type="submit" id="btnFilter" value="Filter" onclick="fillData();sortData();return false;">
										</div>
									</td>
								</tr>
							</table>
						</div>
					</td>
				</tr>
				<tr class="row1">
					<td colspan="9" align="right" valign="center" class="normaltext">
						<table width="100%" border="1" onClick="getKeyInfo();" cellpadding="3" cellspacing="0"
							 name="tblCodeDes" exilRowKey="divCode" id="popupGrid">
							<tr class="rowheader" bgColor=aqua>
								<td width="33%" height="30" class="columnheader" >
									<div name="lblCode" id="lblCode"  >Bill Number</div>
								</td>
								<td width="100%" class="columnheader"><div name="lblDes" id="lblDes" >procurement Order </div>
								</td>
							</tr>
							<tr class="row2">
								 <td class="normaltext-Content" >
									<div name="divCode" onMouseOver="this.style.cursor='hand'" ></div>
									<div name="divKeyInfo" style="DISPLAY: none; VISIBILITY: hidden"></div>
								</td>
								<td class="normaltext-Content"><div name="divDes" trimLength="30" onMouseOver="this.style.cursor='hand'"></div>
								<input type="hidden" name="divId"></td>
							</tr>

						</table>
					</td>
				</tr></TBODY>
			</table>
		</form>
	</body>
</html>

<script language="javascript">

	arrCodes = new Array();
	arrDescription = new Array();

	function fillData()
	{
		//alert('Storing Starts');
		if(arrCodes.length>0) return true;
		var noOfRows;
		var table = document.getElementById('popupGrid');
		if(!table) alert('table is null');

		noOfRows = table.rows.length;

		if ( noOfRows > 0 )
		{
			for(var rowKey1=1; rowKey1<noOfRows; rowKey1++)
			{

				 var obj1= PageManager.DataService.getControlInBranch(table.rows[rowKey1],'divCode');
				 var obj2= PageManager.DataService.getControlInBranch(table.rows[rowKey1],'divDes');

				arrCodes[rowKey1-1]=obj1.innerHTML;
				if(obj2.getAttribute('title').length>0)
					arrDescription[rowKey1-1]=obj2.getAttribute('title');
				else
					arrDescription[rowKey1-1]=obj2.innerHTML;
			}
		}

	}

	function getKeyInfo()
	{

		var table = document.getElementById('popupGrid');

		if ( event.srcElement.name == 'divCode'|| event.srcElement.name == 'divDes')
		{

		    var s =PageManager.DataService.getRowKey(event.srcElement);
			var a = PageManager.DataService.getRowUsingKey('popupGrid',s);

			var x =PageManager.DataService.getControlInBranch(a,'divCode');
			var y =PageManager.DataService.getControlInBranch(a,'divDes');
			var z =PageManager.DataService.getControlInBranch(a,'divId');
			var str = y.innerHTML;
			var p = str.substring(str.length-3,str.length);
			if ( p == '...' )
				document.all.ret.value = x.innerHTML + ',' + y.title+ ',' + z.value;
			else
				document.all.ret.value = x.innerHTML + ',' + y.innerHTML+ ',' + z.value;
			window.close();
		}


	}

	function sortData()
	{
		var noOfRows,arrIndex,strKey;
		var strPopulate = new Array();
		var table = document.getElementById('popupGrid');
			if(!table) alert('table is null');

		var obj1;
		for(var i=1;i<table.rows.length;i++)
		{
			obj1 = PageManager.DataService.getControlInBranch(table.rows[i],'divDes');
			//alert(obj1.getAttribute('title'));

		}


		var ele = document.getElementById('txtSearch');
		//ele = pageValidator_LrTrim(ele.value);
		ele = ele.value.toUpperCase();
		noOfRows = arrCodes.length;
		arrIndex = 0;
		if ( ele != '' )
		{
			strPopulate[arrIndex] = new Array();
			var t = new Array();
			t[0] = 'divKeyInfo';
			t[1] = 'divCode';
			t[2] = 'divDes';
			strPopulate[arrIndex] = t;
			arrIndex++;
			for(var rowKey1=0; rowKey1<noOfRows; rowKey1++)
			{
				if (document.getElementById('rboLeft').checked == true )

					if ( document.getElementById('rdoCode').checked == true )
						strKey = arrCodes[rowKey1].substring(0,ele.length).toUpperCase();
					else
						strKey = arrDescription[rowKey1].substring(0,ele.length).toUpperCase();

				else if (document.getElementById('rboWithIn').checked == true )

					if ( document.getElementById('rdoCode').checked == true )
						if ( arrCodes[rowKey1].toUpperCase().indexOf(ele) >= 0 ) strKey = ele; else strKey="";
					else
						if ( arrDescription[rowKey1].toUpperCase().indexOf(ele) >= 0 ) strKey = ele; else strKey="";

				else if (document.getElementById('rboRight').checked == true )

					if ( document.getElementById('rdoCode').checked == true )
						strKey = arrCodes[rowKey1].toUpperCase().substring(arrCodes[rowKey1].length-ele.length)
					else
						strKey = arrDescription[rowKey1].toUpperCase().substring(arrDescription[rowKey1].length-ele.length)
				if ( strKey == ele )
				{
					strPopulate[arrIndex] = new Array();
					var t = new Array();
					t[0] = arrIndex.toString();
					t[1] = arrCodes[rowKey1].toString();
					t[2] = arrDescription[rowKey1].toString();
					strPopulate[arrIndex] = t;
					arrIndex++;
				}
			}

			if ( arrIndex == 1 )
			{
				var t = new Array();
				t[0] = ' ';
				t[1] = ' ';
				t[2] = ' ';
				strPopulate[arrIndex] = t;
			}
		}
		else
		{
			strPopulate[arrIndex] = new Array();
			var t = new Array();
			t[0] = 'divKeyInfo';
			t[1] = 'divCode';
			t[2] = 'divDes';
			strPopulate[arrIndex] = t;
			arrIndex++;
			for(var rowKey1=0; rowKey1<noOfRows; rowKey1++)
			{
					strPopulate[arrIndex] = new Array();
					var t = new Array();
					t[0] = arrIndex.toString();
					t[1] = arrCodes[rowKey1].toString();
					t[2] = arrDescription[rowKey1].toString();
					strPopulate[arrIndex] = t;
					arrIndex++;
			}
			if ( arrIndex == 1 )
			{
				var t = new Array();
				t[0] = ' ';
				t[1] = ' ';
				t[2] = ' ';
				strPopulate[arrIndex] = t;
			}
		}
		var obj1,obj2;
		for(var i=0;i<table.rows.length;i++)
		{
			table.rows[i].removeAttribute("param1");
			table.rows[i].cells[1].removeAttribute("title");

		}
		PageManager.DataService.addDataToGrid('popupGrid', strPopulate);
		return false;
	}

	function sort(obj)
	{
 		if(obj.id=="rdoCode")
			sortCode();
		else
			sortDesc();
	}

	function  makeSort(cellObj)
	{
			table=document.getElementById('tblCodeDes');
   	        var txt = LrTrim(cellObj.innerHTML);
    	    cellObj.innerHTML = '<div class="sortheader" >'+txt+'</div>';

    }

	function  removeFormat(obj)
	{
		var lnk=obj.childNodes[0];
		var rootNode=getTextNode(lnk);
		var spantext = getInnerText(rootNode);
		if(spantext.charCodeAt(0)==8595 || spantext.charCodeAt(0)==8593 )
		{
				spantext=spantext.substring(1,spantext.length);
		}
		rootNode.innerHTML=spantext;
	}

	function sortCode()
	{
		var table=document.getElementById('popupGrid');
				removeFormat(table.rows[0].cells[1]);
		resortTab(table.rows[0].cells[0].childNodes[0]);

	}
	function sortDesc()
	{

		table=document.getElementById('popupGrid');
				removeFormat(table.rows[0].cells[0]);
		resortTab(table.rows[0].cells[1].childNodes[0]);

	}

	function sortInit()
	{
		var table=document.getElementById('tblCodeDes');
		makeSort(table.rows[0].cells[0]);
		makeSort(table.rows[0].cells[1]);
	}

	function resortTab(lnk)
	{
    // get the div
    var span=lnk;
	//get first textnode link
	var rootNode=getTextNode(lnk);
	//get first textnode text
	var spantext = getInnerText(rootNode);
	//if arrow is there remove
	if(spantext.charCodeAt(0)==8595 || spantext.charCodeAt(0)==8593 )
	{
			spantext=spantext.substring(1,spantext.length);
	}
    var td = lnk.parentNode;
	while(td.tagName.toUpperCase()!="TD" && td.tagName.toUpperCase()!="TH")
	  td=td.parentNode;

    var column = td.cellIndex;
    var table = getParent(td,'TABLE');
    // Work out a type for the column
    if (table.rows.length <= 1) return;
    var itm = getInnerText(table.rows[1].cells[column]);
    sortfn = sortCaseInsensitive;
    if (itm.match(/^\d\d[\/-]\d\d[\/-]\d\d\d\d$/)) sortfn = sortDate;
    if (itm.match(/^\d\d[\/-]\d\d\d[\/-]\d\d\d\d$/)) sortfn = sortDate;
    if (itm.match(/^\d\d[\/-]\d\d[\/-]\d\d$/)) sortfn = sortDate;
    if (itm.match(/^\d[\/-]\d\d\d[\/-]\d\d\d\d$/)) sortfn = sortDate;
    if (itm.match(/^\d[\/-]\d\d[\/-]\d\d\d\d$/)) sortfn = sortDate;
    if (itm.match(/^[�$]/)) sortfn = sortCurrency;
    if (itm.match(/^[\d\.]+$/)) sortfn = sortNumeric;
	var gComma= new String(itm);
    if (gComma.match(',')==",")
	{
		sortfn = sortGeneric;
	}
    SORT_COLUMN_INDEX = column;
    var newRows = new Array();
    //=====================
    var newNode;
    var oldRowCount=table.rows.length;
	var oldColumnCount=table.rows[0].cells.length;
	var newCols;

	//insert column
    for (var j=0;j<table.rows.length;j++)
    {
		table.rows[j].insertCell(oldColumnCount);
		//assign last column data = row number
		table.rows[j].cells[oldColumnCount].innerHTML=j;
    }
	//copy all rows to newRows
    for (var j=1;j<table.rows.length;j++) { newRows[j-1] = table.rows[j]; }

    newRows.sort(sortfn);

    if (span.getAttribute("sortdir") == 'down') {
		//set first text node text to arrow and oldtext
		rootNode.innerHTML='&uarr;'+spantext;
        newRows.reverse();
        span.setAttribute('sortdir','up');
    } else {
		//set first text node text to arrow and oldtext
		rootNode.innerHTML='&darr;'+spantext;
        span.setAttribute('sortdir','down');
    }

	for(var k=0;k<oldRowCount-1;k++)
	{
		//get lastcolumn data.thatis old row number
		newCols=newRows[k].cells[oldColumnCount].innerHTML;
		//clone that node and append
		newNode=table.rows[parseInt(newCols)].cloneNode(true);
		table.tBodies[0].appendChild(newNode);
    }

	var sortIndexArr = new Array();
    var element;
    var newIndex=oldRowCount;

	for(var i=0;i<newRows.length;i++)
	{
		sortIndexArr[i]=newRows[i].cells[oldColumnCount].innerHTML;
	}

	//fill properties and control data

    //delete rows
    for(var k=0;k<oldRowCount-1;k++)
	{
		table.deleteRow(1);

	}

    for(var k=0;k<oldRowCount;k++)
	{
		table.rows[k].deleteCell(oldColumnCount);
	}

}
		</script>
