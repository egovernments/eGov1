#-------------------------------------------------------------------------------
# eGov suite of products aim to improve the internal efficiency,transparency, 
#      accountability and the service delivery of the government  organizations.
#   
#       Copyright (C) <2015>  eGovernments Foundation
#   
#       The updated version of eGov suite of products as by eGovernments Foundation 
#       is available at http://www.egovernments.org
#   
#       This program is free software: you can redistribute it and/or modify
#       it under the terms of the GNU General Public License as published by
#       the Free Software Foundation, either version 3 of the License, or
#       any later version.
#   
#       This program is distributed in the hope that it will be useful,
#       but WITHOUT ANY WARRANTY; without even the implied warranty of
#       MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#       GNU General Public License for more details.
#   
#       You should have received a copy of the GNU General Public License
#       along with this program. If not, see http://www.gnu.org/licenses/ or 
#       http://www.gnu.org/licenses/gpl.html .
#   
#       In addition to the terms of the GPL license to be adhered to in using this
#       program, the following additional terms are to be complied with:
#   
#   	1) All versions of this program, verbatim or modified must carry this 
#   	   Legal Notice.
#   
#   	2) Any misrepresentation of the origin of the material is prohibited. It 
#   	   is required that all modified versions of this material be marked in 
#   	   reasonable ways as different from the original version.
#   
#   	3) This license does not grant any rights to any user of the program 
#   	   with regards to rights under trademark law for use of the trade names 
#   	   or trademarks of eGovernments Foundation.
#   
#     In case of any queries, you can reach eGovernments Foundation at contact@egovernments.org.
#-------------------------------------------------------------------------------
<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<script language="javascript">
pageMode="modify";
var sameWindow=0;
function getData(){
PageValidator.addCalendars();
PageManager.ListService.callListService();

	var worksDetail_code=PageManager.DataService.getQueryField('worksDetail_code');
	var mode=PageManager.DataService.getQueryField('mode');
	//alert(mode);
	if(mode=='view')
	{
		document.getElementById('bill_code').value=worksDetail_code;							  	PageManager.DataService.setQueryField('worksDetail_codeToSearch',PageManager.DataService.getQueryField('worksDetail_code'));
	PageManager.DataService.callDataService('billRegisterData');
	document.getElementById('trModify').style.display='block';
	document.getElementById('trNew').style.display='none';
	document.getElementById('bill_code').disabled=true;
		document.getElementById('bill_Date').disabled=true;
			document.getElementById('bill_Po').disabled=true;
				document.getElementById('bill_PayDate').disabled=true;
					document.getElementById('bill_Amount').disabled=true;
						document.getElementById('bill_Status').disabled=true;
document.getElementById('bill_Narration').disabled=true;
document.getElementById('bill_AppStaus').disabled=true;
	}
	else
	{
	if(worksDetail_code){document.getElementById('bill_Date').focus();
	document.getElementById('bill_code').value=worksDetail_code;							  	PageManager.DataService.setQueryField('worksDetail_codeToSearch',PageManager.DataService.getQueryField('worksDetail_code'));
	PageManager.DataService.callDataService('billRegisterData');
	document.getElementById('trModify').style.display='block';
	document.getElementById('trNew').style.display='none';
	document.getElementById('bill_code').disabled=true;
	//document.getElementById('worksDetail_code').style.display='block';

	}else{
	document.getElementById('bill_code').focus();
	pageMode="New";
//	document.getElementById('orderRow').style.display='none';
	document.getElementById('screenName').innerHTML="Create Bill Register";
	document.getElementById('trModify').style.display='none';
	document.getElementById('trNew').style.display='block';
	document.getElementById('bill_AppStaus').disabled=true;
	//document.getElementById('submitButton').innerHTML="New";
	}
	}
}
function afterRefreshPage(dc){
	var controlStatus=document.getElementById('bill_AppStaus');
	     var bStatus=controlStatus.options[controlStatus.selectedIndex].value;

		if(bStatus=='PASSED')
		{//alert('WIN');
		document.getElementById('status').value=bStatus;
		//alert(document.getElementById('status').value);
		document.getElementById('bill_AppStaus').disabled=true;}

	var type=document.getElementById('relationId');
	control=document.getElementById('worksDetail_type');
	if(type.value =='1'){
		document.getElementById('typeName').innerHTML="";
		control.style.display="none";
		//added by siddhu on 9may
		control.options[0].setAttribute('selected',true);
		/*commented by siddhu
			control.selectedIndex=0;
		control.options[0].value='Supplies';*/
		control.removeAttribute('exilMustEnter');
		}else if(type.value =='2'){
		document.getElementById('typeName').innerHTML="Type Of Work<span class='leadon'>*</span>";
		control.style.display="block";
		control.setAttribute('exilMustEnter',"true");
	}
		if(dc.values['worksDetail_isActive']=='0')
		document.getElementById('worksDetail_isActive').checked=false;
	else if(dc.values['worksDetail_isActive']=='1')
		document.getElementById('worksDetail_isActive').checked=true;

		if(dc.values['worksDetail_type']){
		document.getElementById('typeName').innerHTML="Type Of Work<span class='leadon'>*</span>";
		control.style.display="block";
		}
		//We need to disable some fields if there is a bill already paid for the Procurement order
		if(dc.values['worksDetail_isreversed']!=1 && dc.values['worksDetail_billAmount']*1 > 0 || dc.values['worksDetail_suppBillAmount']*1 > 0){
			alert("Already Billed.Cannot Modify the Total Value and other related fields. ");
			document.getElementById('worksDetail_totalValue').disabled=true;
			document.getElementById('worksDetail_advanceAmount').disabled=true;
			document.getElementById('worksDetail_advancePayable').disabled=true;
			document.getElementById('worksDetail_securityDeposit').disabled=true;
			document.getElementById('worksDetail_retention').disabled=true;

			document.getElementById('worksDetail_relationId').disabled=true;
			document.getElementById('worksDetail_wardId').disabled=true;
			document.getElementById('worksDetail_fundId').disabled=true;
			document.getElementById('worksDetail_fundSourceId').disabled=true;
		}

		var worksDetail_orderDate=dc.values['worksDetail_orderDate'];
		if(!worksDetail_orderDate)	return false;

		worksDetail_orderDate=formatDate2(worksDetail_orderDate);
		document.getElementById('worksDetail_orderDate1').value=worksDetail_orderDate;
		return true;


}

function onClickCancel(){
	//window.location="WorksDetailEnq.htm";
	window.location="BillRegisterAdd.htm?showMode=new";
}
function onClickCancelMod(){
	window.location="BillRegisterEnq.htm";

}

function changeIsActive(){
 var control=document.getElementById('bill_AppStaus');
	var relType=control.options[control.selectedIndex].value;

 if(relType=="PENDING")
 {

  document.getElementById('bill_isActive').value=0;
 }
 else
 {

	document.getElementById('bill_isActive').value=2;
 }
}

function ButtonPress(name){
if(name.toLowerCase()=='savenew')
sameWindow=1;
	//   ***1 only FO***,  ***2 FO***,  ***Admin, 3 All***    //

	if(!isValidUser(2, CookieManager.getCookie('userRole')) ) return false;

	document.getElementById('egUser_id').value = CookieManager.getCookie('currentUserId');

	if(pageMode == "modify"){
		/*var aAmount=document.getElementById('worksDetail_advanceAmount').value;
		document.getElementById('modeOfExec').value="modify";
		if(parseFloat(aAmount) > parseFloat(pAmount)){
			alert('Advance Amount Already Issued  is more than Given Advance Payable Amount');
			return false;
		}*/
		document.getElementById('modeOfExec').value="modify";
		/*var controlStatus=document.getElementById('bill_AppStaus');
	     var bStatus=controlStatus.options[controlStatus.selectedIndex].value;
		document.getElementById('status').value=bStatus;*/
		document.getElementById('billNumber').value=document.getElementById('bill_code').value;
		//var controlStatus=document.getElementById('bill_AppStaus');
	   //  var bStatus=controlStatus.options[controlStatus.selectedIndex].value;
		//document.getElementById('status').value=bStatus;
	//alert(document.getElementById('status').value);

		if(PageManager.DataService.getQueryField('mode')=='view')
		{

		}
		else
		{
			PageManager.UpdateService.submitForm('billRegisterInsert');
		}

	}else{
	var billNumber= document.getElementById('bill_No').value;
	var splCode = document.getElementById('bill_code').value;

	if(billNumber==splCode)
	{
	 alert("Bill Number Already Exist!");
	 document.getElementById('bill_code').value="";

	}
	//var orderDate=document.getElementById('worksDetail_orderDate1').value;
	//document.getElementById('worksDetail_orderDate').value=formatDate4(orderDate);
	//alert("orderDate  "+orderDate+"formatDate4(orderDate)  "+formatDate4(orderDate));
		//PageManager.UpdateService.submitForm('worksDetailInsert');worksDetail_orderType
		document.getElementById('modeOfExec').value="new";
		/*PageManager.DataService.setQueryField('worksDetail_orderType',document.getElementById('worksDetail_orderType').value);*/
		var controlStatus=document.getElementById('bill_AppStaus');
	     var bStatus=controlStatus.options[controlStatus.selectedIndex].value;
		document.getElementById('status').value=bStatus;

		if(PageManager.DataService.getQueryField('mode')=='view')
		{

		}
		else
		{
			PageManager.UpdateService.submitForm('billRegisterInsert');
		}
	}
}
function beforeRefreshPage(dc){



	/*var ward=dc.values['worksDetail_levelOfWork'];
	if(ward == 'Ward'){
	document.getElementById('wardName').innerHTML="Ward No";
	var ward=document.getElementById('worksDetail_wardId');
	ward.style.display="block";
	}
	else
	{
		var ward=document.getElementById('worksDetail_wardId');
		ward.style.display="none";
	}
		var type=dc.values['worksDetail_type'];
		if(type== 'Supplies'){
		var type=document.getElementById('worksDetail_type');
		document.getElementById('typeName').innerHTML="";
		type.style.display="none";
		}*/
		return true;
}



/*function formatDate(dateText){
	var months = ["NA","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

	dateText=dateText.substring(0,10);
	var dateArray= dateText.split('-');
	var newDate=dateArray[2]+"-"+ months[parseInt(dateArray[1], 10)] +"-"+dateArray[0];

	return newDate;
}*/

function afterUpdateService(dc){

	str = "DC came back with success=" + dc.success + " and other fields are\n";
	if(sameWindow == 1){
	  window.location="BillRegisterAdd.htm";
      }else{
	window.location="BillRegisterEnq.htm";
	window.location="BillRegisterEnq.htm?worksDetail_codeToSearch="+dc.values['worksDetail_code'];

	}
	sameWindow=0;
	return true;
}


function selectLevel(){
	var worksDetail_levelOfWork=document.getElementById('worksDetail_levelOfWork').value;
	if(worksDetail_levelOfWork == 'Ward'){
	document.getElementById('wardName').innerHTML="Ward No";
	var ward=document.getElementById('worksDetail_wardId');
	ward.style.display="block";
	}else{
		var ward=document.getElementById('worksDetail_wardId');
		ward.style.display="none";
		document.getElementById('wardName').innerHTML="";
		if(!ward.selectedIndex == -1){
			ward.options[ward.selectedIndex].value=0;
		}else{
			ward.selectedIndex = 0;
			ward.options[0].value=0;
		}
	}
}
  function getRelationType(){

  	var control=document.getElementById('worksDetail_relationId');
	var relType=control.options[control.selectedIndex].value;
	PageManager.DataService.setQueryField("relationId",relType);
  	PageManager.DataService.callDataService('getRelationId');
}

function getOrderType(){
	var control=document.getElementById('worksDetail_orderType');
	var relType=control.options[control.selectedIndex].value;
	document.getElementById('worksDetail_relationId').setAttribute('exilListSource','worksDetail_relationId');
	//alert(relType);
	if(relType=='Work Order')
	{PageManager.DataService.callDataService('orderedToWork');}
	else if(relType=='Purchase Order')
	{	PageManager.DataService.callDataService('orderedToPurchase');}
	else
	{clearCombo('worksDetail_relationId');}

}
function clearCombo(obj)
{
	var accCtrl=document.getElementById(obj);
	//alert(accCtrl.options.length);
	for(var i=accCtrl.options.length-1;i>=0;i--){
		accCtrl.remove(i);}


}
function checkBillNo(splCode){
	//alert("Bill Number Checking......");
	if(splCode==null || splCode=="")return;
	document.getElementById('bill_No').value="";
	PageManager.DataService.setQueryField('billNo',splCode);
	PageManager.DataService.callDataService('getBillNo');


	//alert(document.getElementById('bill_No').value);

}
function openSearch3(obj)
	{
			var a = new Array(2);
			var sRtn;
			var str = "tdsdec";
			sRtn= showModalDialog("Search.html?screenName="+str,"","dialogLeft=300;dialogTop=210;dialogWidth=305pt;dialogHeight=300pt;status=no;");
			if(sRtn != '')
			{
				a = sRtn.split(",");
				var x = PageManager.DataService.getControlInBranch(obj.parentNode,'workstdscode');
				x.value = a[0];
				//var y = PageManager.DataService.getControlInBranch(obj.parentNode.parentNode,'coa_name');
				//y.value = a[1];
				var z = PageManager.DataService.getControlInBranch(obj.parentNode.parentNode,'worksDetail_workstds');
				z.value = a[2];
				//alert("glcode++++"+z.value);
				x.focus()


			}
	}

</script>
</head>
<body bgcolor="#ffffff"  onKeyDown ="CloseWindow(event);" bottommargin="0" topmargin="0" rightmargin="0" leftmargin="0" marginheight="0" marginwidth="0" onLoad="getData();">
<form name="WorksDetailAdd">
<input type="hidden" name="egUser_id" id="egUser_id">
<input type="hidden" name="worksDetail_ID" id="worksDetail_ID" >
<input type="hidden" name="worksDetail_lastModified" id="worksDetail_lastModified" >
<input type="hidden" name="tableName" id="tableName" value="eg_billregister">
<input  type="hidden" name="relationId" id="relationId" >
<input  type="hidden" name="worksDetail_advanceAmount" id="worksDetail_advanceAmount" >
<input  type="hidden" name="worksDetail_orderDate" id="worksDetail_orderDate" >
<input  type="hidden" name="id" id="id" >
<input  type="hidden" name="bill_No" id="bill_No" >
<input  type="hidden" name="status" id="status" >
<input  type="hidden" name="billNumber" id="billNumber" >
<input  type="hidden" name="modeOfExec" id="modeOfExec" >
<input  type="hidden" name="mode" id="mode" >

<table width="100%" height="74%" border="0" cellpadding="0" cellspacing="0">
	  </table>
	<table width="100%" border=0 cellpadding="6" cellspacing="0">
			<tr>
			<td valign="top" class="normaltext"><!------------Content begins here ------------------>
						<table width="100%" border=0 cellpadding="3" cellspacing="0" id="worksDetail" name="worksDetail" >
        <TBODY>
							<tr>
								<td class="rowheader" colspan="4" width="898"><span id="screenName" class="headerwhite2">Modify Bill Register</span></td>
							</tr>
							<tr id ="orderRow" name ="orderRow" class="row1" >
							  <td  width="294"><div align="right" class="normaltext">Bill Number<span class="leadon" >*</span></div></td>
							   <td width="279">
								<input name="bill_code" class="fieldinput" id="bill_code" size="10" exilDataType="exilAlphaNumeric"  onBlur="checkBillNo(this.value)" exilMustEnter="true" >
							  </td>

							  <td width="294"><div align="right" class="normaltext">Bill Date<span class="leadon">*</span></div></td>
							  <td width="279"><input name="bill_Date" id="bill_Date" class="datefieldinput"  size="10"  onkeyup="DateFormat(this,this.value,event,false,'3')"exilMustEnter="true" exilDataType="exilPastDate" exilCalendar="true">
							  </td>
							  </tr >

							<tr class="row1">

							 <td align="right" valign="center" >
            							<DIV align=right class="normaltext" >Procurement&nbsp;Order</DIV>
									</td>
									<td  >
                    					<SELECT  id="bill_Po" name="bill_Po" class="fieldinput"  exilListSource="billRegister">
           								</SELECT>
									</td>
									<!--  <td>
									<select name="Parent" id="Parent" class="fieldinput" maxlength=50 exilListSource="newDepartmentNameList" onChange="onChangeParentType();"></select></td>
									<td><INPUT TYPE="hidden" NAME="code"></td> -->

									 <td width="294"><div align="right" class="normaltext">Payment Requested Date<span class="leadon">*</span></div></td>
							  <td width="279"><input name="bill_PayDate" id="bill_PayDate" class="datefieldinput"  size="10"  onkeyup="DateFormat(this,this.value,event,false,'3')"exilMustEnter="true" exilDataType="exilAnyDate" exilCalendar="true">
							  </td>
							</tr>
							<tr class="row2">
							  <td width="294" ><div align="right" class="normaltext">Bill Amount </div></td>
							<td width="279" ><input name="bill_Amount" class="fieldinput" id="bill_Amount" size="250" exilDataType="exilAnyChar"> </td>

							<td width="294" ><div align="right" valign="center" class="normaltext" >Bill Status<span class="leadon">*</span></div></td>
					<td width="279" >
						<select class="fieldinput" name="bill_Status" id="bill_Status"   exilMustEnter="true"  >
						<option value="" selected
             >&nbsp;</option>
						<option value="Running Bill"
             >Running Bill</option>
						<option value="Final Bill">Final Bill</option>

						</select>
					</td>


							</tr>


							<tr class="row2">

							<td width="294" ><div align="right" class="normaltext"> Narration</div></td>
							<td width="279"><TEXTAREA name="bill_Narration" exilDataType="exilAnyChar"></TEXTAREA> </td>
							<td width="203" style="DISPLAY: none"><input type="checkbox" name="bill_isActive" id="bill_isActive" ></td>

							 <td width="294" ><div align="right" class="normaltext">Bill  Approval Status  <span class="leadon">*</span></div></td>
							<!-- <td width="279" ><input name="bill_AppStaus" class="fieldinput" id="bill_AppStaus" size="250" exilDataType="exilAnyChar" exilMustEnter="true" value="PENDING"> </td> -->
						<td width="279" >
						<select class="fieldinput" name="bill_AppStaus" id="bill_AppStaus" exilMustEnter="true" >

						<option value="PENDING" selected>PENDING</option>
						<option value="REJECTED" >REJECTED</option>
             		     </select></td>

						</tr>

                             <tr class="row1">
				<td height="25" colspan="4" valign="bottom" class="smalltext" width="898"><p class="smalltext">&nbsp;</p>
				</td>
			</tr>

			<tr class="row1">
			<td height="25" colspan="4" valign="bottom" class="smalltext" width="968"><p class="smalltext"><span class="leadon">*</span>
					- Mandatory Fields</p>
			</td>
			<tr class="row2">
							<td colspan="4" align="middle" width="1300"><!-- Buttons Start Here -->
								<table border="0" cellpadding="0" cellspacing="0">
						<tr name="trModify" id="trModify">
						<td align="right"><IMG height=18 src="/egi/resources/erp2/images/Button_leftside.gif" width=7></td>
						<td bgcolor="#fe0000" valign="center" nowrap><A class=buttonprimary id=submitButton onclick="ButtonPress('saveclose')" href="#">Submit</A></td>
						<td><IMG height=18 src="/egi/resources/erp2/images/Button_rightside.gif" width=7></td>
						<td><IMG src="/egi/resources/erp2/images/spacer.gif" width=8></td>
						<td align="right"><IMG height=18 src="/egi/resources/erp2/images/Button_second_leftside.gif" width=6></td>
						<td bgcolor="#ffffff" valign="center" nowrap background="/egi/resources/erp2/images/Button_second_middle.gif"><A class=buttonsecondary onclick=onClickCancelMod(); href="#">Cancel</A></td>
						<td><IMG height=18 src="/egi/resources/erp2/images/Button_second_rightside.gif" width=6></td>
						<td><IMG src="/egi/resources/erp2/images/spacer.gif" width=8></td>
						<td align="right"><IMG height=18 src="/egi/resources/erp2/images/Button_second_leftside.gif" width=6></td>
						<td bgcolor="#ffffff" valign="center" nowrap background="/egi/resources/erp2/images/Button_second_middle.gif"><A class=buttonsecondary onclick=window.close() href="#">Close</A></td>
						<td><IMG height=18 src="/egi/resources/erp2/images/Button_second_rightside.gif" width=6></td>
						</tr>
						<tr name="trNew" id="trNew">
						<td align="right"><IMG height=18 src="/egi/resources/erp2/images/Button_leftside.gif" width=7></td>
						<td bgcolor="#fe0000" valign="center" nowrap><A class=buttonprimary id=savenNew onclick="ButtonPress('savenew')" href="#">Save &amp; New</A></td>
						<td><IMG height=18 src="/egi/resources/erp2/images/Button_rightside.gif" width=7></td>
						<td><IMG src="/egi/resources/erp2/images/spacer.gif" width=8></td>
						<td align="right"><IMG height=18 src="/egi/resources/erp2/images/Button_leftside.gif" width=7></td>
						<td bgcolor="#fe0000" valign="center" nowrap><A class=buttonprimary id=savenClose onclick="ButtonPress('saveclose')" href="#">Save &amp; Close</A></td>
						<td><IMG height=18 src="/egi/resources/erp2/images/Button_rightside.gif" width=7></td>
						<td><IMG src="/egi/resources/erp2/images/spacer.gif" width=8></td>
						<td align="right"><IMG height=18 src="/egi/resources/erp2/images/Button_second_leftside.gif" width=6></td>
						<td bgcolor="#ffffff" valign="center" nowrap background="/egi/resources/erp2/images/Button_second_middle.gif"><A class=buttonsecondary onclick=onClickCancel(); href="#">Cancel</A></td>
						<td><IMG height=18 src="/egi/resources/erp2/images/Button_second_rightside.gif" width=6></td>
						<td><IMG src="/egi/resources/erp2/images/spacer.gif" width=8></td>
						<td align="right"><IMG height=18 src="/egi/resources/erp2/images/Button_second_leftside.gif" width=6></td>
						<td bgcolor="#ffffff" valign="center" nowrap background="/egi/resources/erp2/images/Button_second_middle.gif"><A class=buttonsecondary onclick=window.close() href="#">Close</A></td>
						<td><IMG height=18 src="/egi/resources/erp2/images/Button_second_rightside.gif" width=6></td>
						</tr>

						</table><!-- Buttons End Here -->
					</td>
				</tr>
			</table></TD></TR></TBODY></TABLE></TD></TR></TABLE><!------------ Content ends here ------------------></TD></TR></TABLE></TD><!------------Right Navigation Ends here------------------></TR></TABLE><!---------------- Footer begins here ----------><!---------------- Footer ends here ---------->
</form>
</body>
</html>
