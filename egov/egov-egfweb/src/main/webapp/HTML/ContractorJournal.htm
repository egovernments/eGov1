#-------------------------------------------------------------------------------
# eGov suite of products aim to improve the internal efficiency,transparency, 
#      accountability and the service delivery of the government  organizations.
#   
#       Copyright (C) <2015>  eGovernments Foundation
#   
#       The updated version of eGov suite of products as by eGovernments Foundation 
#       is available at http://www.egovernments.org
#   
#       This program is free software: you can redistribute it and/or modify
#       it under the terms of the GNU General Public License as published by
#       the Free Software Foundation, either version 3 of the License, or
#       any later version.
#   
#       This program is distributed in the hope that it will be useful,
#       but WITHOUT ANY WARRANTY; without even the implied warranty of
#       MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#       GNU General Public License for more details.
#   
#       You should have received a copy of the GNU General Public License
#       along with this program. If not, see http://www.gnu.org/licenses/ or 
#       http://www.gnu.org/licenses/gpl.html .
#   
#       In addition to the terms of the GPL license to be adhered to in using this
#       program, the following additional terms are to be complied with:
#   
#   	1) All versions of this program, verbatim or modified must carry this 
#   	   Legal Notice.
#   
#   	2) Any misrepresentation of the origin of the material is prohibited. It 
#   	   is required that all modified versions of this material be marked in 
#   	   reasonable ways as different from the original version.
#   
#   	3) This license does not grant any rights to any user of the program 
#   	   with regards to rights under trademark law for use of the trade names 
#   	   or trademarks of eGovernments Foundation.
#   
#     In case of any queries, you can reach eGovernments Foundation at contact@egovernments.org.
#-------------------------------------------------------------------------------
<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
	<head>


			<script>

			var str="";
			var isDrillDown="false";
			var glNameCode;
			var dedGridObj;
 			var isIE;
 			var req2;
			var req;
			var codeArray;
			var j=-1;
			var k=-1;
			var completeTable;
			var sIndex,sValue,sText;
			var wIndex,wValue,wText;
			var acccodeArray;
			var codeObj;
			var dedAcccodeArray;
			var dedCodeObj;
			var conNameArray;
			var conNameObj;
			var worksArray;
			var worksObj;
			var funcArray;
			var funcObj;
			var yuiflag = new Array();
			var billAmtBlur_noOfTimes=0;

function isValidAmount(){
	var billAmount=document.getElementById('contractorBillDetail_billAmount').value;
	var passedAmount=document.getElementById('contractorBillDetail_passedAmount').value ;
	var totalValue=document.getElementById('worksDetail_totalValue').value;
	var totalPassedAmount=document.getElementById('worksDetail_totalPassedAmount').value;
	if(isNaN(parseInt(totalPassedAmount)))totalPassedAmount="0";
	var advanceAmount=document.getElementById('worksDetail_advanceAmount').value ;
	var adjustmentAmount=document.getElementById('worksDetail_adjustmentAmount').value ;
	if(isNaN(parseInt(adjustmentAmount)))adjustmentAmount="0";
	/*if((parseFloat(billAmount)+parseFloat(totalPassedAmount))>parseFloat(totalValue)){
		alert("Bill amount cannot exceeded total amount");
		document.getElementById('contractorBillDetail_billAmount').focus();
		return false;
	}
	if((parseFloat(passedAmount)+parseFloat(adjustmentAmount))>parseFloat(billAmount))
	 {
		alert("Passed amount and adjustment amount exceeded bill amount:");
		document.getElementById('contractorBillDetail_passedAmount').focus();
		return false;
	}*/
	if(parseFloat(adjustmentAmount)>parseFloat(advanceAmount)){
		alert("Adjustment amount cannot exceed advance amount");
		document.getElementById('worksDetail_adjustmentAmount').focus();
		return false;
	}
	/*if(((parseFloat(passedAmount)+parseFloat(advanceAmount))-parseFloat(adjustmentAmount))>(parseFloat(totalValue)-parseFloat(totalPassedAmount)))
	 {
		alert("Adjust advance amount and passed amount ");
		document.getElementById('contractorBillDetail_passedAmount').focus();
		return false;
	}*/
/*	if(((parseFloat(totalValue)-parseFloat(totalPassedAmount))-(parseFloat(passedAmount)+parseFloat(adjustmentAmount)))<
		(parseFloat(advanceAmount)-parseFloat(adjustmentAmount)))
	 {
		alert("Adjust advance amount and passed amount ");
		document.getElementById('contractorBillDetail_passedAmount').focus();
		return false;
	}*/
	if(	(parseFloat(passedAmount)<=0) &&
		((parseFloat(totalValue)-parseFloat(totalPassedAmount))!=parseFloat(advanceAmount))){
		alert("Passed Amount cannot be zero ");
		document.getElementById('contractorBillDetail_passedAmount').focus();
		return false;
	}
	return true;
}
function showAdvanceRow(flag){
	var tab=document.getElementById('TABLEM');
	if(!flag){
		tab.rows[7].style.display='none';
	}
	else{
		tab.rows[7].style.display='block';
	}
}

function clearCombo(cId)
{
   var bCtrl=document.getElementById(cId);
   for(var i=bCtrl.options.length-1;i>=0;i--)
   {
   	bCtrl.remove(i);
   }
   var obj=document.getElementById('worksDetail_orderDate');
   obj.value="";
   obj=document.getElementById('worksDetail_totalValue');
   obj.value="";
   obj=document.getElementById('worksDetail_totalPassedAmount');
   obj.value="";
   obj=document.getElementById('worksDetail_advanceAmount');
   obj.value="";
   obj=document.getElementById('worksDetail_adjustmentAmount');
   obj.value="";
   document.getElementById('worksDetail_outstandingAmount').value="";
   //showAdvanceRow(false);
}


/*function loadWorkOrders(splCode){
	//clearCombo('worksDetail_name');
	if(splCode==null || splCode=="")return;
	PageManager.DataService.setQueryField('supplierCode',splCode);
	//var obj=document.getElementById('worksDetail_name');
	//obj.setAttribute('exilListSource','conBillDetail_worksDetailID');
	PageManager.DataService.callDataService('workOrderNameList');
}*/
function loadWorkOrderData(workOrderId){
	if(workOrderId.length==0)return;
	PageManager.DataService.setQueryField('workOrderID',workOrderId);
	PageManager.DataService.callDataService('workOrderData');
	PageManager.DataService.callDataService('getworktds');
	loadFund();
	loadFundSource(workOrderId);
	var tableObj=document.getElementById("gridContractorJournal");
	//alert("tableObj.rows.length"+tableObj.rows.length);
	//var gltable= document.getElementById("gridContractorJournal");
		for(var i=tableObj.rows.length-1;i>=1;i--)
			{
				tableObj.deleteRow(i);
			}


	PageManager.DataService.addNewRow('gridContractorJournal');
	PageManager.DataService.addNewRow('gridContractorJournal');


}
function onBodyLoad(){
document.getElementById('voucherHeader_voucherNumber').focus();

document.title="Contractor Bill";
document.getElementById('reverseSubmit').style.display ="none";
	showAdvanceRow(true);
	PageValidator.addCalendars();
	//PageManager.ListService.callListService();

	var cgn=PageManager.DataService.getQueryField('cgNumber');
	var sm=PageManager.DataService.getQueryField('showMode');
	hideDedColumn(2);

		 if(cgn && (sm=="modify"))
		 {			isDrillDown="true";
					PageManager.DataService.setQueryField('cgNumber',cgn);
					PageManager.DataService.setQueryField("parttypecode",'Contractor');
					//var obj=document.getElementById('worksDetail_name');
					//var obj=document.getElementById('worksDetail_id');
					//obj.setAttribute('exilListSource','conBillDetail_worksDetailID');
					PageManager.DataService.callDataService('getWoDetails');
					document.getElementById('modGrid').style.display='block';
					document.getElementById('submitGrid').style.display ="none";
					document.getElementById('voucherHeader_voucherNumber').setAttribute('exilDataType','exilAlphaNumeric');
					document.getElementById('cgnLabel').style.display='block';
					document.getElementById('cgnText').style.display='block';
					 document.getElementById('backbutton').style.display="none";
					document.getElementById('IMG1').style.display ="none";
					document.getElementById('IMG2').style.display ="none";
					document.getElementById('statusInfo').style.display ="none";
					//document.getElementById('screenName').innerHTML="Contractor Bill -Reverse";
					disableControls(0,true);

		}
		if(cgn && (sm=="view"))
		 {
						isDrillDown="true";
						PageManager.DataService.setQueryField('cgNumber',cgn);
						PageManager.DataService.setQueryField("parttypecode",'Contractor');
						//var obj=document.getElementById('worksDetail_id');
						//obj.setAttribute('exilListSource','conBillDetail_worksDetailID');
						PageManager.DataService.callDataService('getWoDetails');
						document.getElementById('modGrid').style.display='none';
						document.getElementById('submitGrid').style.display ="none";
						document.getElementById('IMG1').style.display ="none";
						document.getElementById('IMG2').style.display ="none";
						document.getElementById('cgnLabel').style.display='block';
						document.getElementById('cgnText').style.display='block';
						 document.getElementById('backbutton').style.display="block";
						 //document.getElementById('screenName').innerHTML="Contractor Bill -View";
						disableControls(0,true);
		}
		else if(cgn && (sm=="edit")){
				isDrillDown=true;
				//PageManager.DataService.callDataService('miscReceiptList');
				PageManager.DataService.setQueryField('cgNumber',cgn);
				PageManager.DataService.setQueryField("parttypecode",'Contractor');
				//var obj=document.getElementById('worksDetail_id');
				var obj=document.getElementById('worksDetail_name');
				//obj.setAttribute('exilListSource','conBillDetail_worksDetailID');
				PageManager.DataService.callDataService('getWoDetails');
				//alert("length"+obj.options.length-1);
				//obj.remove(obj.options.length-1);

				document.getElementById('voucherHeader_voucherNumber').setAttribute('exilDataType','exilAlphaNumeric');
		  		document.getElementById('modGrid').style.display='none';
		  		document.getElementById('submitGrid').style.display ="none";
		  		document.getElementById('saveandnew').style.display ="none";
		  		document.getElementById('cgnLabel').style.display='block';
		  		document.getElementById('cgnText').style.display='block';
		  		document.getElementById('backbutton').style.display='none';
		  		document.getElementById('statusInfo').style.display ="none";
		  		//document.getElementById('screenName').innerHTML="Contractor Bill -Modify";
				edit();
		 	 }


	if(!cgn)
	{
		//showAdvanceRow(false);
		PageManager.DataService.callDataService('cgNumber');
		PageManager.DataService.addNewRow('gridContractorJournal');
		document.getElementById('backbutton').style.display="none";

		//PageManager.DataService.addNewRow('gridContractorDeduction');
		//document.contractorJournal.voucherHeader_voucherNumber.focus();
		obj=document.getElementById('modGrid').style.display="none";
		document.getElementById('statusInfo').style.display ="none";
	}


	 loadDropDownCodes();
	 loadDropDownContractors();
	 loadDropDownDeductionCodes();
	 loadDropDownFuncNames();

	 }

	 function loadDropDownCodes()
	 {

	 	var type='getAllCoaCodes';
		var url = "../commons/Process.jsp?type=" +type+ " ";
		var req2 = initiateRequest();
		req2.onreadystatechange = function()
		{
			  if (req2.readyState == 4)
			  {
				  if (req2.status == 200)
				  {
					var codes2=req2.responseText;
					var a = codes2.split("^");
					var codes = a[0];
					acccodeArray=codes.split("+");
					codeObj = new YAHOO.widget.DS_JSArray(acccodeArray);


				  }
			  }
		};
		req2.open("GET", url, true);
		req2.send(null);
	 }
function loadDropDownFuncNames()
	 {

	 	var type='getAllFunctionName';
		var url = "../commons/Process.jsp?type=" +type+ " ";
		var req2 = initiateRequest();
		req2.onreadystatechange = function()
		{
			  if (req2.readyState == 4)
			  {
				  if (req2.status == 200)
				  {
					var codes2=req2.responseText;
					var a = codes2.split("^");
					var codes = a[0];
					funcArray=codes.split("+");
					funcObj= new YAHOO.widget.DS_JSArray(funcArray);


				  }
			  }
		};
		req2.open("GET", url, true);
		req2.send(null);
	 }



 	 function loadDropDownContractors()
		 {
//alert("hi");
			var url="../commons/Process.jsp?type=contractorName";
			var req = initiateRequest();
			req.onreadystatechange = function()
			{
				  if (req.readyState == 4)
				  {
					if (req.status == 200)
						{
							var codes2=req.responseText;
							var a = codes2.split("^");
							var codes = a[0];
							var conNameArray=codes.split("+");
							conNameObj = new YAHOO.widget.DS_JSArray(conNameArray);
						}
				  }
			};
			//alert("hi");
			req.open("GET", url, true);
			req.send(null);

 	}
 	 function loadDropDownDeductionCodes()
		 {

		 	var type='getAllCoaCodes';
			var url = "../commons/Process.jsp?type=" +type+ " ";
			var req2 = initiateRequest();
			req2.onreadystatechange = function()
			{
				  if (req2.readyState == 4)
				  {
					  if (req2.status == 200)
					  {
						var codes2=req2.responseText;
						var a = codes2.split("^");
						var codes = a[0];
						dedAcccodeArray=codes.split("+");
						dedCodeObj = new YAHOO.widget.DS_JSArray(dedAcccodeArray);


					  }
				  }
			};
			req2.open("GET", url, true);
			req2.send(null);
	 }
/*
		 * The following code implements Ajax autocomplete through YUI.
		 *
		 */

	/* function loadWorkOrders()
	 {
		 var relationTypeId='2';
		 var relationId=document.getElementById('relation_id').value;
		//worksObj=null;
            var url = "../commons/Process.jsp?type=workDetailName&relationTypeId=" +relationTypeId+"&relationId="+relationId ;
		 //var url = "../commons/Process.jsp?type=workDetailName";
		 var req = initiateRequest();
		 req.onreadystatechange = function()
				{
								  if (req.readyState == 4)
								  {

									if (req.status == 200)

										{
											var codes2=req.responseText;
											var a = codes2.split("^");
											var codes = a[0];
											 worksArray=codes.split("+");
											worksObj = new YAHOO.widget.DS_JSArray(worksArray);
										}


								  }
				};


				req.open("GET", url, true);
				req.send(null);

	 }*/

	function autocompletecode(obj)
	{
		var currRow=PageManager.DataService.getRow(obj);
		var coaCodeObj = PageManager.DataService.getControlInBranch(currRow,'chartOfAccounts_glCode');

		container=document.getElementById('codescontainer');
		objPosition=findPos(obj);
		container.style.position="absolute";
		container.style.left=objPosition[0];
		container.style.top=objPosition[1]+20;
		if(yuiflag[currRow.rowIndex] == undefined)
		{
					if(event.keyCode != 40 )
					{
						if(event.keyCode != 38 )
						{

								var oAutoComp = new YAHOO.widget.AutoComplete(coaCodeObj,'codescontainer', codeObj);
								oAutoComp.queryDelay = 0;
								oAutoComp.prehighlightClassName = "yui-ac-prehighlight";
								oAutoComp.useShadow = true;
								oAutoComp.maxResultsDisplayed = 15;
   								oAutoComp.useIFrame = true;
						}
					}

					yuiflag[currRow.rowIndex] = 1;
		}

	}
	function autocompletefuncName(obj)
	{
		var currRow=PageManager.DataService.getRow(obj);
		var coaCodeObj = PageManager.DataService.getControlInBranch(currRow,'function_code');
		container=document.getElementById('codescontainer');
		objPosition=findPos(obj);
		container.style.position="absolute";
		container.style.left=objPosition[0];
		container.style.top=objPosition[1]+20;

		//40 --> Down arrow, 38 --> Up arrow
		if(yuiflag[currRow.rowIndex] == undefined)
   		{
					if(event.keyCode != 40 )
					{
						if(event.keyCode != 38 )
						{

								var oAutoComp = new YAHOO.widget.AutoComplete(coaCodeObj,'codescontainer', funcObj);
								oAutoComp.queryDelay = 0;
								oAutoComp.prehighlightClassName = "yui-ac-prehighlight";
								oAutoComp.useShadow = true;
								oAutoComp.maxResultsDisplayed = 15;
   								oAutoComp.useIFrame = true;
						}
						if(event.keyCode == 13)
							{}
					}
					yuiflag[currRow.rowIndex] = 1;
   		}

	}

	function autocompleteDedCode(obj)
		{
			var currRow=PageManager.DataService.getRow(obj);
			var coaCodeObj = PageManager.DataService.getControlInBranch(currRow,'DedchartOfAccounts_glCode');
			container=document.getElementById('codescontainer');
			objPosition=findPos(obj);
			container.style.position="absolute";
			container.style.left=objPosition[0];
			container.style.top=objPosition[1]+20;
			//40 --> Down arrow, 38 --> Up arrow
			if(yuiflag[currRow.rowIndex] == undefined)
   			{
						if(event.keyCode != 40 )
						{
							if(event.keyCode != 38 )
							{

									var oAutoComp = new YAHOO.widget.AutoComplete(coaCodeObj,'codescontainer', dedCodeObj);
									oAutoComp.queryDelay = 0;
									oAutoComp.prehighlightClassName = "yui-ac-prehighlight";
									oAutoComp.useShadow = true;
							}
						}
						yuiflag[currRow.rowIndex] = 1;
   			}

	}

function autocompleteConList(obj)
	{

		//40 --> Down arrow, 38 --> Up arrow
 //window.captureEvents(Event.CLICK);
 document.getElementById('contractor_code').value="";
 document.getElementById('worksDetail_name').value="";
 document.getElementById('worksDetail_code').value="";
 container=document.getElementById('codescontainer');
objPosition=findPos(obj);
container.style.position="absolute";
container.style.left=objPosition[0]+10;
container.style.top=objPosition[1]+20;

					if(event.keyCode != 40 )
					{
						if(event.keyCode != 38 )
						{
								var oAutoComp = new YAHOO.widget.AutoComplete(obj,'codescontainer', conNameObj);
								oAutoComp.queryDelay = 0;
								oAutoComp.prehighlightClassName = "yui-ac-prehighlight";
								oAutoComp.useShadow = true;
								oAutoComp.maxResultsDisplayed = 30;
								oAutoComp.useIFrame = true;

						}


					/*	if(event.keyCode == 13)
						{
							 var arr=document.getElementById('contractor_name').value.split("`-`");
							if(arr[1]==null){ alert("Enter valid contractor name"); return  }
							else{
								document.getElementById('contractor_name').value=arr[0];
								document.getElementById('contractor_code').value=arr[1];
								getAccName(event);
								 return false;
								}
						}*/


			}

			if(event.type=='click')	{alert("clicked"); }

//window.releaseEvents(event.CLICK);

	}

function autocompleteWorkList(obj)
	{

			//loadWorkOrders();
			if(event.keyCode!= 13) obj.value=" ";
			if(event.type=='click')	{alert("clicked"); }
			 var relationTypeId='2';
		      var relationId=document.getElementById('relation_id').value;

          //  var url = "../commons/Process.jsp?type=workDetailName&relationTypeId=" +relationTypeId+"&relationId="+relationId ;
		//40 --> Down arrow, 38 --> Up arrow

					if(event.keyCode != 40 )
					{
						if(event.keyCode != 38 )
						{

								var oAutoComp = new YAHOO.widget.AutoComplete(obj,'codescontainer', worksObj);
								oAutoComp.queryDelay = 0;
								oAutoComp.prehighlightClassName = "yui-ac-prehighlight";
								oAutoComp.useShadow = true;
								oAutoComp.maxResultsDisplayed = 30;
						}

						/*if(event.keyCode == 13)
						{
							 var arr=document.getElementById('worksDetail_name').value.split("`-`");
							if(arr[1]==null){ alert("Enter valid Work name"); return  }
							else{
								document.getElementById('worksDetail_name').value=arr[0].substring(1, arr[0].length);

								document.getElementById('worksDetail_code').value=arr[1];
								getAccName(event);
								 return false;
								}
						}*/


					}


	}

function findPos(obj)
{
	var curleft = curtop = 0;
	if (obj.offsetParent)
	{
		curleft = obj.offsetLeft;
		curtop = obj.offsetTop;
		while (obj = obj.offsetParent)
		{ //alert(obj.nodeName);
			curleft =curleft + obj.offsetLeft;
			curtop =curtop + obj.offsetTop; //alert(curtop);
		}
	}
	return [curleft,curtop];
}


/*function loadWorkOrders(splCode){
	clearCombo('worksDetail_name');

	if(splCode==null || splCode=="")return;
	PageManager.DataService.setQueryField('supplierCode',splCode);
	var obj=document.getElementById('worksDetail_name');
	obj.setAttribute('exilListSource','conBillDetail_worksDetailID');

	PageManager.DataService.callDataService('workOrderNameList');
}
*/
function edit(){
				var cgn=PageManager.DataService.getQueryField('cgNumber');
		 		if(cgn){
		 			//document.forms[0].voucherHeader_cgn.disabled=true;
		 			//document.forms[0].voucherHeader_voucherNumber.disabled=true;
		 			document.getElementById("vnum").style.display="block";
		 			document.getElementById('submitGrid').style.display ="block";
					document.getElementById('modeOfExec').value="edit";
					//enableControls(0,false);
		 	 	}
		}


function beforeRefreshPage(dc)
{
	if(dc.values['glCodeName'])
	{
	  glNameCode=dc.values['glCodeName'];
	 showEntry();
	}
	if(dc.values['serviceID']=='getDedAmount' && dc.values['dedRate'])
	{

		  var rate=dc.values['dedRate'];
		  var table= document.getElementById("gridContractorDeduction");
		  if(isNaN(parseFloat(document.getElementById('contractorBillDetail_passedAmount').value)))
		  {
		  alert('Enter Passed Amount');
		  return;
		  }
		  else
		  {
		  	if(dc.values['dedRate'] && dc.values['dedRate']!='' && dc.values['dedRate']!='0'){
			  passedAmt=parseFloat(document.getElementById('contractorBillDetail_passedAmount').value);
			  var dedAmt=(passedAmt*rate)/100;
			}else
				dedAmt=dc.values['deductionamount'];

	  	 }

		   trObj=PageManager.DataService.getRow(dedGridObj);
		   objt1=PageManager.DataService.getControlInBranch(trObj,'dedAmount');
		   objt1.value=dedAmt;
	}


	if(dc.values['serviceID']=='cgNumber'){
		if(isNaN(parseInt(dc.values['voucherHeader_cgn']))) return;
		dc.values['voucherHeader_cgn'] = 'CJV' + dc.values['voucherHeader_cgn'];
	}else if(dc.values['serviceID']=='workOrderData'){
		var advAmount=dc.values['worksDetail_advanceAmount'];
		if(advAmount!=null &&  parseFloat(advAmount)>0)
		 showAdvanceRow(true);
		//else
		// showAdvanceRow(false);
	}

	if(isDrillDown && (dc.values['serviceID']=='getContractorDetails' || dc.values['serviceID']=='getContractorDetailsModify' ))
	{
		 dc=createRowIndex(dc,'gridContractorJournal','entities_grid');
	}

	if(billAmtBlur_noOfTimes==0 && dc.values['serviceID']=='getConTDSCodes' && dc.values['showMode']=='new'){
		var gridContractorDeduction=document.getElementById('gridContractorDeduction');
			for(var i=gridContractorDeduction.rows.length-1;i>1;i--){
				gridContractorDeduction.deleteRow(i);
			}
			PageManager.DataService.getControlInBranch(gridContractorDeduction.rows[1],'tds_Code').setAttribute('exilListSource','TDSList');
			setAttribute_rowsToClone('gridContractorDeduction');
			PageManager.DataService.addNewRow('gridContractorDeduction');
			gridContractorDeduction.deleteRow(1);
	 }
	if(billAmtBlur_noOfTimes==0 && dc.values['serviceID']=='getConTDSCodes' && (dc.values['showMode']=='new' || dc.values['showMode']=='view' || dc.values['showMode']=='edit')){
		var gridContractorDeduction=document.getElementById('gridContractorDeduction');
			for(var i=gridContractorDeduction.rows.length-1;i>1;i--){
				gridContractorDeduction.deleteRow(i);
			}
			PageManager.DataService.getControlInBranch(gridContractorDeduction.rows[1],'tds_Code').setAttribute('exilListSource','TDSList');
			setAttribute_rowsToClone('gridContractorDeduction');
	 }
	 if(billAmtBlur_noOfTimes>0 && dc.values['serviceID']=='getConTDSCodes' && (dc.values['showMode']=='edit' )){
	 		var gridContractorDeduction=document.getElementById('gridContractorDeduction');
	 		//as tds list was not assigning, we are deleting all rows except 1st row in deduction grid and adding only one row,
	 		for(var i=gridContractorDeduction.rows.length-1;i>1;i--){
	 			gridContractorDeduction.deleteRow(i);
	 		}
			PageManager.DataService.getControlInBranch(gridContractorDeduction.rows[1],'tds_Code').setAttribute('exilListSource','TDSList');

			setAttribute_rowsToClone('gridContractorDeduction');
			PageManager.DataService.addNewRow('gridContractorDeduction');
	 }





}

	function funClear(obj, tableName)
		 {
		   if(tableName.toLowerCase() == 'chartofaccounts')
			{
				var v =PageManager.DataService.getControlInBranch(obj.parentNode.parentNode,'function_code')
				var w =PageManager.DataService.getControlInBranch(obj.parentNode.parentNode,'cv_fromFunctionCodeId')
				if(v.value=="")
				{
				v.value = "";
				w.value = "";
				}
			}
		}



	function openSearch(obj, tableName,gridName)
	{
	if(PageManager.DataService.getQueryField('showMode')!=null && (PageManager.DataService.getQueryField('showMode')=='view' || PageManager.DataService.getQueryField('showMode')=='modify')) return false;
		var a = new Array(4);
		var sRtn;
		var str="";
		if(tableName.toLowerCase()=='chartofaccounts'){
			var type=document.getElementById('worksDetail_type').value;
			if(!type){
				alert("Select Work  Order First");
				return;
			}
			if(type=='Capital Works'){
				str = "Search.html?filterServiceID=8";
				//str = "Search.html?screenName=contractorJVOrgWrks";
			}else if(type=='Repair Works' || type.toUpperCase()=='REPAIRS AND MAINTENANCE'){
				str = "Search.html?filterServiceID=12";
				//str = "Search.html?screenName=contractorJVRepWrks";
			}else if(type=='Other Service'){
				str = "Search.html?filterServiceID=15";
			}else if(type.toUpperCase()=='IMPROVEMENT WORKS'){
				str = "Search.html?filterServiceID=17";

			}
			else if(type=='Deposit Works'){
				str = "Search.html?filterServiceID=18";
			}
		}else if(tableName.toLowerCase()=='relation')
		{
			//str = "Search.html?tableNameForCode=relation&relationType=2";
			str = "Search.html?tableNameForCode=relationnames&relationType=2";
		}
		sRtn= showModalDialog(str,"","dialogLeft=300;dialogTop=210;dialogWidth=305pt;dialogHeight=300pt;status=no;");
		if(sRtn != '')
		{
			a = sRtn.split("`~`");
			if(tableName.toLowerCase() == 'chartofaccounts')
			{
				if(gridName.toLowerCase() == 'deduction')
				{
				var x = PageManager.DataService.getControlInBranch(obj.parentNode.parentNode,'coa_name');
				x.value = a[1];
				var y = PageManager.DataService.getControlInBranch(obj.parentNode.parentNode,'gl_Code');
				y.value = a[0];


				var z = PageManager.DataService.getControlInBranch(obj.parentNode.parentNode,'DedchartOfAccounts_glCode');
				z.value = a[0];
				var u = PageManager.DataService.getControlInBranch(obj.parentNode.parentNode,'tds_Code');
				u.value="";
				var v =PageManager.DataService.getControlInBranch(obj.parentNode.parentNode,'function_code1')
				if(v.value=="")
					{
						v.value = a[4];
						var w =PageManager.DataService.getControlInBranch(obj.parentNode.parentNode,'cv_fromFunctionCodeId1')
						w.value = a[3];
					}

				}
			else
			{
				var x = PageManager.DataService.getControlInBranch(obj.parentNode,'chartOfAccounts_glCode');
				x.value = a[0];
				var y = PageManager.DataService.getControlInBranch(obj.parentNode.parentNode,'chartOfAccounts_name');
				y.value = a[1];
				var v =PageManager.DataService.getControlInBranch(obj.parentNode.parentNode,'function_code')
				if(v.value=="")
				{
				v.value = a[3];
				var w =PageManager.DataService.getControlInBranch(obj.parentNode.parentNode,'cv_fromFunctionCodeId')
				w.value = a[4];
				}
				//alert("a 0 value= "+a[0]+" a 1 value = " +a[1]+" a 2 value ="+a[2]+" a 3 value = " +a[3]+" a 4 value= "+a[4]);
			}
		}
			if(tableName.toLowerCase() == 'relation')
			{
				var x = PageManager.DataService.getControlInBranch(obj.parentNode,'contractor_code');
				var y = document.getElementById('relation_id');
				x.value = a[0];
				y.value = a[2];
				var z = PageManager.DataService.getControlInBranch(obj.parentNode.parentNode,'contractor_name');
				z.value = a[1];
				//loadWorkOrders(a[0]);
			}
		}

	}
	function openSearch1(obj, tableName){
if(PageManager.DataService.getQueryField('showMode')!=null && (PageManager.DataService.getQueryField('showMode')=='view' || PageManager.DataService.getQueryField('showMode')=='modify')) return false;		var a = new Array(2);
		var sRtn;
		var str="";
		if(tableName.toLowerCase()=='function'){
		 str = "Search.html?tableNameForCode=function";

		sRtn= showModalDialog(str,"",
				"dialogLeft=300;dialogTop=210;dialogWidth=305pt;dialogHeight=300pt;status=no;");
		if(sRtn != '')
		{
			a = sRtn.split("`~`");

			if(tableName.toLowerCase() == 'function')
			{
				//alert("a 0 value= "+a[0]+" a 1 value = " +a[1]+" a 2 value ="+a[2]);
				var y = PageManager.DataService.getControlInBranch(obj.parentNode,'function_code');
				y.value = a[1];
				var x = PageManager.DataService.getControlInBranch(obj.parentNode,'cv_fromFunctionCodeId');
				x.value = a[2];
				document.getElementById('function_code1').value=y.value;
				document.getElementById('cv_fromFunctionCodeId1').value=x.value;


			}
		}
	loadFunctionCodes();
	}

  }
  function openSearch2(obj, tableName){ // used to populate functions, workorders
		if(PageManager.DataService.getQueryField('showMode')!=null && PageManager.DataService.getQueryField('showMode')=='view') return false;
		var a = new Array(2);
		var sRtn;
		var str="";
		if(tableName.toLowerCase()=='function'){
		 str = "Search.html?tableNameForCode=function";
		}else if(tableName.toLowerCase()=='worksdetail'){
			if(document.getElementById('relation_id').value=="") { alert("Select Contractor"); return;}
			str = "Search.html?tableNameForCode=worksdetail&relationId="+document.getElementById('relation_id').value;
		}
		sRtn= showModalDialog(str,"",
				"dialogLeft=300;dialogTop=210;dialogWidth=305pt;dialogHeight=300pt;status=no;");
		if(sRtn != '')
		{
			a = sRtn.split("`~`");

			if(tableName.toLowerCase() == 'function')
			{
				//alert("a 0 value= "+a[0]+" a 1 value = " +a[1]+" a 2 value ="+a[2]);
				var y = PageManager.DataService.getControlInBranch(obj.parentNode,'function_code1');
				y.value = a[1];
				var x = PageManager.DataService.getControlInBranch(obj.parentNode,'cv_fromFunctionCodeId1');
				x.value = a[2];
			}else if(tableName.toLowerCase() == 'worksdetail')
			{
				//alert("a 0 value= "+a[0]+" a 1 value = " +a[1]+" a 2 value ="+a[2]);
				var rowObj=PageManager.DataService.getRow(obj);
				//alert(rowObj.innerHTML);
				PageManager.DataService.getControlInBranch(rowObj,'worksDetail_id').value = a[2];
				PageManager.DataService.getControlInBranch(rowObj,'worksDetail_name').value=a[1];
				PageManager.DataService.getControlInBranch(rowObj,'worksDetail_code').value = a[0];

				setWorkCode();
				loadWorkCatNsubCat();
			}
		}

  }
       function colTotal(obj,target)
       {
	      var a = document.getElementsByName(obj.name);
 	      count = 0;
 	      for(var i = 0; i<=a.length-1;i++) {
 	      if(a[i].value)
 	      count += parseFloat(a[i].value);
 	      }
 	      document.getElementById(target).value=Math.round(count*100)/100;
	   }

			function checkNarration(narration)
			{
				if(narration.value.length>=250){
				  alert("Narration Cannot Be More Than " + 250 + " Characters");
				  return false;
				}
				return true;
			}

		function getAccName(event) {
			clearTable(document.getElementById("completeTable"));
			PageManager.DescService.onblur(event);
							}

	   function getFunId(event) {
			clearTable(document.getElementById("completeTable"));
			PageManager.DescService.onblur(event);
			}

		function ClearType(obj)
		{
		//if(obj.value.length==0)
		//	return;
			var p = PageManager.DataService.getControlInBranch(obj.parentNode.parentNode,'tds_Code');
			p.value="";
			var q = PageManager.DataService.getControlInBranch(obj.parentNode.parentNode,'coa_name');
			//q.value="";
			PageManager.DataService.getControlInBranch(obj.parentNode.parentNode,'dedAmount').value="";
			var y = PageManager.DataService.getControlInBranch(obj.parentNode.parentNode,'gl_Code');
			//y.value="";
			var x = PageManager.DataService.getControlInBranch(obj.parentNode.parentNode,'DedchartOfAccounts_glCode');
			y.value = x.value;

		}

        function ButtonPress(name)
        {
			document.getElementById('contractor_id').value=document.getElementById('relation_id').value;
             getNetamt();
			if(name.toLowerCase()=='savenew')
			str="new";
			if(name.toLowerCase()=='saveclose')
			str="close";
			var cgn=PageManager.DataService.getQueryField('cgNumber');
			var mode=PageManager.DataService.getQueryField('showMode');
			if(cgn)
			{
			 disableControls(0,false);
			}

			if(mode!='modify' ){

			  	var gltable= document.getElementById("gridContractorJournal");
			  	code=PageManager.DataService.getControlInBranch(gltable.rows[1],'chartOfAccounts_glCode').value;
			  	code1=PageManager.DataService.getControlInBranch(gltable.rows[1],'voucherDetail_debitAmount').value;
			  	//code2=PageManager.DataService.getControlInBranch(gltable.rows[1],'voucherDetail_creditAmount').value;

			  	if(code== ''){
				alert('Please enter the Account code ');
				return false;
				}
			  	if(code1== 0 ){
				alert('Please enter the Amount ');
				return false;
				}

				var vt=document.getElementById('voucherHeader_voucherDate').value;
				var wt=document.getElementById('worksDetail_orderDate').value;
				if( compareDate(formatDate6(wt),formatDate6(vt)) == -1 ){
						alert('Voucher Date cannot be prior to Work Order Date');
						return false;
		  		}
		  	var netAmt=parseFloat(document.getElementById("worksDetail_NetAmount").value);
					  	var adjustedAmt=parseFloat(document.getElementById("worksDetail_adjustmentAmount").value);
						var basicAmt=netAmt+adjustedAmt;
					  	if(basicAmt<0)
						{
						  alert("Deductions Cannot be greater than Passed Amount");
						  return false;
						}
						else if(adjustedAmt>0 && adjustedAmt>basicAmt)
						{
						   alert("Cannot Adjust Amount: "+adjustedAmt);
						   return false;
			}
       		if(!PageValidator.validateForm())
				return false;
			if(!isValidAmount())
				return false;
			if(!validate())
				return false;
			disableControls(0,false);
			document.getElementById('egUser_id').value = CookieManager.getCookie('currentUserId');
			var dbDate=document.getElementById('databaseDate').value;
			bdate=document.getElementById('contBillDetail_billDate').value
			if(!bdate)
			document.getElementById('contBillDetail_billDate').value=dbDate;
			}
		 		var dbDate=document.getElementById('databaseDate').value;
				var vhDate=document.getElementById('voucherHeader_voucherDate').value;
				if(compareDate(formatDateToDDMMYYYY1(vhDate),formatDateToDDMMYYYY1(dbDate)) == -1 )
				{
				alert('Voucher Date should be less than or equal to '+dbDate);
				document.getElementById('voucherHeader_voucherDate').focus();
				return false;
				}
				var sm=PageManager.DataService.getQueryField('showMode');
				if(sm=='modify')
				{
				var effDate=document.getElementById('voucherHeader_effDate').value;
				if(compareDate(formatDateToDDMMYYYY1(effDate),formatDateToDDMMYYYY1(dbDate)) == -1 ){
				alert('Voucher Date should be less than or equal to '+dbDate);
				document.getElementById('voucherHeader_effDate').focus();
				return false;
				}
				}
				deleteZeroAmtRows('gridContractorJournal','voucherDetail_debitAmount');
				deleteZeroAmtRows('gridContractorDeduction','dedAmount');
				PageManager.UpdateService.submitForm('contractorJournal');
		}
		function deleteZeroAmtRows(grid,amtField){
			var table= document.getElementById(grid);
			for(var i=1;i<table.rows.length;i++){
				if(PageManager.DataService.getControlInBranch(table.rows[i],amtField).value==0 || PageManager.DataService.getControlInBranch(table.rows[i],amtField).value=='')
					table.deleteRow(i);
			}
		}


		function validate(){
			var i, j, debit=0, credit=0, drTotal=0, crTotal=0, billAmount=0, passedAmount=0;
			var adjAmt=0;
			if(isNaN(parseFloat(document.getElementById('worksDetail_adjustmentAmount').value)))
				adjAmt=0;
			else
				adjAmt=	parseFloat(document.getElementById('worksDetail_adjustmentAmount').value);

			billAmount = eval(document.contractorJournal.contractorBillDetail_billAmount.value);
			passedAmount = eval(document.contractorJournal.contractorBillDetail_passedAmount.value);
			bilAmount = isNaN(billAmount) ? 0 : billAmount;
			passedAmount = isNaN(passedAmount) ? 0 : passedAmount;

			if(bilAmount < passedAmount){
				alert('passed amount cannot be greater than bill amount');
				return false;
			}

			/* checking for duplicate account codes */
			if(!checkForFunction_AccountCode('gridContractorJournal','cv_fromFunctionCodeId','chartOfAccounts_glCode')) return false;

			for(i=0; i<document.contractorJournal.voucherDetail_debitAmount.length; i++){

				table = document.getElementById('gridContractorJournal');
				debit = eval(document.contractorJournal.voucherDetail_debitAmount[i].value);
				//credit = eval(document.contractorJournal.voucherDetail_creditAmount[i].value);
				debit = isNaN(debit)?0:debit;
				//credit = isNaN(credit)?0:credit;
				drTotal = drTotal + debit;
				crTotal = crTotal;

				/*if((credit>0 || debit>0) &&  document.contractorJournal.chartOfAccounts_glCode[i].value.length == 0){
					document.contractorJournal.chartOfAccounts_glCode[i].focus();
					alert('account code is missing for credit/debit supplied field ' + i);
					return false;
				}*/
				/*if(debit > 0 && credit > 0){
						document.contractorJournal.voucherDetail_debitAmount[i].focus();
					alert('one account can have only credit or debit...CHECK ACCOUNT : ' + document.contractorJournal.chartOfAccounts_glCode[i].value);
					return false;
				}*/
				if(debit==0 &&  document.contractorJournal.chartOfAccounts_glCode[i].value.length != 0){
					document.contractorJournal.voucherDetail_debitAmount[i].focus();
					alert('enter debit/credit amount for the account code ' + document.contractorJournal.chartOfAccounts_glCode[i].value);
					return false;
				}
				if(isNaN(eval(document.contractorJournal.voucherDetail_debitAmount[i].value)))
					document.contractorJournal.voucherDetail_debitAmount[i].value = 0;
				/*if(isNaN(eval(document.contractorJournal.voucherDetail_creditAmount[i].value)))
					document.contractorJournal.voucherDetail_creditAmount[i].value = 0;*/
			}

			if(i == 0)
			{
				debit = eval(document.contractorJournal.voucherDetail_debitAmount.value);
				//credit = eval(document.contractorJournal.voucherDetail_creditAmount.value);
				debit = isNaN(debit)?0:debit;
				//credit = isNaN(credit)?0:credit;
				drTotal = drTotal + debit;
				//crTotal = crTotal + credit;

				if((debit>0) &&  document.contractorJournal.chartOfAccounts_glCode.value.length == 0){
					document.contractorJournal.chartOfAccounts_glCode.focus();
					alert('account code is missing for credit/debit supplied field');
					return false;
				}
				/*if(debit > 0 ){
						document.contractorJournal.voucherDetail_debitAmount.focus();
					alert('one account can have only credit or debit...CHECK ACCOUNT : ' + document.contractorJournal.chartOfAccounts_glCode.value);
					return false;
				}*/
				if(debit==0 &&  document.contractorJournal.chartOfAccounts_glCode.value.length != 0){
					document.contractorJournal.voucherDetail_debitAmount.focus();
					alert('enter debit amount for the account code ' + document.contractorJournal.chartOfAccounts_glCode.value);
					return false;
				}
				if(isNaN(eval(document.contractorJournal.voucherDetail_debitAmount.value)))
					document.contractorJournal.voucherDetail_debitAmount.value = 0;
				/*if(isNaN(eval(document.contractorJournal.voucherDetail_creditAmount.value)))
					document.contractorJournal.voucherDetail_creditAmount.value = 0;*/
			}

			if(crTotal > drTotal){
				alert('total credit cant exceed  total debit amount');
				return false;
			}
		/*	if(crTotal<=0){
				alert('no transaction with no credit/debit');
				return false;
			}
			if(crTotal != passedAmount){
				alert('passed amount and credit/debit amount must be same');
				return false;
			}*/

			if(drTotal<=0){
				alert('no transaction with no debit');
				return false;
			}
/*			if(drTotal != passedAmount+adjAmt){
				alert('passed amount and adjustment  must be same as debit amount ');
				return false;
			}
*/
			/* checking for duplicate account codes in deduction */
			if(!checkForFunction_AccountCode_dedGrid('gridContractorDeduction','cv_fromFunctionCodeId1','DedchartOfAccounts_glCode','tds_Code')) return false;
/*	dedTable = document.getElementById('gridContractorDeduction');
			for(j=1; j<dedTable.rows.length; j++)
			{
				if(document.contractorJournal.tds_Code[j].value != '' && document.contractorJournal.dedAmount[j].value == '')
				{
				alert("Amount not Know For Deduction");
				return false;
				}

			}
		*/

			return true;
		}

		function afterUpdateService()
		{

			 disableControls(0,true);
		 	if(str=="new")	window.location = "ContractorJournal.htm"
			if(str=="close") window.close()

		}

		function onClickCancel()
		{
			window.location = "ContractorJournal.htm"
		}




	  function afterRefreshPage(dc){
				//calculateTotal();
		    var cgn=PageManager.DataService.getQueryField('cgNumber');
			var sm=PageManager.DataService.getQueryField('showMode');
		/*	if("getRelationIdFromCode"==dc.values['serviceID'] )
			{

				loadWorkOrders(document.getElementById("relation_id").value);
			}
		*/	if("getWorksDetailId"==dc.values['serviceID'] )
			{
			loadWorkOrderData(document.getElementById("worksDetail_id").value);
			var wCode=document.getElementById("worksDetail_code").value;
			PageManager.DataService.setQueryField('worksDetail_code',wCode);
			PageManager.DataService.callDataService('AssetListMod');
			}

			if("getContractorDetails"==dc.values['serviceID'] &&sm=="edit" && cgn)
			{
			   var vnum=dc.values['voucherHeader_voucherNumber'];
			   var subVnum=vnum.substring(0,2);

			   document.getElementById("voucherHeader_voucherNumber").value=vnum.substring(2,vnum.length);
			   document.getElementById("vnum").value=subVnum;

			    if(document.getElementById("oldVoucherDate").value == "")
			    {
					document.getElementById("oldVoucherDate").value=formatDate2(dc.values['voucherHeader_voucherDate']);
		 		}
		 		//alert(document.getElementById("oldVoucherDate").value);
		 		var obj=document.getElementById("asset_name");
		 		// added this "if"  by iliyaraja
		 		if(dc.values['asset_id'])
		 		{
		 		obj.options[obj.selectedIndex].value=dc.values['asset_id'];
		 		}
			}

	 		//calls and loads deduction grid
	 		if(dc.values['serviceID']=='getConTDSCodes' &&  sm=="edit"  && cgn){

				PageManager.DataService.setQueryField("parttypecode",'Contractor');

		 		PageManager.DataService.setQueryField('cgNumber',dc.values['cgNumber']);
		 		if(billAmtBlur_noOfTimes=='0' || billAmtBlur_noOfTimes== 0){
					PageManager.DataService.callDataService('getContractorDeductionGrid');
					billAmtBlur_noOfTimes=billAmtBlur_noOfTimes+1;
				}

			}

			if(dc.values['databaseDate']!='' && dc.values['serviceID']=='cgNumber')
			{
			var dt=dc.values['databaseDate']
			document.getElementById('voucherHeader_voucherDate').value=dt;
			}
				if(dc.values['serviceID']=='workOrderData')
			{
			var worksDetordDate =dc.values['worksDetail_orderDate'];
				worksDetordDate=formatDateToDDMMYYYY4(worksDetordDate);
				document.getElementById('worksDetail_orderDate').value=worksDetordDate;
			}
			if(dc.values['serviceID']=='getWoDetails'){
					var cgn=PageManager.DataService.getQueryField('cgNumber');
					PageManager.DataService.setQueryField('cgNumber',cgn);
					var sm=PageManager.DataService.getQueryField('showMode');
					if(sm=="view")
					 {
					 	PageManager.DataService.callDataService('getContractorDetailsView');

					 }
					 else{

						PageManager.DataService.callDataService('getContractorDetails');
					}
				}

				if(dc.values['serviceID']=='getworktds'){

					if(dc.grids['gridContractorDeduction'].length==0)
					{

						PageManager.DataService.addNewRow('gridContractorDeduction');
						PageManager.DataService.addNewRow('gridContractorDeduction');

					}
					else(dc.grids['gridContractorDeduction'].length==1)
					{

						PageManager.DataService.addNewRow('gridContractorDeduction');
						PageManager.DataService.addNewRow('gridContractorDeduction');
					}

				}

			//if(dc.values['serviceID']=='getContractorDetailsModify'){
				if(dc.values['showMode']=='edit'){
				//alert("gridContractorDeduction length---"+dc.grids['gridContractorDeduction'].length);
					if(dc.grids['gridContractorDeduction']!=null && dc.grids['gridContractorDeduction'].length==0)
					{
						//alert("inside the length  0 ");
						PageManager.DataService.addNewRow('gridContractorDeduction');

						PageManager.DataService.addNewRow('gridContractorDeduction');

					}
					else if(dc.grids['gridContractorDeduction']!=null && dc.grids['gridContractorDeduction'].length==1)
					{
							//alert("inside the length 1");

						PageManager.DataService.addNewRow('gridContractorDeduction');
						PageManager.DataService.addNewRow('gridContractorDeduction');
					}

				}

				if(dc.values['serviceID']=='getContractorDetailsView' || dc.values['serviceID']=='getContractorDetails' || dc.values['serviceID']=='getContractorDetailsModify' ){
				var voucherStatus=dc.values['voucherHeader_status'];
				var voucherConfirmed=dc.values['voucherHeader_confirmed'];
				if(voucherConfirmed=='0')
					document.getElementById('voucherHeader_status').value="Unconfirmed";
				else if(voucherConfirmed=='1' && voucherStatus=='0')
					document.getElementById('voucherHeader_status').value="Confirmed";
				else if(voucherStatus=='1')
					document.getElementById('voucherHeader_status').value="Reversed";
				else if(voucherStatus=='2')
				document.getElementById('voucherHeader_status').value="Reversal";
				var voucherHeader_voucherDate=dc.values['voucherHeader_voucherDate'];
				if(voucherHeader_voucherDate){
				voucherDate=formatDate2(voucherHeader_voucherDate);
				document.getElementById('voucherHeader_voucherDate').value=voucherDate;
				}
				var billdate=dc.values['contBillDetail_billDate'];
				if(billdate){
								billdate=formatDate2(billdate);
								document.getElementById('contBillDetail_billDate').value=billdate;
				}


				var worksDetail_orderDate=dc.values['worksDetail_orderDate'];
				if(worksDetail_orderDate){
				worksDetail_orderDate=formatDate2(worksDetail_orderDate);
				document.getElementById('worksDetail_orderDate').value=worksDetail_orderDate;
				}
				var appBy=dc.values['contBillDetail_approvedBy'];
				if(appBy){
				document.getElementById('contractorBillDetail_approvedBy').value=appBy;
				}
				var pAmount=dc.values['contBillDetail_passedAmount'];
				if(pAmount){
				document.getElementById('contractorBillDetail_passedAmount').value=pAmount;
				}
				var bAmount=dc.values['contBillDetail_billAmount'];
				if(bAmount){
				document.getElementById('contractorBillDetail_billAmount').value=bAmount;
				}

				var poId=dc.values['worksDetail_id'];

				if(poId && sm!='view'){
				/*PageManager.DataService.setQueryField('supplierCode',dc.values['relation_id']);
				var obj=document.getElementById('worksDetail_name');
				obj.setAttribute('exilListSource','worksDetail_name');
				PageManager.DataService.callDataService('workOrderNameList');
				*/PageManager.DataService.setQueryField('worksDetail_code',dc.values['worksdetail_code']);
				PageManager.DataService.callDataService('AssetListMod');
				//obj=document.getElementById('worksDetail_name');
				//obj.selectedIndex=poId;
				//obj.options[obj.selectedIndex].value=poId;
				}

				var tab=dc.grids['gridContractorJournal'];
				if(tab){
				var count1 = 0,count2=0;
				for(var i=1;i<tab.length;i++){
				count1 += parseFloat(tab[i][4]);
				//count2 += parseFloat(tab[i][5]);
				}
				document.getElementById("debitTotal").value =count1;

				//document.getElementById("creditTotal").value = count2;
				getNetamt();
				}
			  }

			if(dc.values['serviceID']=='workOrderNameList' && (dc.values['showMode']=='edit' || dc.values['showMode']=='modify')){
				loadTDSList();
			}


			}

	    function disableControls(frmIndex, isDisable){
			for(var i=0;i<document.forms[frmIndex].length;i++)
			{
				document.forms[frmIndex].elements[i].disabled =isDisable;
				if(PageManager.DataService.getQueryField('showMode')=='view' &&
					document.forms[frmIndex].elements[i].parentNode.parentNode.getAttribute('id')=='backbutton')
					document.forms[frmIndex].elements[i].disabled =false;
				if(PageManager.DataService.getQueryField('showMode')=='modify'
						&& (document.forms[frmIndex].elements[i].parentNode.parentNode.getAttribute('id')=='modGrid' ||
						 document.forms[frmIndex].elements[i].parentNode.parentNode.getAttribute('id')=='reverseSubmit' ))
					document.forms[frmIndex].elements[i].disabled =false;
			}

		}
		function modify(){
				var cgn=PageManager.DataService.getQueryField('cgNumber');
		 		if(cgn){
		 			/*vGrid=document.getElementById('gridContractorJournal').cloneNode(true);
		 			new_vGrid=document.body.appendChild(vGrid);
		 			new_vGrid.name= 'voucherDetailGridNew';
		 			new_vGrid.disabled=false;

		 			tGrid=document.getElementById('buttonTable').cloneNode(true);
		 			new_tGrid=document.body.appendChild(tGrid);
		 			new_tGrid.name= 'voucherDetailGridNew';
		 			new_tGrid.disabled=true;

		 			disableControls(0,false);
		 			document.getElementById('modGrid').style.display='none';
		 			document.getElementById('submitGrid').style.display='block';*/
		 			//document.getElementById ('text1').style.display ='block';
		 			document.getElementById('reverseRecord').style.display='block';
		 			var vcObj=document.getElementById('voucherHeader_newVcNo');
		 			vcObj.setAttribute('exilMustEnter','true');
		 			vcObj.disabled=false;
		 			var vdObj=document.getElementById('voucherHeader_effDate')
		 			vdObj.setAttribute('exilMustEnter','true');
		 			vdObj.disabled=false;
		 			document.getElementById('modeOfExec').value="modify";
		 			document.getElementById('reverseSubmit').style.display ="block";
		 	 	}
		}
		function hideButtons(){
			document.getElementById('modGrid').style.display='block';
			document.getElementById('submitGrid').style.display ="none";
			//document.getElementById ('text1').style.display ="none";
		}
		function loadFund(){


			var woId=document.getElementById("worksdetail_id").value;
			if(woId.length==null)return;
			PageManager.DataService.setQueryField('workOrderID',woId);
			PageManager.DataService.callDataService('workFundMap');

		}
		function loadFundSource(workId){

			if(workId.length==0)return;

			PageManager.DataService.setQueryField('workOrderID',workId);
			PageManager.DataService.callDataService('workFundSourceMap');

		}
		function showglEntry()
		{
			if(!isValidAmount())
				return false;
			hideColumn(0);
			if(!PageValidator.validateForm())
				return false;
			var gltable= document.getElementById("gridContractorJournal");
			code=PageManager.DataService.getControlInBranch(gltable.rows[1],'chartOfAccounts_glCode').value;
			if(code)
			{
			PageManager.DataService.setQueryField("showGlEntries","show");
			PageManager.DataService.callDataService('contractorJournal');
			}
			else
			{
				alert("Enter Account code Details");
				return false;
			}
		}
		function showEntry()
		{
			var trObj;
			var tObj=document.getElementById("showEntries");
			var cr=0,dr=0,dedAmount=0;
			tObj.style.display="block";
			var tableObj=document.getElementById("entries");
			var gltable= document.getElementById("gridContractorJournal");
			for(var i=tableObj.rows.length-1;i>=2;i--)
			{
				tableObj.deleteRow(i);
			}
			for(var i=1;i<gltable.rows.length;i++)
			{

				code=PageManager.DataService.getControlInBranch(gltable.rows[i],'chartOfAccounts_glCode').value;
				if(code)
				{
				name=PageManager.DataService.getControlInBranch(gltable.rows[i],'chartOfAccounts_name').value;
				debit=PageManager.DataService.getControlInBranch(gltable.rows[i],'voucherDetail_debitAmount').value;
				if(isNaN(parseFloat(debit,10)))
				dr=dr+0;
				else
				dr=dr+parseFloat(debit,10);
				narration=PageManager.DataService.getControlInBranch(gltable.rows[i],'voucherDetail_narration').value;
				var Obj=PageManager.DataService.getControlInBranch(tableObj.rows[1],"display_Code");
				trObj=PageManager.DataService.getRow(Obj);
				 if(i==1){
								newRow=trObj;
								objt1=PageManager.DataService.getControlInBranch(newRow,'display_Code');
				 				objt2=PageManager.DataService.getControlInBranch(newRow,'display_Head');
				 				objt3=PageManager.DataService.getControlInBranch(newRow,'display_Debit');
				 				objt4=PageManager.DataService.getControlInBranch(newRow,'display_Credit');
				 				objt5=PageManager.DataService.getControlInBranch(newRow,'display_Narration');
				 				if(code=="") code=" -"; if(name=="") name=" -"; if(debit=="") debit=" 0";  if(narration=="") narration=" -";
				 				objt1.innerHTML=code;
				 				objt2.innerHTML=name;
				 				objt3.innerHTML=debit;
				 				objt4.innerHTML=0;
								objt5.innerHTML=narration
				 }else{

						 var newRow=trObj.cloneNode(true);
						newRow=tableObj.tBodies[0].appendChild(newRow);
						objt1=PageManager.DataService.getControlInBranch(newRow,'display_Code');
						objt2=PageManager.DataService.getControlInBranch(newRow,'display_Head');
						objt3=PageManager.DataService.getControlInBranch(newRow,'display_Debit');
						objt4=PageManager.DataService.getControlInBranch(newRow,'display_Credit');
						objt5=PageManager.DataService.getControlInBranch(newRow,'display_Narration');
						if(code=="") code=" -"; if(name=="") name=" -"; if(debit=="") debit=" 0"; if(narration=="") narration=" -";
						objt1.innerHTML=code;
						objt2.innerHTML=name;
						objt3.innerHTML=debit;
						//objt4.innerHTML=credit;
						objt5.innerHTML=narration;
				}
			  }
			}

			var dedTable= document.getElementById("gridContractorDeduction");
			for(var i=1;i<dedTable.rows.length;i++)
			{
				var code=PageManager.DataService.getControlInBranch(dedTable.rows[i],'gl_Code').value;
				if(code)
				{

				var name=PageManager.DataService.getControlInBranch(dedTable.rows[i],'coa_name').value;
				var amount=PageManager.DataService.getControlInBranch(dedTable.rows[i],'dedAmount').value;
				dedAmount=dedAmount+parseFloat(amount,10);
				var newRow=trObj.cloneNode(true);
				newRow=tableObj.tBodies[0].appendChild(newRow);
				objt1=PageManager.DataService.getControlInBranch(newRow,'display_Code');
				objt2=PageManager.DataService.getControlInBranch(newRow,'display_Head');
				objt3=PageManager.DataService.getControlInBranch(newRow,'display_Debit');
				objt4=PageManager.DataService.getControlInBranch(newRow,'display_Credit');
				objt5=PageManager.DataService.getControlInBranch(newRow,'display_Narration');
				if(code=="") code=" -"; if(name=="") name=" -";
				objt1.innerHTML=code;
				objt2.innerHTML=name;
				objt3.innerHTML="0";
				objt4.innerHTML=amount;
				objt5.innerHTML=" -";

				}
			}


			var iRow=glNameCode.split(";");
			var rowContents=null;tempObj=null;
			for(var i=1;i<(iRow.length)-1;i++)
			{
				rowContents=iRow[i].split("^");
				var newRow=trObj.cloneNode(true);
				newRow=tableObj.tBodies[0].appendChild(newRow);
				tempObj1=PageManager.DataService.getControlInBranch(newRow,'display_CodeType');
				tempObj1.innerHTML=rowContents[0];
				tempObj2=PageManager.DataService.getControlInBranch(newRow,'display_Code');
				tempObj2.innerHTML=rowContents[1];
				tempObj3=PageManager.DataService.getControlInBranch(newRow,'display_Head');
				tempObj3.innerHTML=rowContents[2];
				tempObj5=PageManager.DataService.getControlInBranch(newRow,'display_Narration');
				tempObj5.innerHTML=" -";

			}
			if(isNaN(parseFloat(document.getElementById('contractorBillDetail_passedAmount').value)))
			passedAmount=0;
			else
			passedAmount=parseFloat(document.getElementById('contractorBillDetail_passedAmount').value);

			if(isNaN(parseFloat(document.getElementById('worksDetail_adjustmentAmount').value)))
			adjAmt=0;
			else
			adjAmt=	parseFloat(document.getElementById('worksDetail_adjustmentAmount').value);
			//totalamount=document.getElementById("worksDetail_NetAmount").value;
			//totalamount=(passedAmount-cr)-dedAmount-adjAmt;
			totalamount=(passedAmount-cr)-dedAmount;


			for(var i=1;i<tableObj.rows.length;i++)
			{
				var typeObj=PageManager.DataService.getControlInBranch(tableObj.rows[i],"display_CodeType");
				var type=typeObj.innerHTML;
				if(type =='ConAdvCode')
				{
					var trObj=PageManager.DataService.getRow(typeObj);
					col1=PageManager.DataService.getControlInBranch(trObj,'display_Credit');
					col1.innerHTML=Math.round(adjAmt*100)/100;
					col2=PageManager.DataService.getControlInBranch(trObj,'display_Debit');
					col2.innerHTML="0";
					totalamount=(passedAmount-cr)-dedAmount-adjAmt;
					if(adjAmt*1==0)
						tableObj.rows[i].style.display='none';
				}

			}
			for(var i=1;i<tableObj.rows.length;i++)
			{
				var typeObj=PageManager.DataService.getControlInBranch(tableObj.rows[i],"display_CodeType");
				var type=typeObj.innerHTML;
				if(type =='ConPayCode')
				{
					var trObj=PageManager.DataService.getRow(typeObj);
					col1=PageManager.DataService.getControlInBranch(trObj,'display_Credit');
					col1.innerHTML=Math.round(totalamount*100)/100;
					col2=PageManager.DataService.getControlInBranch(trObj,'display_Debit');
					col2.innerHTML="0";
				}
			}

			 var dSum=0;
			 var cSum=0;
			for(var i=1;i<tableObj.rows.length;i++)
			{

			  var dObj=PageManager.DataService.getControlInBranch(tableObj.rows[i],"display_Debit");
			  var cObj=PageManager.DataService.getControlInBranch(tableObj.rows[i],"display_Credit");
			 if(!isNaN(parseFloat(dObj.innerHTML)))
			 {
			   var sum=(parseFloat(dObj.innerHTML));
			   dSum=dSum+sum;
			 }
			 if(!isNaN(parseFloat(cObj.innerHTML)))
			 {
			   var sum=(parseFloat(cObj.innerHTML));
			   cSum=cSum+sum;
			 }
			}
			dSum=Math.round(dSum*100)/100;
			cSum=Math.round(cSum*100)/100;
			var newRow=trObj.cloneNode(true);
			newRow=tableObj.tBodies[0].appendChild(newRow);
			objt1=PageManager.DataService.getControlInBranch(newRow,'display_Code');
			objt2=PageManager.DataService.getControlInBranch(newRow,'display_Head');
			objt3=PageManager.DataService.getControlInBranch(newRow,'display_Debit');
			objt4=PageManager.DataService.getControlInBranch(newRow,'display_Credit');
			objt5=PageManager.DataService.getControlInBranch(newRow,'display_Narration');
			objt1.innerHTML=" ";
			objt2.innerHTML=" ";
			objt3.innerHTML=dSum;
			objt4.innerHTML=cSum;
			objt5.innerHTML=" ";

	}

	function hideColumn(index)
	{
		var table=document.getElementById('entries');
	   	for(var i=0;i<table.rows.length;i++){
			table.rows[i].cells[index].style.display="none";
	   	}
	}
	function hideDedColumn(index)
		{
			var table=document.getElementById('gridContractorDeduction');
		   	for(var i=0;i<table.rows.length;i++){
				table.rows[i].cells[index].style.display="none";
		   	}
	}
	function getTds(obj,evnt)
		{
				var a = new Array();
				var x = PageManager.DataService.getControlInBranch(obj.parentNode,'tds_Code');
				var sRtn=x.value;
				//var str = "condec";
				//sRtn= showModalDialog("Search.html?screenName="+str,"","dialogLeft=300;dialogTop=210;dialogWidth=305pt;dialogHeight=300pt;status=no;");
				var y = PageManager.DataService.getControlInBranch(obj.parentNode.parentNode,'coa_name');
				var z = PageManager.DataService.getControlInBranch(obj.parentNode.parentNode,'gl_Code');
				var m = PageManager.DataService.getControlInBranch(obj.parentNode.parentNode,'glcodeId');
				var n = PageManager.DataService.getControlInBranch(obj.parentNode.parentNode,'tdsId');
				var p = PageManager.DataService.getControlInBranch(obj.parentNode.parentNode,'DedchartOfAccounts_glCode');
				if(sRtn != '')
				{
					a = sRtn.split("`~`");
					//x.value = a[0];
					y.value = a[1];
					z.value = a[2];
					m.value = a[3];
					n.value = a[4];
					p.value="";
					//alert('glid:'+m.value+' tdsid:'+n.value  );
					x.focus();
				}
				else
				{
					y.value = "";
					z.value = "";
					m.value = "";
					n.value = "";
					x.focus();


				}
				getRate(obj,evnt,a[0]);
		}
	function getRate(obj,evnt,tdsCode)
	{
		PageManager.DescService.onblur(evnt);
		dedGridObj=obj;
		//alert("tdsCode"+tdsCode)

	    if(obj.value==null || obj.value=="")
	    {	PageManager.DataService.getControlInBranch(obj.parentNode.parentNode,'dedAmount').value="";
	    	return;
	    }

	    PageManager.DataService.setQueryField('contractorDedCode',tdsCode);
		PageManager.DataService.callDataService('getDedAmount');
}

function getpamt(obj,evnt)
{
	if(obj.value==null || obj.value=="")return;
	var osAmt=document.getElementById("worksDetail_outstandingAmount").value;
	osAmt=isNaN(osAmt)?0:osAmt;
	osAmt=new Number(osAmt);
	var billAmt=document.getElementById("contractorBillDetail_billAmount").value;
	billAmt=isNaN(billAmt)?0:billAmt;
	billAmt=new Number(billAmt);
	if(billAmt>osAmt)
	{
	   alert("Bill Amount Cannot be greater than Outstanding Amount..");
	   document.getElementById("contractorBillDetail_billAmount").value=0;
	   return false;
	}

	var pasedAmt=document.getElementById('contractorBillDetail_passedAmount').value;
	if(pasedAmt==null || pasedAmt=="")
		document.getElementById('contractorBillDetail_passedAmount').value=obj.value;
	chkAmount();
}

//Added By Lakshmi
function fillRate(obj,evnt)
{
	PageManager.DescService.onblur(evnt);
    dedGridObj=document.getElementById('tds_Code');

//	dedGridObj=obj;
	table= document.getElementById("gridContractorDeduction");
	for(var i=1;i<table.rows.length;i++)
    {
		var dedCode=PageManager.DataService.getControlInBranch(table.rows[i],'tds_Code');

	    if(dedCode.value!=null && dedCode.value.length>0 )
	    {
	    	//alert("service id:"+dedGridObj);
	    	PageManager.DataService.setQueryField('contractorDedCode',dedGridObj.value);
		  	PageManager.DataService.callDataService('getDedAmount');
		  	//dedGridObj=dedCode;
		}
	}
}
function chkAmount()
{
	var adjstAmt=document.getElementById("worksDetail_adjustmentAmount").value;
	if(adjstAmt==null || adjstAmt=="") document.getElementById("worksDetail_adjustmentAmount").value=new Number(0);
	else if(isNaN(adjstAmt))
	{
	   alert("Enter Only Numbers!!!...");
	   document.getElementById("worksDetail_adjustmentAmount").selected();
	   return false;
	}
	var advAmt=document.getElementById("worksDetail_advanceAmount").value;
	advAmt=isNaN(advAmt)?0:advAmt;
	adjstAmt=new Number(adjstAmt);
	advAmt=isNaN(advAmt)?0:advAmt;
	advAmt=new Number(advAmt);
	if(adjstAmt>advAmt)
	{
	   alert("Adjustment Amount Cannot be greater than Advance Amount");
	   document.getElementById("worksDetail_adjustmentAmount").focus();
	   return false;
	}
	var passedAmt=document.getElementById("contractorBillDetail_passedAmount").value;
	passedAmt=isNaN(passedAmt)?0:passedAmt;
	passedAmt=new Number(passedAmt);
	var billAmt=document.getElementById("contractorBillDetail_billAmount").value;
	billAmt=isNaN(billAmt)?0:billAmt;
	billAmt=new Number(billAmt);

	if(billAmt<passedAmt)
	{
	   alert("Passed Amount Cannot be greater than Bill Amount..");
	  // document.getElementById("contractorBillDetail_passedAmount").focus();
	   return false;

	}
	getNetamt();
}
function getNetamt()
{
//alert("Inside getNetamt");
	passedAmt=parseFloat(document.getElementById('contractorBillDetail_passedAmount').value);
	passedAmt=isNaN(passedAmt)?0:passedAmt;
	adjustAmt=parseFloat(document.getElementById("worksDetail_adjustmentAmount").value);
	adjustAmt=isNaN(adjustAmt)?0:adjustAmt;
	var table= document.getElementById("gridContractorDeduction");

//	alert(table.length);
	var debit=0;
	for(var i=1;i<table.rows.length;i++)
	{//alert("inside loop :"+PageManager.DataService.getControlInBranch(table.rows[i],"dedAmount").value);
		var amt=parseFloat(PageManager.DataService.getControlInBranch(table.rows[i],"dedAmount").value);
		//alert("Amt:"+amt);
		amt=isNaN(amt)?0:amt;
		debit=debit+amt;
	//	alert("Debit:"+debit);
	}
	document.getElementById("deductTotal").value=Math.round(debit*100)/100;
//alert("Tot ded:"+Math.round(debit*100)/100);
	//var credit=document.getElementById("creditTotal").value;
	//credit=isNaN(parseFloat(credit))?0:parseFloat(credit);
	netAmt=passedAmt-debit;//alert(netAmt+" "+passedAmt+" "+credit+" "+debit);
	if(netAmt<0)
	{//alert('coming..');
	   alert("Deductions Cannot be more than Passed Amount");
	  // document.getElementById("contractorBillDetail_passedAmount").focus();
	   //return false;

	}
	else if(adjustAmt>0 && netAmt<adjustAmt)
	{
	  alert("Cannot Adjust Amount: "+adjustAmt);
	}
	document.getElementById("worksDetail_NetAmount").value=Math.round((netAmt-adjustAmt)*100)/100;
}

/*
	We implement AJAX here. The remaining functions are present in script/jsCommonMethods.js.
	Whenever user enters some value this function will be triggered.
*/

//(NORMAL FUNCTION CODE)


function setWorkCode()
{
	//var obj=document.getElementById("worksDetail_name");
	document.getElementById("fundsource_name").value="";
	document.getElementById("fundsource_id").value="";
	document.getElementById("fund_name").value="";
	document.getElementById("fund_id").value="";
	document.getElementById("worksDetail_adjustmentAmount").value="";
	loadWorkOrderData(document.getElementById("worksDetail_id").value);
	var wCode=document.getElementById("worksDetail_code").value;
	PageManager.DataService.setQueryField('worksDetail_code',wCode);
	PageManager.DataService.callDataService('AssetListMod');
}


function loadFunctionCodes()
{

	var gltable= document.getElementById("gridContractorJournal");
	var conDedtable= document.getElementById("gridContractorDeduction");
	var temp;
	var option;

	for(var j=1;j<conDedtable.rows.length;j++)
	{
		fcode1=PageManager.DataService.getControlInBranch(conDedtable.rows[j],'function_code1');
		for(var i=fcode1.options.length-1;i>=0;i--)
		{
			fcode1.remove(i);
		}

	}

	for(var j=1;j<conDedtable.rows.length;j++){
		fcode=PageManager.DataService.getControlInBranch(conDedtable.rows[j],'function_code1');
		option = document.createElement('OPTION');
		option.text="";
		option.value="";
		fcode.add(option);
				for(var i=1;i<gltable.rows.length;i++){
				PageManager.DataService.getControlInBranch(gltable.rows[i],'function_code').value;
				option = document.createElement('OPTION');
				option.value=PageManager.DataService.getControlInBranch(gltable.rows[i],'cv_fromFunctionCodeId').value;
				option.text = PageManager.DataService.getControlInBranch(gltable.rows[i],'function_code').value;
				fcode.add(option);
				}
	}
}

function setfunctionCode(obj)
{
	var w =PageManager.DataService.getControlInBranch(obj.parentNode,'function_code1');
	var x =PageManager.DataService.getControlInBranch(obj.parentNode,'cv_fromFunctionCodeId1');
	x.value=obj.options[obj.selectedIndex].value;

}
function getRelationId()
{
document.getElementById('contractor_id').value=document.getElementById('relation_id').value;
wIndex=null;wValue=null;wText=null;
splitConCode();
code=document.getElementById('contractor_code').value;
document.getElementById('relation_id').value="";
if (code=='') return;
PageManager.DataService.setQueryField('relation_code',code);
PageManager.DataService.callDataService('getRelationIdFromCode');

}

 function autoCompletionWorkList(obj) {
//alert("hi");
	var menu=document.getElementById("menu-popup");
		menu.style.setAttribute("left", "520px");
	if(codeArray != null)
	{
		//keyCodes Values
		//13 - enter, 8 - backspace, 46 - delete, 40 - down arrow, 38 - up arrow
		if(event.keyCode == 13)	{
		 var arr=document.getElementById('worksDetail_name').value.split("`-`");
		 if(arr[1]==null){ alert("Enter valid Workorder"); return }
		 else {
		 	document.getElementById('worksDetail_name').value=arr[0];
		 	document.getElementById('worksDetail_code').value=arr[1];
		 	getAccName(event);
			 return false;
   			}
   		}
   		if((event.keyCode == 8) || (event.keyCode == 46))
			j=-1;
   		while(event.keyCode == 40 && codeArray[0] != null)	{
   			j++;
   			//PageManager.DataService.getControlInBranch(currRow,'DedchartOfAccounts_glCode').value=codeArray[j];
   			document.getElementById('worksDetail_name').value=codeArray[j];
  			return false;
   			}
  		while(event.keyCode == 38 && codeArray[0] != null)	{
   			j--;
    	 	document.getElementById('worksDetail_name').value=codeArray[j];
    	 	return false;
  			}
   }

     conName=document.getElementById('worksDetail_name').value;
      var type='workDetailName';
      var relationTypeId='2';
      var relationId=document.getElementById('relation_id').value;
      if (conName == "") {
           clearTable(completeTable);
       } else {
            var url = "../commons/Process.jsp?type=" +type+"&name=" + conName+"&relationTypeId=" +relationTypeId+"&relationId="+relationId ;
          	var req = initiateRequest();
           req.onreadystatechange = function() {
               if (req.readyState == 4) {
                   if (req.status == 200) {
                   	var codes=req.responseText;

                       paintCodes(codes,document.getElementById("auto-row3"),document.getElementById("menu-popup"),document.getElementById("completeTable"));
                     } else {
                       clearTable(completeTable);
                   }
               }
           };
                req.open("GET", url, true);
                req.send(null);
       }
   }

function getWorksDetailId()
{
splitWorkCode();
code=document.getElementById('worksDetail_code').value;
document.getElementById('worksDetail_id').value="";
if(code=='') return;
PageManager.DataService.setQueryField('worksDetail_code',code);
PageManager.DataService.callDataService('getWorksDetailId');


}
function splitConCode()
{
//alert("hi");
 var arr=document.getElementById('contractor_name').value.split("`-`");
							if(arr[1]==null){  return  }
							else{
								document.getElementById('contractor_name').value=arr[0];
								document.getElementById('contractor_code').value=arr[1];
								getAccName(event);
								 return false;
								}
}

function splitCoaName(obj,targetObj)
{
		if(obj.value=="" && obj.getAttribute("id")=='DedchartOfAccounts_glCode'){ return;	}
		var coaName = PageManager.DataService.getControlInBranch(obj.parentNode.parentNode,targetObj);
		 	var arr=obj.value.split("`-`");
		 	obj.value=arr[0];

			PageManager.DescService.onblur(targetObj);
			var currRow=PageManager.DataService.getRow(obj);
			yuiflag[currRow.rowIndex] = undefined;

			if(arr[1]==null){ if(obj.value=='') coaName.value="";  return  }
			else{
				obj.value=arr[0];
				coaName.value=arr[1];}
}

function splitWorkCode()
{
//alert("hi");
 var arr=document.getElementById('worksDetail_name').value.split("`-`");
							if(arr[1]==null){  return  }
							else{
								document.getElementById('worksDetail_name').value=arr[0].substring(1, arr[0].length);
								document.getElementById('worksDetail_code').value=arr[1];
								getAccName(event);
								 return false;
								}
}
function clearRow()
{
		var tableObj=document.getElementById('gridContractorDeduction');
		var tempObj=null;
		var rowIdx=tableObj.rows.length-1;
		if(tableObj.rows.length>1){
			tempObj=PageManager.DataService.getControlInBranch(tableObj.rows[rowIdx],"function_code1");
			tempObj.selectedIndex=-1;
			tempObj=PageManager.DataService.getControlInBranch(tableObj.rows[rowIdx],"tdsId");
			tempObj.value="";
			tempObj=PageManager.DataService.getControlInBranch(tableObj.rows[rowIdx],"gl_Code");
			tempObj.value="";
			tempObj=PageManager.DataService.getControlInBranch(tableObj.rows[rowIdx],"tds_Code");
			tempObj.value="";
			tempObj=PageManager.DataService.getControlInBranch(tableObj.rows[rowIdx],"DedchartOfAccounts_glCode");
			tempObj.value="";
			tempObj=PageManager.DataService.getControlInBranch(tableObj.rows[rowIdx],"coa_name");
			tempObj.value="";
			tempObj=PageManager.DataService.getControlInBranch(tableObj.rows[rowIdx],"dedAmount");
			tempObj.value="";
		}
}

function clearGrid(objName)
{
		var tableObj=document.getElementById(objName);
		var tempObj=null;
		for(var i=1;i<tableObj.rows.length;i++){
			tempObj=PageManager.DataService.getControlInBranch(tableObj.rows[i],"function_code1");
			tempObj.selectedIndex=-1;
			tempObj=PageManager.DataService.getControlInBranch(tableObj.rows[i],"tdsId");
			tempObj.value="";
			tempObj=PageManager.DataService.getControlInBranch(tableObj.rows[i],"tds_Code");
			tempObj.value="";
			tempObj=PageManager.DataService.getControlInBranch(tableObj.rows[i],"DedchartOfAccounts_glCode");
			tempObj.value="";
			tempObj=PageManager.DataService.getControlInBranch(tableObj.rows[i],"coa_name");
			tempObj.value="";
			tempObj=PageManager.DataService.getControlInBranch(tableObj.rows[i],"dedAmount");
			tempObj.value="";
		}
}
function addClearedRow(){
	var e = window.event;
	if(e.keyCode == 113 ){
		setAttribute_rowsToClone('gridContractorDeduction');
		addNewRowFromButton('gridContractorDeduction','DedchartOfAccounts_glCode','coa_name');
		clearRow();
		return true;
	}
	return false;

}
function loadWorkCatNsubCat(){
	PageManager.DataService.setQueryField('woId',document.getElementById('worksDetail_id').value);
	PageManager.DataService.callDataService('getWorkCategorySubCategory');
}
function loadTDSList(){
	var ptype=document.getElementById('subtypeid').value;
	var dtype=document.getElementById('doctypeid').value;
	var dstype=document.getElementById('subdoctypeid').value;
	var amt=document.getElementById("contractorBillDetail_passedAmount").value;
	if (amt==''){alert("passed amt is empty:"); return;}
	PageManager.DataService.setQueryField("sub_partytype_id",ptype);
	if(dtype!='')
	PageManager.DataService.setQueryField("doc_type_id",dtype);
	if(dstype!='')
	PageManager.DataService.setQueryField("doc_subtype_id",dstype);
	PageManager.DataService.setQueryField("amount",amt);
	PageManager.DataService.callDataService('getConTDSCodes');
}

function setAttribute_rowsToClone(objName){
	var table=document.getElementById(objName);
	 table.setAttribute("rowsToClone",null)
}
function loadDedGlcode(obj){
		var currRow=PageManager.DataService.getRow(obj);
		if(PageManager.DataService.getControlInBranch(currRow,'tds_Code').selectedIndex<=0){
			if(obj.value!=""){
				PageManager.DataService.getControlInBranch(currRow,'gl_Code').value=obj.value;
				PageManager.DataService.getControlInBranch(currRow,'tdsId').value="";
			}else return;
		}else if(obj.value!=""){
			PageManager.DataService.getControlInBranch(currRow,'tds_Code').selectedIndex=-1;
			PageManager.DataService.getControlInBranch(currRow,'gl_Code').value=obj.value;
			PageManager.DataService.getControlInBranch(currRow,'tdsId').value="";
		}
}
        </script>
	</head>
	<body onLoad="onBodyLoad()" onKeyDown ="CloseWindow(event); "  bgcolor="#ffffff" bottommargin="0" topmargin="0" rightmargin="0" leftmargin="0"
		 marginheight="0" marginwidth="0" ><!------------------ Header Begins Begins--------------------->
	 <!-- table><tr><td><span id="main"><span id="m2"><span id="m3" -->
		<form name="contractorJournal">
		<input type="hidden" name="egUser_id" id="egUser_id">
		<!--<input type="" id="worksDetail_totalValue" name="worksDetail_totalValue" value="wdtotal">-->
		<!--<input type="" id="worksDetail_totalPassedAmount" name="worksDetail_totalPassedAmount" value="wdpasss">-->
		<input type="hidden" name="budgetCheckRequired" id="budgetCheckRequired" value="true">
		<input type="hidden" name="relation_id" id="relation_id" onchange="javascript:document.getElementById('contractor_id').value=this.value">
		<input type="hidden" name="worksDetail_type" id="worksDetail_type">
		<input type="hidden" name="modeOfExec" id="modeOfExec" value="new">
		<input type="hidden" name="tType" id="tType" value="J">
		<input type="hidden" name="cgnNum" id="cgnNum">
		<input type="hidden" name="dedRate" id="dedRate">
		<input type="hidden" name="voucherHeader_id" id="voucherHeader_id">
		<input type="hidden" name="databaseDate" id="databaseDate">
		<input type="hidden" name="oldVoucherDate" id="oldVoucherDate">
		<!-- ADDED FOR DEDUCTION MODULE WITH REMITTANCE -->
		<input type="hidden" name="partytypeid" id="partytypeid">
		<input type="hidden" name="subtypeid" id="subtypeid">
		<input type="hidden" name="doctypeid" id="doctypeid">
		<input type="hidden" name="subdoctypeid" id="subdoctypeid">
		<input type="hidden" name="contractor_id" id="contractor_id" >

						<table width="100%"><tr><td>
						<table><tr><td>
						<table width="100%" border="0" cellpadding="3" cellspacing="0" id="TABLEM">
								<tr >
									<td align="right" id="cgnLabel" name="cgnLabel" style="DISPLAY: none"  ><span align="right" valign="center" class="labelcell"> CG&nbsp;Number</span></td>
									<td id="cgnText" name="cgnText" style="DISPLAY: none"  >
                                    <span  class=fieldcell><input name="voucherHeader_cgn" class="fieldinput" id="voucherHeader_cgn" readOnly exilMustEnter="true" ></span></td>
									<td align="right"><span align="right" valign="center" class="labelcell">Voucher Number<span class="leadon">*</span></span></td>
									<td><table cellpadding="0" cellspacing="0"><tr class=fieldcell>
											<td><input  type=text readonly style="WIDTH:25px; HEIGHT: 22px" maxlength="2" name="vnum" id="vnum" style="Display:none"></td>
											<td><input name="voucherHeader_voucherNumber" id="voucherHeader_voucherNumber"  maxlength="10" exilDataType="exilAlphaNumeric" exilMustEnter="true" size="20"  style="width:120px"></tr></table>
									</td>
								</tr>

				<tr >
					<td  align="right"><span align="right" valign="center" class="labelcell"> Contractor<span class="leadon">*</span></span></td>
					<td >
                   <!-- <select name="contractor_name" class="combowidth2 id="contractor_name" maxlength="50" onChange="displayCode()"  exilMustEnter="true"  ></select>-->
					<span  class=fieldcell><input class="fieldinput-left" id="contractor_name" name="contractor_name"  autocomplete="off"  onkeyup="autocompleteConList(this);" maxlength="20" style="WIDTH: 300; HEIGHT: 22" size="19"   onBlur="getRelationId()" ></span>
					<IMG id=IMG2  onclick="openSearch(this, 'relation','')" height=22 src="/egi/resources/erp2/images/plus1.gif" width=25 align=top border=0 >
					<span class=smallfieldcell>
					<input  name="contractor_code" id="contractor_code" class="accfieldinput"   readOnly  tabindex=-1></span>
                    </td>

					<td align="right"><span align="right" valign="center" class="labelcell">Voucher Date<span class="leadon">*</span></span></td>
					<td>
                    <span  class=smallfieldcell><input name="voucherHeader_voucherDate" class="datefieldinput" id="voucherHeader_voucherDate"  maxlength="11" onkeyup="DateFormat(this,this.value,event,false,'3')" exilMustEnter="true"  exilDataType="exilAnyDate"  exilCalendar="true" >&nbsp;</span></td>
				</tr>
				<tr >
					<td  align=right valign=center><span align="right" valign="center" class="labelcell">Work Order<span class="leadon">*</span></span>
					</td>
					<td>
						<table border=0>
							<tr>
								<td rowspan=2><span  class=fieldcell><TEXTAREA class=narrationfieldinput
									id=worksDetail_name name=worksDetail_name rows=1 cols=20 maxlength=250
									exilDataType="exilAnyChar" readonly exilMustEnter="true" tabindex=-1></TEXTAREA></span></td>
								<td><IMG id=IMG1  onclick="openSearch2(this, 'WorksDetail')" height=22  src="/egi/resources/erp2/images/plus1.gif" width=25 align=top border=0 tabindex=0>
								<div  class=fieldcell><input  name="worksDetail_code" id="worksDetail_code" tabindex=-1   readOnly size="18" ></input></div>
								<input type='hidden'  name="worksDetail_id" id="worksDetail_id"  ></input>
								</td>
							</tr>
						</table>
					</td>
					<td  align="right"><span align="right" valign="center" class="labelcell">Work Order Date<span class="leadon">*</span></span>
					</td>
					<td>
                       <span  class=smallfieldcell><input name="worksDetail_orderDate" class="datefieldinput" id="worksDetail_orderDate" tabindex=-1  maxlength="11" readOnly exilMustEnter="true" ></span>

					</td>

				</tr>
				<tr >
						<td align="right"><span align="right" valign="center" class="labelcell">Total Value of Work Order</span></td>
						<td nowrap><span  class=fieldcell><input id="worksDetail_totalValue" name="worksDetail_totalValue" tabindex=-1 class="fieldinput-right" readOnly></span>
						<span valign="center" style="font:  11px Verdana, Geneva, Arial, Helvetica, sans-serif;background-color: transparent;color: #3670A7;width=50px">Billed Amount</span>
						<span  class=fieldcell2>
						<input name="worksDetail_totalPassedAmount"  id="worksDetail_totalPassedAmount" tabindex=-1 exilDataType="exilUnsignedDecimal"  readOnly style="width:100px;height:20px;text-align:right"></span></td>
						<td align="right"><span align="right" valign="center" class="labelcell">Outstanding Amount</span></td>
						<td ><span  class=fieldcell><input id="worksDetail_outstandingAmount" name="worksDetail_outstandingAmount" tabindex=-1 class="fieldinput-right" readOnly></span>
					</tr>

				<tr >
					<td   align="right"><span align="right" valign="center" class="labelcell">
						Asset</span></td>
					<td>
                    <span class="smallfieldcell"><select name="asset_name" class="combowidth2" id="asset_name" maxlength="50" exilListSource="selected_Asset" ></select></span>
					</td>
					<!--		<td ><span align="right" valign="center" class="labelcell">Fund Source<span class=leadon>*</span></span>
					</td>
					<td>
                    <SELECT id="fundSource_id" name="fundSource_id" exilMustEnter="true"
                    class="fieldinput" exilListSource="fundSourceCombo"></SELECT>&nbsp;
						</td>   -->
					<td align="right" valign="center" class="labelcell"  ><span align="right" class="labelcell">
						*Advance Outstanding</span>
					</td>
					<td ><span  class=fieldcell><INPUT class=fieldinput-right id="worksDetail_advanceAmount" name="worksDetail_advanceAmount" tabindex=-1 exilDataType="exilUnsignedDecimal" readOnly></span>
					</td>
					<td   >
					</td>
					<td  >
					</td>


				</tr>

				<tr >
					<td   align="right"><span align="right" valign="center" class="labelcell">Fund</span></td>

					<td ><span  class=fieldcell><input type="hidden" id="fund_id" name="fund_id"  class="fieldinput"><input id="fund_name" name="fund_name" tabindex="-1" class="fieldinput" readOnly></span>
					</td>



						<td   align="right"><span align="right" valign="center" class="labelcell">
						Bill Amount<span class="leadon">*</span> </span>
					</td>
					<td>
						<span  class=fieldcell><input name="contractorBillDetail_billAmount" class="fieldinput-right" id="contractorBillDetail_billAmount"  maxlength="16" onBlur="getpamt(this,event);loadTDSList();clearGrid('gridContractorDeduction');" exilMustEnter="true" exilDataType="exilUnsignedDecimal" exilMin="1" exilMax="9999999999999.99" ></span></td>
				</tr>
				<tr >
				<td  align="right"><span align="right" valign="center" class="labelcell">Financing Source</span></td>
					<td><span  class=fieldcell><input type="hidden" id="fundSource_id" name="fundSource_id"  class="fieldinput"><input id="fundSource_name" name="fundSource_name" tabindex=-1 class="fieldinput" readOnly></span>
					</td>


									<td   align="right"><span align="right" valign="center" class="labelcell">Bill Date </span> </td>
									<td>
											<span  class=smallfieldcell><input name="contBillDetail_billDate" class="datefieldinput" id="contBillDetail_billDate"  maxlength="11" onkeyup="DateFormat(this,this.value,event,false,'3')"   exilDataType="exilAnyDate"  exilCalendar="true" >&nbsp;</span>
									</td>
				</tr>
				<tr >
									<td  align="right"><span align="right" valign="center" class="labelcell">Bill Number</span></td>
									<td>
									<span  class=fieldcell><input  id="contBillDetail_billNumber" name="contBillDetail_billNumber"  class="fieldinput"></span></td>




					<td  align="right"><span align="right" valign="center" class="labelcell">Passed Amount<span class="leadon">*</span></span>
					</td>
					<td>
                    	<span  class=fieldcell><input name="contractorBillDetail_passedAmount" class="fieldinput-right" id="contractorBillDetail_passedAmount"  maxlength="16"
            exilMustEnter="true" exilDataType="exilUnsignedDecimal" exilMin="0" exilMax="9999999999999.99" onBlur="chkAmount();fillRate(this,event);loadTDSList();clearGrid('gridContractorDeduction');" ></span></td>
				</tr>

				 <tr >
				 <td  align="right"><span align="right" valign="center" class="labelcell">Narration</span>
					</td>
					<td  ><TEXTAREA class=narrationfieldinput onkeypress="return checkNarration(this)" id=voucherHeader_narration name=voucherHeader_narration  rows=1 exilDataType="exilAnyChar"></TEXTAREA>
					</td>

					<td align="right" valign="center" align="right"><span align="right" class="labelcell">
						Advance Adjusted </span>
					</td>
					<td class="fieldinput" width="212">
						<span  class=fieldcell><INPUT class=fieldinput-right id="worksDetail_adjustmentAmount" name="worksDetail_adjustmentAmount" tabindex=-1 maxlength="16"
            exilDataType="exilUnsignedDecimal" onBlur="return chkAmount()" value="0" SIZE="20"></span>
					</td>
				</tr><!--<tr >
					<td align="right" valign="center" class="labelcell"><span align="right">TDS Rate</span>
					</td>
					<td width="274" >
						<input class="fieldinput" name="contractor_tds" id="contractor_tds" readOnly exilDataType="exilUnsignedInt">

						<IMG id=IMG1 onclick=openSearch2(this) height=22 src="/egi/resources/erp2/images/plus1.gif" width=25 align=top border=0 >
					</td>
					<td align="right" valign="center" class="labelcell"><span align="right">TDS Amount</span>
					</td>
					<td><INPUT class=fieldinput-right id="worksDetail_tdsAmount" name="worksDetail_tdsAmount"
						 exilDataType="exilUnsignedDecimal" readOnly>
					</td><td class="fieldinput">
						<INPUT id="contractor_tds" name="contractor_tds" type="hidden">

					</td></tr>-->
					<tr  id="statusInfo">
					  <td id="statusLabel"  align="right"><span  align="right" valign="center" class="labelcell">
						Status</span></td>
				  	  <td id="StatusText"  >
						<span  class=fieldcell><input class="fieldinput" name="voucherHeader_status" id="voucherHeader_status" ></span>
					</td>

					</tr>
					<tr  id="CreaterInfo">
				<td   align="right"><span align="right" valign="center" class="labelcell">Approved By<SPAN class=leadon>*</SPAN></span>
					</td><td  >
					<span  class=fieldcell><INPUT class=fieldinput id=contractorBillDetail_approvedBy name="contractorBillDetail_approvedBy"  exilMustEnter="true" exilDataType="exilAnyChar" maxlength="25"></span></td>




					 <td  align="right"><span  align="right" valign="center" exilMustEnter="true" class="labelcell">Net Payable</span></td>
					 <td><span  class=fieldcell><INPUT class=fieldinput-right id="worksDetail_NetAmount" name="worksDetail_NetAmount" tabindex=-1 readOnly></span></td>
					</tr>

				 <tr><td id="auto-row3">&nbsp;<td width="0"/></tr>

				<tr>
          <td colspan=4>
                                    <table align=center width="100%" border="1" cellpadding="0" cellspacing="0" ID="gridContractorJournal">

                                      <tr class="thStlyle">
                                      <td width="1%"  class="">&nbsp;&nbsp;</td>
                                      <td width="16%"  class=""><span align="center" class="">Function Name</span></td>
                                      <td width="8%" height="34" class=""><span align="center" class=""  >Account Code</span></td>
                                      <td width="39%" class=""><span align="center">Account Head</span></td>
                                      <td width="11%" class=""><span align="center">Amount</span></td>
                                        <td width="15%" class=""  style="display:none"><span align="center">Narration</span></td>
                                        <td width="5%" class=""><span align="center">Details</span></td>
                                     </tr>
                                       <tr class="smallfieldcell">
                                       <td class="tdStlyle" width="1%"  onClick="changeColor(this,'gridContractorJournal');" name="selectTd" id="selectTd"></td>
        <!--(NORMAL FUNCTION and ACCOUNT CODE START)-->
                                       <td>
                                       <input type="hidden" name="cv_fromFunctionCodeId" id="cv_fromFunctionCodeId">
                                       <input class="labelcell" size=10 name="function_code" id="function_code"  style="WIDTH: 186; HEIGHT:
                  19" value="" autocomplete="off" onkeyup="autocompletefuncName(this);"  exilDescField="cv_fromFunctionCodeId" exilDataSource="functionIdKey" onBlur="splitCoaName(this,'cv_fromFunctionCodeId');funClear(this, 'chartOfAccounts')" exilInGrid="true"><IMG   id=IMG1 onclick=openSearch1(this,'function')
                  height=22 src="/egi/resources/erp2/images/plus1.gif" width=25 align=top border=0 >
										</td>
                                        <td>




					<input class="fieldinput-right" id="chartOfAccounts_glCode" name="chartOfAccounts_glCode"  autocomplete="off" onkeyup="autocompletecode(this);" exilDataSource="" exilDescField="chartOfAccounts_name" onBlur="splitCoaName(this,'chartOfAccounts_name')" maxlength="20" style="WIDTH: 55px; HEIGHT: 19px" size="19" exilDataType="exilAlphaNumeric" exilInGrid="true" ><IMG id=IMG1 onclick="openSearch(this, 'chartOfAccounts','')" height=22 src="/egi/resources/erp2/images/plus1.gif" width=25 align=top border=0  >
                                        </td>
        <!--(NORMAL FUNCTION and ACCOUNT CODE END)-->

                                     <td >
										<input class="fieldinput-left" size=22 id="chartOfAccounts_name" name="chartOfAccounts_name" maxlength="50" style="WIDTH: 345; HEIGHT: 21" readOnly tabindex=-1>
									</td>

                                        <td >
                                        <INPUT class="fieldinput-right"  maxlength="16" id="voucherDetail_debitAmount"  name="voucherDetail_debitAmount" onBlur="colTotal(this,'debitTotal')" exilDataType="exilUnsignedDecimal" onKeyDown ="addNewRow('gridContractorJournal','chartOfAccounts_glCode');" exilMin="0" exilMax="9999999999999.99" SIZE="20" >
                                        </td>


										<td style="display:none"><input class="fieldinput-left" id="voucherDetail_narration" name="voucherDetail_narration"  size=24 onKeyPress="return checkNarration(this)"


                  style="WIDTH: 164px; HEIGHT: 19px" exilDataType="exilAnyChar">
           								 </td>
           								 <td><A  class=link id=A1 style="WIDTH: 10px; HEIGHT: 19px"  onclick ="openDetails(this,'chartOfAccounts_glCode','contractorjournal','entities_grid','')"  href="#" >Click</A>
           								 </td>
                                       </tr>

                                    </table>
                     </td></tr>
					<tr>
                         <td colspan=4>
                         <table>
							<tr>

								<td colspan="2" align="center"><input type="button"  class="button" value="Delete Row" id="deleteDetail" name="deleteDetail"  onclick=" deleteRowTable('gridContractorJournal');colAllTotalSingleCol('voucherDetail_debitAmount','debitTotal');" /></td>
								<td colspan="2" align="center"><input type="button"  class="button" value="Add Row" id="addDetail" name="addDetail"  onclick="addNewRowFromButton('gridContractorJournal','chartOfAccounts_glCode','chartOfAccounts_name');" /></td>

							</tr>
						</table>
                        </td>
                        </tr>
									<span id="functioncontainer"></span>
						<tr><td colspan=4>
                        <table width="100%" border="0" cellpadding="0" cellspacing="0" ID="buttonTable">
                      <tr><td>
                      <table align=center width="100%" border="1" cellpadding="0" cellspacing="0" ID="buttonInTable">
						 					<!--<tr >
						 						<td width="20%" class="labelcell" align=right>&nbsp;</td>
						                         <td width="25%" class="labelcell" align=right>Total</td>
						                         <td width="15%" class="columnheader"><INPUT class=fieldinput-right id="debitTotal" name="debitTotal"  style="BORDER-RIGHT: thin; BORDER-TOP: thin; BORDER-LEFT: thin; WIDTH: 102px; BORDER-BOTTOM: thin; HEIGHT: 15px" disabled size=8 ></td>
						                         <td width="15%" class="columnheader"><input class="fieldinput-right" size=8 id="creditTotal" name="creditTotal"  disabled style="BORDER-RIGHT: thin; BORDER-TOP: thin; BORDER-LEFT: thin; WIDTH: 103px; BORDER-BOTTOM: thin; HEIGHT: 15px"
						                  ></td>
						 						<td width="25%" class="columnheader"></td>
						 						<td width="25%" class="columnheader"></td>
						                     </tr>-->
						 						<tr  >
													<td>
						                                         	<span       style="WIDTH: 100; HEIGHT: 19px" size   ="14" id=SPAN1></span>
						                                          </td>
						                                         <td width="179" >
						                                         	<span       style="WIDTH: 100; HEIGHT: 19px" size   ="14" id=SPAN1></span>
						                                          </td>
						                                         <td  align=right >
						 											<span     class="labelcell"
						             style="WIDTH: 200px; HEIGHT: 19px;" id=SPAN1
						                  >Total</span>
						                                         </td>
						                                         <td width="141" >
						 	                                        <span  class=fieldcell>
																		<INPUT  class=fieldinput-right style="WIDTH: 122; HEIGHT: 19" id="debitTotal" name="debitTotal" tabindex=-1  readOnly SIZE="20"></span>
						                                         </td>

						                                         <td   style="display:none" width="51">
						                                         	<span style="WIDTH: 5px; HEIGHT: 19px"></span>
						 										</td>
						 										 <td><A  id=A1 style="WIDTH: 10px; HEIGHT: 19px"  	tabIndex=-1 href="#" >     </A>
						            								 </td>
						                                        </tr>
                 </table></td>   </tr>
                         <tr >
								<td align="middle" >&nbsp;</td>
						  </tr>
     					      </table>
     					      <table align=center width="114">
     					      <tr class="rowheader" align=center>
     					      <td colspan="0" class="thStlyle" >Deductions</td>
     					      </tr>
     					      </table>

                              <table align=center width="100%" border="1" cellpadding="0" cellspacing="0" ID="gridContractorDeduction">
												  <tr class="rowheader">
                                                    <td  class="thStlyle">&nbsp;&nbsp;</td>
												    <td   class="thStlyle"><span align="center" >Function Name</span></td>
													<td  class="thStlyle"><span align="center">glcode</span></td>
													<td  class="thStlyle"><span align="center"  >Type</span></td>
													<td   class="thStlyle"><span align="center"  >Account Code</span></td>
													<td  class="thStlyle"><span align="center">Account Head</span></td>
													<td  class="thStlyle"><span align="center">Amount</span></td>
													<td  class="thStlyle">&nbsp;</td>
												  </tr>
												   <tr class=smallfieldcell>
												   <td class="tdStlyle" width="1%"  onClick="changeColor(this,'gridContractorDeduction');" name="selectTd" id="selectTd"></td>

			<!--(FUNCTION and ACCOUNT CODE FOR DEDUCTION START)-->
											   <td>
                                    <input type="hidden" name="cv_fromFunctionCodeId1" id="cv_fromFunctionCodeId1">
									<select name="function_code1" id="function_code1"  onchange="setfunctionCode(this)" style="WIDTH: 171; HEIGHT:21"  exilInGrid="true"> </select>
									</td>
								   <td ><input type="hidden" id='tdsId' name='tdsId'><input class="fieldinput-left" size=22 id="gl_Code" name="gl_Code" maxlength="50" style="WIDTH: 55px; HEIGHT: 19px" readOnly></td>
								   <td>
									<select class="fieldinput-left" id="tds_Code" name="tds_Code"  onChange="getTds(this,event)" onBlur="getNetamt()" maxlength="20" style="WIDTH: 164; HEIGHT: 20"  exilDataType ="exilAnyChar" exilInGrid="true"
									exilListSource="TDSList" exilDescField="coa_name"></select></td>
									 <td>


<!--
<input class="fieldinput-right" id="DedchartOfAccounts_glCode" name="DedchartOfAccounts_glCode" TABINDEX="" autocomplete="off"  onkeyup="autoCompletion3(this);"  onBlur="ClearType(this);getAccName(event);"  " maxlength="20" style="WIDTH: 55px; HEIGHT: 19px" size    ="19" exilDataType="exilAlphaNumeric" exilInGrid="true"
-->
						<input class="fieldinput-right" id="DedchartOfAccounts_glCode" name="DedchartOfAccounts_glCode"   autocomplete="off"  exilDataSource="" exilDescField="coa_name" onkeyup="autocompleteDedCode(this);"  onBlur="splitCoaName(this,'coa_name');getNetamt();loadDedGlcode(this);" maxlength="20" style="WIDTH: 55; HEIGHT: 19" size    ="19" exilDataType="exilAlphaNumeric" exilInGrid="true"><IMG id=IMG1 onclick="openSearch(this, 'chartOfAccounts','Deduction')" height=22 src="/egi/resources/erp2/images/plus1.gif" width=25 align=top border=0  >
                                        </td>
            <!--(FUNCTION and ACCOUNT CODE FOR DEDUCTION END)-->

												   <td >
													<input class="fieldinput-left" id="coa_name" name="coa_name"  maxlength="50" style="WIDTH:200;" tabindex=-1 readOnly></td>
												   <td><input type="hidden" id='glcodeId' name='glcodeId'>
													<input class="fieldinput-right" size=22 maxlength="16" id="dedAmount" name="dedAmount"  maxlength="50" style="WIDTH: 141; HEIGHT: 19"  onKeyDown ="addClearedRow()"    onblur="getNetamt()"></td>
												   <td>&nbsp;</td>
												   </tr>

				   				</table>
				   				<table><tr>
							                 <td>
							                        <table>
														<tr>
															<td colspan="2" align="center"><input type="button"  class="button" value="Delete Row" id="deleteDetail" name="deleteDetail"  onclick=" deleteRowTable('gridContractorDeduction');colAllTotalSingleCol('dedAmount','deductTotal');getNetamt();" /></td>
															<td colspan="2" align="center"><input type="button"  class="button" value="Add Row" id="addDetail" name="addDetail"  onclick="setAttribute_rowsToClone('gridContractorDeduction');addNewRowFromButton('gridContractorDeduction','DedchartOfAccounts_glCode','coa_name');clearRow();" /></td>
														</tr>
													</table>
							                    </td>
							            </tr>
							    </table>
                      <table align=center width="100%" border="1" cellpadding="0" cellspacing="0" ID="totalDeduction">

						<tr>
			                <td  colspan="3" width="76%" align=right>
			 					<span     class="labelcell" style="WIDTH: 145px; HEIGHT: 19px" id=SPAN4>Total</span>
			                </td>
							<td colspan="2" width="15%">
							 	<span  class=fieldcell>
									<INPUT class=fieldinput-right style="WIDTH: 139; HEIGHT: 21" id="deductTotal" name="deductTotal" readOnly tabindex=-1></span>
							</td>
					 	</tr>
                 	</table>
					</td></tr>
                 			<tr >
				<td height="25" colspan="4" valign="bottom" class="smalltext"><p class="smalltext"><span class="leadon">*</span>
						- Mandatory Fields&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				*-Advance Amount Not yet adjusted</p><br>
				</td>
			</tr><!--  Buttons for Request Form starts here -->


   			<tr  align="centre">
				<td colspan="4" align="middle"><!-- Buttons Start Here -->
					<table border="0" cellpadding="0" cellspacing="0" align="center">
					<tr id="modGrid">
							<td align="center" width=100% colspan=4>
							<input   type="button" class="button" value="Reverse"  onclick=modify(); />
							</td>
					</tr>
					<tr id="backbutton" >
						<td width=100% align=center colspan=4>
						<input   type="button" class="button" value="Back"  onclick="back(window.self)" />

						</td>
					</tr>
					<tr id="reverseRecord"  style="DISPLAY: none">
						<td align="right"><span   valign="center" class="labelcell"> Voucher Number<SPAN class=leadon>*</SPAN></span>
						</td>
						<td><span class=fieldcell><input  class=fieldcell name="voucherHeader_newVcNo" id="voucherHeader_newVcNo" maxlength="10"   exilDataType="exilAlphaNumeric" style="width:148; height:19"></span>
						</td>
						<td align="right">
							<span   valign="center" class="labelcell" >Voucher Date<span class="leadon">*</span>
						</td>
						<td><span class=smallfieldcell> <INPUT class="smallfieldcell" name="voucherHeader_effDate" exilDataType="exilAnyDate" id   ="voucherHeader_effDate" style="WIDTH: 120x; HEIGHT: 19px" size="13" onkeyup="DateFormat(this,this.value,event,false,'3')" exilCalendar="true"></span>
						</td>
						<td><INPUT	 type   =hidden class   ="datefieldinput" name="diffDebit" id="diffDebit" style="WIDTH: 101px; HEIGHT: 19px"	size="13">
						</td>
					</tr>

					</table>




						<table border="0" cellpadding="0"  cellspacing="0" align="center">
						<tr id="submitGrid">
							<td>
							 <input  id="saveandnew" type="button" class="button" value="Save & New"  onclick="return ButtonPress('savenew');"/>
							 <input   type="button" class="button" value="Save & Close"  onclick="return ButtonPress('saveclose');" />
							 <input   type="button" class="button" value="Cancel"   onclick="onClickCancel()" />
							 <input   type="button" class="button" value="Close"   onclick=window.close(); />
							 <input   type="button" class="button" value="Show GlEntry"   onclick=showglEntry(); />
							</td>

						</tr></table>
						<table border="0" cellpadding="0" cellspacing="0" align="center">
						<tr id="reverseSubmit">
						<td>
						<input type="button"  id="revsave" value="Submit" class="button"  onclick="return ButtonPress('saveclose');"/>
						<input type="button" id="revclose" value="Close" class="button"  onclick="window.close();" />
						</td>
						</tr></table></td>
						</tr>
						</table>
						<table width="100%" border=0 cellpadding="3" cellspacing="0" id="showEntries" name="showEntries" style="DISPLAY: none">
						<tr >
						<td colspan=4>
						<table width="100%" align=center border="0" cellpadding="0" cellspacing="0" >
						<tr  height="25">
						 <TD class=displaydata align=middle tabindex=-1 ><h4>GLEntry</h4></TD></tr>
						</table>
						</td>
						</tr>
						<tr><td>
						<table width="80%" border="1" cellpadding="0" cellspacing="0" align=center id="entries" name="entries">
						<tr class="thStlyle">
							<td class="" ><span align="center" valign="center" class=""> Code Type</span></td>
							<td  class=""><span align="center" valign="center" class=""> Account Code</span></td>
							<td  class=""><span align="center" valign="center" class=""> Account Head</span></td>
							<td  class=""><span align="center" valign="center" class=""> Debit </span></td>
							<td  class=""><span align="center" valign="center" class=""> Credit</span></td>
							<td  class=""><span align="center" valign="center" class=""> Narration</span></td>
						</tr>
						<tr class="labelcell">
							<td ><span name="display_CodeType"  id="display_CodeType"   readOnly maxLength="10" >&nbsp;</span></td>
							<td ><span name="display_Code"  id="display_Code"   readOnly maxLength="10" >&nbsp;</span></td>
							<td ><span name="display_Head"  id="display_Head"  readOnly maxLength="10" >&nbsp;</span></td>
							<td ><span name="display_Debit"  id="display_Debit"  readOnly maxLength="16" >&nbsp;</span></td>
							<td ><span name="display_Credit"  id="display_Credit"  readOnly maxLength="16" >&nbsp;</span></td>
							<td ><span name="display_Narration" id="display_Narration"  readOnly maxLength="10" >&nbsp;</span></td>
						</tr>
						</table>
						</td>
						</tr>
						</table>

							<table id="entities_grid" width="20%" style="DISPLAY: none">
								<tr>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
								</tr>

							<tr>
								<td><input id="grid_detTypeId" name="grid_detTypeId" style="WIDTH: 100px" size="20"></td>
								<td><input id="grid_detKeyId" name="grid_detKeyId" style="WIDTH: 100px" size="20"></td>
								<td><input id="grid_detValue" name="grid_detValue" style="WIDTH: 100px" size="20" ></td>
								<td><input id="grid_rowIndex" name="grid_rowIndex" style="WIDTH: 100px" size="20"></td>
								<td><input id="grid_amount" name="grid_amount" style="WIDTH: 100px"></td>
								<td><input id="grid_detCode" name="grid_detCode" style="WIDTH: 100px"></td>
					          	<td><input id="grid_rowFunId" name="grid_rowFunId" style="WIDTH: 100px" size="20"></td>
							</tr>
	</table>
				<table id="entities_Dedgrid" width="20%" style="DISPLAY: none">
					<tr>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
					</tr>

					<tr>
						<td><input id="Dedgrid_detTypeId" name="Dedgrid_detTypeId"
							style="WIDTH: 50px"></td>
						<td><input id="Dedgrid_detKeyId" name="Dedgrid_detKeyId"
							style="WIDTH: 50px"></td>
						<td><input id="Dedgrid_detValue" name="Dedgrid_detValue"
							style="WIDTH: 50px"></td>
						<td><input id="Dedgrid_rowIndex" name="Dedgrid_rowIndex"
							style="WIDTH: 50px"></td>
					</tr>
				</table>
				</td></tr></table>
<span id="codescontainer"></span>
</td></tr></table>

		</form>
<!-- /span></span></span></td></tr></table -->
<!-- We will set the "left" position value inside autocompletion method -->
		 <span style="position: absolute;top:170px;width:118px;height:30px" id="menu-popup" > </span>
		 <table id="completeTable" bgcolor="#cae1ff" border="1">

		 <!--
		  <span style="position: absolute; top:200px;left:203px;width:118px;height:30px" id="menu-popup" >
		 <table id="completeTable1" bgcolor="#cae1ff" border="1"/>
		 </span>
		 -->

	</body>
</html>
