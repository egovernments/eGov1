#-------------------------------------------------------------------------------
# eGov suite of products aim to improve the internal efficiency,transparency, 
#      accountability and the service delivery of the government  organizations.
#   
#       Copyright (C) <2015>  eGovernments Foundation
#   
#       The updated version of eGov suite of products as by eGovernments Foundation 
#       is available at http://www.egovernments.org
#   
#       This program is free software: you can redistribute it and/or modify
#       it under the terms of the GNU General Public License as published by
#       the Free Software Foundation, either version 3 of the License, or
#       any later version.
#   
#       This program is distributed in the hope that it will be useful,
#       but WITHOUT ANY WARRANTY; without even the implied warranty of
#       MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#       GNU General Public License for more details.
#   
#       You should have received a copy of the GNU General Public License
#       along with this program. If not, see http://www.gnu.org/licenses/ or 
#       http://www.gnu.org/licenses/gpl.html .
#   
#       In addition to the terms of the GPL license to be adhered to in using this
#       program, the following additional terms are to be complied with:
#   
#   	1) All versions of this program, verbatim or modified must carry this 
#   	   Legal Notice.
#   
#   	2) Any misrepresentation of the origin of the material is prohibited. It 
#   	   is required that all modified versions of this material be marked in 
#   	   reasonable ways as different from the original version.
#   
#   	3) This license does not grant any rights to any user of the program 
#   	   with regards to rights under trademark law for use of the trade names 
#   	   or trademarks of eGovernments Foundation.
#   
#     In case of any queries, you can reach eGovernments Foundation at contact@egovernments.org.
#-------------------------------------------------------------------------------
<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta http-equiv="KEYWORDS" content="">
<meta http-equiv="DESCRIPTION" content="">
<!-- Inclusion of the CSS files that contains the styles -->
<link rel=stylesheet href="../exility/global.css" type="text/css">
<SCRIPT LANGUAGE="javascript" SRC="../exility/PageValidator.js"></SCRIPT>
<SCRIPT LANGUAGE="javascript" SRC="../exility/PageManager.js"></SCRIPT>
<SCRIPT LANGUAGE="javascript" SRC="../exility/ExilityParameters.js"></SCRIPT>
<SCRIPT LANGUAGE="javascript" SRC="../script/PaymentSearchFunc.js.htm"></SCRIPT>
<SCRIPT LANGUAGE="javascript" SRC="../script/jsCommonMethods.js"></Script>
<SCRIPT type="text/javascript" src="../script/calendar.js" type="text/javascript" ></SCRIPT>
<SCRIPT LANGUAGE="javascript">
var cWind;         // temporary window reference
var count=1;      // Counter which gives number of child windows opened
var cWindows=new Object();    //HashMap where we store child window
var mode;
function ButtonPress(){
		if(PageValidator.validateForm()){

			PageManager.DataService.removeQueryField('paymentType');
			PageManager.DataService.removeQueryField('voucherNumberFrom');
			PageManager.DataService.removeQueryField('voucherNumberTo');
			PageManager.DataService.removeQueryField('voucherDateFrom');
			PageManager.DataService.removeQueryField('voucherDateTo');
			hideColumn(1);

		//	var type=document.getElementById('paymentType').value;
		    var type;
		    if (mode == "viewCash" || mode == "reverseCash"){
		        type="Cash Payment";
		        }else if(mode == "viewBank" || mode == "reverseBank"){
		         type="Bank Payment"
		        }
			if(type && (type=="Cash Payment" || type=="Bank Payment")){
				PageManager.DataService.setQueryField('paymentType',type);
			}

			var voucherNumberFrom=document.getElementById('voucherNumberFrom').value;
			if(voucherNumberFrom && voucherNumberFrom.length!=0)
				PageManager.DataService.setQueryField('voucherNumberFrom',voucherNumberFrom);

			var voucherNumberTo=document.getElementById('voucherNumberTo').value;
			if(voucherNumberTo && voucherNumberTo.length!=0)
				PageManager.DataService.setQueryField('voucherNumberTo',voucherNumberTo);

			var voucherDateFrom=document.getElementById('voucherDateFrom').value;
			if(voucherDateFrom && voucherDateFrom.length!=0)
				PageManager.DataService.setQueryField('voucherDateFrom',formatDate1(voucherDateFrom));

			var voucherDateTo=document.getElementById('voucherDateTo').value;
			if(voucherDateTo && voucherDateTo.length!=0)
				PageManager.DataService.setQueryField('voucherDateTo',formatDate1(voucherDateTo));

			if(voucherNumberFrom && voucherNumberFrom.length!=0 && voucherNumberTo && voucherNumberTo.length!=0){
				if(voucherNumberFrom.toLowerCase()>voucherNumberTo.toLowerCase()){
					alert('voucherNumberFrom And voucherNumberTo field must be Decreasing Order of Alphanumerics');
					return false;
				}
			}
			if (mode == "reverseBank" || mode == "reverseCash")
			{
			 var num=0;
			 PageManager.DataService.setQueryField('statusNum',num);
			 PageManager.DataService.callDataService('paymentSearch');
		 	 }
			 else
			PageManager.DataService.callDataService('paymentSearch');



			var table=document.getElementById('paymentSearchGrid');
				table.style.display="block";

			if(type=='Cash Payment')
					hideColumn(7);
				else
					showColumn(7);
		 }
}
 function onloadTasks(){
	PageValidator.addCalendars();
	mode=PageManager.DataService.getQueryField('showMode');
	switch (mode) {
		case "viewBank":document.getElementById('screenName').innerHTML="Bank Payments - Search";break;
		case "viewCash":document.getElementById('screenName').innerHTML="Cash Payments - Search";break;
		case "reverseBank":document.getElementById('screenName').innerHTML="Bank Payments - Search";break;
		case "reverseCash":document.getElementById('screenName').innerHTML="Cash Payments - Search";break;

	}

}
function ModeChange(){
	var table=document.getElementById('paymentSearchGrid');
				table.style.display="none";
}
function hideColumn(index){
	var table=document.getElementById('paymentSearchGrid');
   	for(var i=0;i<table.rows.length;i++){
		table.rows[i].cells[index].style.display="none";
   	}
}

function showColumn(index){
	var table=document.getElementById('paymentSearchGrid');
   	for(var i=0;i<table.rows.length;i++){
   		table.rows[i].cells[index].style.display="block";
   	}
}
function beforeRefreshPage(dc){
		var tabObj=dc.grids['paymentSearchGrid'];
		if(!tabObj)	return false;
		if(tabObj.length<2){
			alert("No Data");

		}
		for(var i=1;i<tabObj.length;i++){
				tabObj[i][2]=formatDate(tabObj[i][2]);
			}

	return true;
}
/*function formatDate(dateText){
	dateText=dateText.substring(0,10);
	var dateArray= dateText.split('-');
	var newDate=dateArray[2]+"-"+dateArray[1]+"-"+dateArray[0];
	return newDate;
}*/

//added by rashmi

function changeColor(){
		var table=document.getElementById('paymentSearchGrid');
		for(var i=1;i<table.rows.length;i++){
			var statusObj=PageManager.DataService.getControlInBranch(table.rows[i],"status");
 			var status=statusObj.innerHTML;
			if(status=='1')
 			{
 				var trObj=PageManager.DataService.getRow(statusObj);
 				//trObj.setAttribute('className','rowRev');
 				trObj.className='rowRev';
 				}
 			if(status=='2')
 			{
 				var trObj=PageManager.DataService.getRow(statusObj);
 				//trObj.setAttribute('className','rowRev');
 				trObj.className='rowRev2';
 				}
 				if(status=='0')
 			{
 				var trObj=PageManager.DataService.getRow(statusObj);
 				trObj.className='normaltext';

 			}

  	 	}
}


function afterRefreshPage(dc){
	addSlNo();
	changeColor();
	var voucherDateFrom=document.getElementById('voucherDateFrom').value;
	var voucherDateTo=document.getElementById('voucherDateTo').value;
	if(voucherDateFrom && voucherDateFrom.length!=0)
			{
				var VouDateFrom=dc.values['voucherDateFrom'];
					//alert("VouDateFrom"+formatDateToDDMMYYYY5(VouDateFrom)+" VouDateTo"+formatDateToDDMMYYYY5(VouDateTo));
				VouDateFrom=formatDateToDDMMYYYY5(VouDateFrom);
				document.getElementById('voucherDateFrom').value=VouDateFrom;
			}
					
	if(voucherDateTo && voucherDateTo.length!=0)
				{
					var VouDateTo=dc.values['voucherDateTo'];	
					VouDateTo=formatDateToDDMMYYYY5(VouDateTo);
					document.getElementById('voucherDateTo').value=VouDateTo;
				}		
	return true;
}
function addSlNo(){
	var slNo=1;
	var tabObj=document.getElementById("paymentSearchGrid");
	for(var i=1;i<tabObj.rows.length;i++){
	var obj=PageManager.DataService.getControlInBranch(tabObj.rows[i],"slNo");
	obj.innerHTML=slNo;
	slNo++;
	}
}

function getDetails(obj){
	var row=PageManager.DataService.getRow(obj);
	var table=document.getElementById('paymentSearchGrid');
	var cgn1=PageManager.DataService.getControlInBranch(table.rows[row.rowIndex],"cgNumber");
	cgn1=cgn1.innerHTML;
	var cgn2=cgn1.substring(0,3);
	switch(cgn2){
	case 'DBP':
	//window.location="DirectBankPayment.htm?cgNumber="+cgn1+"&showMode="+mode;
	cWind=window.open("DirectBankPayment.htm?cgNumber="+cgn1+"&showMode="+mode,"","height=650,width=900,scrollbars=yes,left=20,top=20,status=yes");
	cWindows[count++]=cWind;
	break;
	case 'DCP' :
	//window.location="DirectCashPayment.htm?cgNumber="+cgn1+"&showMode="+mode;
	cWind=window.open("DirectCashPayment.htm?cgNumber="+cgn1+"&showMode="+mode,"","height=650,width=900,scrollbars=yes,left=20,top=20,status=yes");
	cWindows[count++]=cWind;
	break;
	}
}

</SCRIPT>
</head>
<body bgcolor="#ffffff" bottommargin="0" topmargin="0" rightmargin="0" leftmargin="0" marginheight="0" marginwidth="0" onLoad="onloadTasks()" onbeforeunload="closeChilds(cWindows,count)" ><!------------------ Header Begins Begins--------------------->
<form name="journalVoucher">
	<table width="100%" border=0 cellpadding="3" cellspacing="0">
		<tr >
			<td class="rowheader" valign="center" colspan="4" width="100%"><span id="screenName" class="headerwhite2">Payment - Search</span></td>
		</tr>
		<tr class="row1" >
		<!--	<td width="25%"><div align="right" valign="center" class="normaltext" >Payment Type</div></td>
			<td width="25%">
				<select class="fieldinput" name="paymentType" id="paymentType" exilListSource="paymentType" exilMustEnter="true" onChange="ModeChange()">
				<option value="All">All</option>
				<option value="Cash Payment">Cash Payment</option>
				<option value="Bank Payment">Bank Payment</option>
				</select>
			</td>

			<td width="25%" >&nbsp;</td>
			<td width="25%">&nbsp;
			</td>		-->
		</tr>

		<tr class="row2">
			<td ><div align="right" valign="center" class="normaltext">Voucher Number From</div></td>
			<td>
				<input class="fieldinput" name="voucherNumberFrom" id="voucherNumberFrom" exilDataType="exilAnyChar" >
			</td>

			<td ><div align="right" valign="center" class="normaltext"> To</div></td>
			<td >
				<input class="fieldinput" name="voucherNumberTo" id="voucherNumberTo" exilDataType="exilAnyChar" >
			</td>
		</tr>

		<tr class="row1">
			<td ><div align="right" valign="center" class="normaltext">Voucher Date From</div></td>
			<td >
				<input class="datefieldinput"  name="voucherDateFrom"  id="voucherDateFrom" onkeyup="DateFormat(this,this.value,event,false,'3')" exilCalendar="true">
			</td>

			<td ><div align="right" valign="center" class="normaltext">To</div></td>
			<td>
				<input class="datefieldinput" name="voucherDateTo"  id="voucherDateTo" onkeyup="DateFormat(this,this.value,event,false,'3')"  exilCalendar="true">
			</td>
		</tr>
		<tr class="row2">
			<td colspan="4" align="middle"><!-- Buttons Start Here -->
				<table border="0" cellpadding="0" cellspacing="0">
					<tr>
						<td align="right">
							<IMG src="/egi/resources/erp2/images/Button_leftside.gif" width="7" height="18"></td>
						<td bgcolor="#fe0000" valign="center" nowrap><A class=buttonprimary href="#" onClick="ButtonPress()">Search</a></td>
						<td>
							<IMG src="/egi/resources/erp2/images/Button_rightside.gif" width="7" height="18"></td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<table width="100%" border="1" cellpadding="0" cellspacing="0" name="paymentSearchGrid" id="paymentSearchGrid" style="DISPLAY:none">
		<tr class="rowheader">
			<td width="5%" class="columnheader"><div align="center" class="columnheader">Sl No</div></td>
			<td width="10%" class="columnheader"><div align="center">CG Number</div></td>
			<td width="20%" class="columnheader"><div align="center">Voucher Date</div></td>
			<td width="15%" class="columnheader"><div align="center">Voucher Number</div></td>
			<td width="15%" class="columnheader"><div align="center">PaidTo</div></td>
			<td width="10%" class="columnheader"><div align="center">PassedAmt</div></td>
			<td width="10%" class="columnheader"><div align="center">BillAmt</div></td>
			<td width="15%" class="columnheader"><div align="center">ChequeNo</div></td>
			<td width="20%" class="columnheader"><div align="center">Status</div></td>
		</tr>

		<tr class="normaltext">
			<td><div id="slNo" name="slNo" exilTrimLength="8">&nbsp;</div></td>
			<td><div id="cgNumber" name="cgNumber" exilTrimLength="10">&nbsp;</div></td>
			<td><div id="voucherDate" name="voucherDate" >&nbsp;</div></td>
			<td><A onClick="getDetails(this)" href="#"><div id="voucherNumber" name="voucherNumber" exilTrimLength="10">&nbsp;</div></A></td>
			<td><div id="paidTo" name="paidTo" exilTrimLength="10">&nbsp;</div></td>
			<td align=right><div id="passedAmount" name="passedAmount" exilTrimLength="10">&nbsp;</div></td>
			<td align=right style="border-right-width:thick"><div id="billAmount" name="billAmount" exilTrimLength="10">&nbsp;</div></td>
			<td><div id="chequeNumber" name="chequeNumber" exilTrimLength="10">&nbsp;</div></td>
			<td><div id="status" name="status"  exilTrimLength="10">&nbsp;</div></td>
		</tr>
	</table>
</form>
</body>
</html>
