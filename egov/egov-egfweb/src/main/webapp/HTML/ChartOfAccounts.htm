#-------------------------------------------------------------------------------
# eGov suite of products aim to improve the internal efficiency,transparency, 
#      accountability and the service delivery of the government  organizations.
#   
#       Copyright (C) <2015>  eGovernments Foundation
#   
#       The updated version of eGov suite of products as by eGovernments Foundation 
#       is available at http://www.egovernments.org
#   
#       This program is free software: you can redistribute it and/or modify
#       it under the terms of the GNU General Public License as published by
#       the Free Software Foundation, either version 3 of the License, or
#       any later version.
#   
#       This program is distributed in the hope that it will be useful,
#       but WITHOUT ANY WARRANTY; without even the implied warranty of
#       MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#       GNU General Public License for more details.
#   
#       You should have received a copy of the GNU General Public License
#       along with this program. If not, see http://www.gnu.org/licenses/ or 
#       http://www.gnu.org/licenses/gpl.html .
#   
#       In addition to the terms of the GPL license to be adhered to in using this
#       program, the following additional terms are to be complied with:
#   
#   	1) All versions of this program, verbatim or modified must carry this 
#   	   Legal Notice.
#   
#   	2) Any misrepresentation of the origin of the material is prohibited. It 
#   	   is required that all modified versions of this material be marked in 
#   	   reasonable ways as different from the original version.
#   
#   	3) This license does not grant any rights to any user of the program 
#   	   with regards to rights under trademark law for use of the trade names 
#   	   or trademarks of eGovernments Foundation.
#   
#     In case of any queries, you can reach eGovernments Foundation at contact@egovernments.org.
#-------------------------------------------------------------------------------
<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
	<head>
		<SCRIPT LANGUAGE = "javascript">

		var pageMode = "insert";
		var fromScreen="";
		var first = "true";
		var oldDtl = "";
		var orgGlCode = "";
		var cCode="";
		function ButtonPress(name){
			document.getElementById('egUser_id').value = CookieManager.getCookie('currentUserId');
			var obj=document.getElementById("chartOfAccounts_classification");
			if(obj.options[obj.selectedIndex].text == "")
			{
			  alert("Select Classification");
			  return false;
     		 }
			 var obj1=document.getElementById("chartOfAccounts_accType1");
			 if(obj1.options[obj1.selectedIndex].text != "")
			 {
				if(obj.options[obj.selectedIndex].value <4)
				alert("Cannot set AccountDeailType for Classification "+obj.options[obj.selectedIndex].value);

			 }
			//   ***1 only FO***,  ***2 FO***,  ***Admin, 3 All***    //
			if(!isValidUser(1, CookieManager.getCookie('userRole')) ) return false;
			checkNarration("chartOfAccounts_description");
			if(PageValidator.validateForm()){
				var glcode=document.getElementById("chartOfAccounts_glCode").value;
				var temp=document.getElementById("chartOfAccounts_glCode").value + document.getElementById("chartOfAccounts_glCode2").value;
				document.getElementById("chartOfAccounts_glCode").value = temp;
				document.chartOfAccounts.chartOfAccounts_classification.disabled=false;
				PageManager.UpdateService.submitForm('chartOfAccountsInsertion');
				document.getElementById("chartOfAccounts_glCode").value=glcode;
			}
		}

		function onClickCancel()
		{
			var chartOfAccounts_glCode = document.getElementById('chartOfAccounts_glCode').value;
				if(fromScreen == "detailCodeEnquiry")
				{
					window.location="DetailCodeEnquiry.htm?chartOfAccounts_glCode="+chartOfAccounts_glCode+"&actionId="+document.getElementById("actionId").value;
				}
				else
				{
					window.location="ChartOfAccountsEnquiry.htm?chartOfAccounts_glCode="+chartOfAccounts_glCode+"&actionId="+document.getElementById("actionId").value;
				}
		}

		function afterUpdateService(dc)
		{
			if(dc.values['serviceID']=='chartOfAccountsInsertion')
			{
				PageManager.UpdateService.submitForm('reloadChartofAccounts');
			}
			else
			{
				var chartOfAccounts_glCode = document.getElementById('chartOfAccounts_glCode').value;
				var chartOfAccounts_glCode2 = document.getElementById('chartOfAccounts_glCode').value + document.getElementById('chartOfAccounts_glCode2').value;
				if(fromScreen == "detailCodeEnquiry")
				{
					window.location="DetailCodeEnquiry.htm?chartOfAccounts_glCode="+chartOfAccounts_glCode+"&actionId="+document.getElementById("actionId").value;
				}
				else
				{
					window.location="ChartOfAccountsEnquiry.htm?chartOfAccounts_glCode="+chartOfAccounts_glCode2+"&actionId="+document.getElementById("actionId").value;
				}
			}
		}



		function getData(){
			//PageManager.DataService.callDataService('getGlCodeLength');
			fromScreen=PageManager.DataService.getQueryField('fromScreen');
			if(fromScreen == "detailCodeEnquiry")
			{
				document.getElementById("classificationrow").style.display="none";
				document.getElementById("screenheaderrow").style.display="none";

			}
			document.getElementById("actionId").value=PageManager.DataService.getQueryField('actionId');
			//alert(document.getElementById("actionId").value);
			PageManager.ListService.callListService();
			cCode = PageManager.DataService.getQueryField('accCode');
			orgGlCode = cCode;
			pageMode = PageManager.DataService.getQueryField('mode');
			if(pageMode == "modifyPosting"){
				document.chartOfAccounts.chartOfAccounts_glCode.readOnly = true;
				document.getElementById('chartOfAccounts_glCode2').removeAttribute('exilMustEnter');
			//	document.chartOfAccounts.chartOfAccounts_glCode2.readOnly = true;
				document.getElementById('chartOfAccounts_glCode2').style.visibility='hidden';
				document.chartOfAccounts.chartOfAccounts_majorHead.readOnly=true;
				document.chartOfAccounts.chartOfAccounts_type.readOnly=true;
				document.chartOfAccounts.chartOfAccounts_classification.disabled=true;
				document.chartOfAccounts.coa_isActiveForPosting.focus();
				PageManager.DataService.setQueryField('chartOfAccounts_glCode',cCode);
				PageManager.DataService.callDataService('chartOfAccountFullDetails');
				var header = document.getElementById('screenheader');
				header.innerHTML = "Chart Of Accounts-Modify";
				document.getElementById('chartOfAccounts_glCode').value =cCode;

			}
			else if(pageMode == "modifyAll"){
				//document.chartOfAccounts.chartOfAccounts_glCode.readOnly = true;
				document.getElementById('chartOfAccounts_glCode2').removeAttribute('exilMustEnter');
			//	document.chartOfAccounts.chartOfAccounts_glCode2.readOnly = true;
				document.getElementById('chartOfAccounts_glCode2').style.visibility='hidden';
				PageManager.DataService.setQueryField('chartOfAccounts_glCode',cCode);
				PageManager.DataService.callDataService('chartOfAccountFullDetails');
				var header = document.getElementById('screenheader');
				header.innerHTML = "Chart Of Accounts-Modify";
				document.getElementById('chartOfAccounts_glCode').value =cCode;
			} else if(pageMode == "insert"){
				var header = document.getElementById('screenheader');
				header.innerHTML = "Chart Of Accounts-New";
				PageManager.DataService.setQueryField('glCode',cCode);
				PageManager.DataService.setQueryField('chartOfAccounts_glCode',cCode);
				PageManager.DataService.callDataService('chartOfAccountAddChild');

			}
		}

	 	function afterRefreshPage(dc){

		 			var active = document.getElementById('isActiveForPosting').value;
				if(active == "1"){
					var activefor = document.getElementById('coa_isActiveForPosting');
					activefor.checked = true;
				}else document.getElementById('coa_isActiveForPosting').checked=false;
			if(dc.values['serviceID']=="chartOfAccountFullDetails")
				{
					if(dc.values['chartOfAccounts_funcReqd'])
					{
						var val=dc.values['chartOfAccounts_funcReqd'];
						if(val == "Yes"){
						var activefor = document.getElementById('chartOfAccounts_funcReqd');
						activefor.checked = true;
						}
					}

					if(dc.values['budgetCheckReqd'])
					{
						var val=dc.values['budgetCheckReqd'];
						if(val == "Yes"){
						var activeforBudgetCheck = document.getElementById('budgetCheckReqd');
						activeforBudgetCheck .checked = true;
						}
					}

					var val1=dc.values['chartOfAccounts_accTypeId']
					if(val1 != "0")
					{
					 document.getElementById('chartOfAccounts_accType1').value=val1;
					}

				}
				if(dc.values['serviceID']=="chartOfAccountAddChild")
				{
					if(cCode.length >= parseInt(dc.values['minorValue']))
					{
							document.getElementById('chartOfAccounts_glCode2').value = dc.values['zeroFill'];
					}

				}

		}


		function show_typ()
		{
		   var typeobj=document.getElementById("chartOfAccounts_type").value;
		   if(typeobj=='A'||typeobj=='E'||typeobj=='I'||typeobj=='L')
		   { }
		  else{
		        alert("Its an invalid Type. It can be any one of 'A', 'E', 'I', 'L'");
		        return false;
			   }
		}

function getid(obj){
	var idText=obj.value;
	id=idText.split('|');
	var a=document.getElementById("chartOfAccounts_classification");
	a.options[a.selectedIndex].text=id;
}

function beforRefreshPage(dc){


}

function onClickClose()
{
	window.close();
	/*if(fromScreen == "detailCodeEnquiry")
	{
		window.close();
	}
	else
	window.location = "Home.htm";
	*/
}

function filterSplKeys(e)
	{
		//alert(e.keyCode);
		if( (e.keyCode>=48 && e.keyCode<=58 )|| (e.keyCode>=97 && e.keyCode<=122)||(e.keyCode>=65 && e.keyCode<=90 )||
			e.keyCode==8 || e.keyCode==127 ||( e.keyCode>=44 && e.keyCode<=47)|| e.keyCode==40 || e.keyCode==41 || e.keyCode==32)
			return true;
		else
		 	return false;
	}

	 	</SCRIPT>
	</head>
	<body bgcolor="#ffffff"  onKeyDown ="CloseWindow(event);" bottommargin="0" topmargin="0" rightmargin="0" leftmargin="0" marginheight="0" marginwidth="0" onload="getData();"><!------------------ Header Begins --------------------->
		<form name = "chartOfAccounts">
			<input type="hidden" name="egUser_id" id="egUser_id">
			<input type  = "hidden"       name = "isActiveForPosting"            id = "isActiveForPosting" >
			<input type  = "hidden"       name = "chartOfAccounts_ID"            id = "chartOfAccounts_ID" >
			<input type  = "hidden"       name = "chartOfAccounts_lastModified"  id = "chartOfAccounts_lastModified" >
			<input type  = "hidden"       name = "chartOfAccountDetail_glCodeID" id = "chartOfAccountDetail_glCodeID" >
			<input type = "hidden"        name = "chartOfAccounts_majorHead2"    id = "chartOfAccounts_majorHead2" >
			<input type = "hidden"        name = "chartOfAccounts_levelNumber"   id = "chartOfAccounts_levelNumber" >
			<input type = "hidden"		  name = "chartOfAccounts_parentID"      id="chartOfAccounts_parentID">
			<input type = "hidden"		  name = "modGlCode"                     id="modGlCode">
			<input type="hidden"          name = "chartOfAccounts_group"         id = "chartOfAccounts_group" >
			<input type="hidden" name="actionId" id="actionId">
			<table width="100%" border="0" cellpadding="0" cellspacing="0">
				<tr>
					<td valign="top" class="normaltext"><!------------Content begins here ------------------>
						<table width="100%" border="0" cellpadding="3" cellspacing="0">
							<TBODY>
	
				<tr>
					<td ><div align="right" valign="center" class="" width="822"> &nbsp;</div>
					</td>


				</tr>
			</table>
			<table width = "101.30%" border=0 cellpadding="6" cellspacing="0">
					<tr>
						<td valign="top"><!------------Content begins here ------------------>
							<table width="100%" border=0 cellpadding="3" cellspacing="0">
								<tr class="tableheader" id='screenheaderrow' name='screenheaderrow'>
								    <td valign = "center" colspan = "2" width = "100%">
										<span  name = "screenheader" id = "screenheader"></span></td>
									<td  valign = "center" colspan = "1"><td class="tableHeader" colspan="1" valign="center" align="right"><a onclick="newWindow('../HelpAssistance/ChartofAccountshelp.htm')" ><IMG height=19  src="../images/help.gif"  ></a></td></td>
								</tr>														
								<tr  >
								    <td width = "25%" align="right"><div   align="right" valign="middle"  class="labelcell">Account Code<SPAN class=leadon>*</SPAN> </div></td>
									<td><span class="fieldcell">
									<input tabindex="1" name="chartOfAccounts_glCode"  readOnly class = "fieldinput" id="chartOfAccounts_glCode" exilMustEnter="true" exilDataType="exilAlphaNumeric" style="width:123; height:20"><input name="chartOfAccounts_glCode2"  class = "dtlfieldinput" id="chartOfAccounts_glCode2" exilMustEnter="true" exilDataType="exilAlphaNumeric" style="width:25"></span></td>
									<td width = "25%" align="right"><div   align="right" valign="middle"  class="labelcell">Name<span class="leadon">*</span></div></td>
	    		     				<td width = "25%" ><span class="fieldcell"><input tabindex="2" name="chartOfAccounts_name" class="fieldinput" id="chartOfAccounts_name" maxlength="150" exilMustEnter="true" exilDataType="exilAnyChar" onkeypress="return filterSplKeys(event)"></span></td>
								</tr>
								<tr  align="right">
									<td ><div       align="right" valign="middle"        class="labelcell">Alternate Name</div></td>
									<td align=left><div class="fieldcell"><input     name="chartOfAccounts_alternateName" class="fieldinput" id="chartOfAccounts_alternateName" maxlength="150" exilDataType="exilAnyChar" onkeypress="return filterSplKeys(event)"></div></td>
									<td width = "25%"><div       align="right" valign="middle"        class="labelcell">Description</div></td>
									<td width = "25%" align=left><TEXTAREA class=narrationfieldinput id=chartOfAccounts_description name=chartOfAccounts_description exilDataType="exilAnyChar"></TEXTAREA></td>
		    					</tr>
    							<tr >
								    <td width = "25%" align="right"><div   align="right" valign="middle"    class = "labelcell">Parent Account<span class="leadon">*</span></div></td>
									<td width = "25%"><span class="fieldcell"><input name="chartOfAccounts_majorHead" class = "fieldinput" id="chartOfAccounts_majorHead" readonly onmouseover="this.title=this.value" exilDataType="exilAnyChar"></span></td>
									<td width = "25%" align="right"><div   align="right" valign="middle" class="labelcell">ActiveForPosting</div></td>
	    		     				<td width = "25%"><input type="checkbox" name="coa_isActiveForPosting" id="coa_isActiveForPosting" checked></td>
								</tr>
								<tr  id="classificationrow" name="classificationrow">

								<td align="right" valign="center" width="25%"><div align="right" class="labelcell">Type</div></td>
							    <td width="25%"><span class="fieldcell"><input name="chartOfAccounts_type" class = "fieldinput" id="chartOfAccounts_type" readonly exilDataType="exilAnyChar" onBlur="show_typ()"></span></td>
								<td width="25%" align="right"><div class="labelcell">Classification<SPAN class=leadon>*</SPAN></div></td>
            					<td width="25%"><span class="smallfieldcell"><select id="chartOfAccounts_classification" name="chartOfAccounts_classification" class="fieldinput" onChange="getid(this)">
              								<option></option>
              								<option value="1">1|Major code</option>
              								<option value="2">2|Minor code</option>
              								<option value="3">3|Sub Minor Code</option>
              								<option value="4">4|Detail Code</option>
          								</select></span></td>
								</tr>

								<tr  >

								<td align="right" valign="center" width="25%"><div align="right" class="labelcell">Purpose</div></td>
							    <td width = "25%"><span class="smallfieldcell"><select     name="chartOfAccounts_purpose" class="fieldinput" id="chartOfAccounts_purpose" maxlength="3" exilListSource="acct_purpose" exilDataType="exilUnsignedInt"  /></span></td>
								<td width = "25%" align="right"><div   align="right" valign="middle" class="labelcell">Function Required</div></td>
	    		     			<td width = "25%"><input type="checkbox" name="chartOfAccounts_funcReqd" id="chartOfAccounts_funcReqd"></td>

								</tr>

								<tr  >

								<td align="right" valign="center" width="25%"><div align="right" class="labelcell">Account Detail Type</div></td>
							    <td width="25%"><span class="smallfieldcell"><select id="chartOfAccounts_accType1"  class="fieldinput" name="chartOfAccounts_accType1"  exilListSource="acct_type"></SELECT></span></td>
								<td width = "25%" align="right"><div   align="right" valign="middle" class="labelcell" name="budgetCheckReqd_Id" id="budgetCheckReqd_Id">Budget Check Required</div></td>
	    		     			<td width = "25%"><input type="checkbox" name="budgetCheckReqd" id="budgetCheckReqd" value="ON"></td>

								</tr>


								<tr  >
        		                	<td  colspan=4>&nbsp;</td>
                		        </tr>
						</table>
						<table width="100%"  border="0" cellpadding="0" cellspacing="0">
        		           	<tr><td></td></tr>
							<tr >
								<td height="25" colspan="4" valign="bottom" class="smalltext"><p class="smalltext"><span class="leadon">*</span> - Mandatory Fields</p></td>
							</tr><!--  Buttons for Request Form starts here -->
							<tr >
								<td colspan="4" align="middle"><!-- Buttons Start Here -->
									<table border="0" cellpadding="0" cellspacing="0"  align="center">
										 <tr>
										 <td>
										 <input  type="button" class="button" value="Submit" onclick="ButtonPress('saveclose');"/>
										 <input   type="button" class="button" value="Cancel" onclick="onClickCancel()" />
										 <input   type="button" class="button" value="Close" onclick=onClickClose(); />
										 </td>
									</tr></table><!-- Buttons End Here -->
								</td>
								</tr>
							</table><!------------ Content ends here ------------------>
						</td>
					</tr>
			  	</table></TD><!------------Right Navigation Ends here------------------></TR></TABLE><!---------------- Footer begins here ----------><!---------------- Footer ends here ---------->
		</form>
	</body>
</html>
