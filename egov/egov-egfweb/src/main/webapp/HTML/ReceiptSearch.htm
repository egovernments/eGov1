#-------------------------------------------------------------------------------
# eGov suite of products aim to improve the internal efficiency,transparency, 
#      accountability and the service delivery of the government  organizations.
#   
#       Copyright (C) <2015>  eGovernments Foundation
#   
#       The updated version of eGov suite of products as by eGovernments Foundation 
#       is available at http://www.egovernments.org
#   
#       This program is free software: you can redistribute it and/or modify
#       it under the terms of the GNU General Public License as published by
#       the Free Software Foundation, either version 3 of the License, or
#       any later version.
#   
#       This program is distributed in the hope that it will be useful,
#       but WITHOUT ANY WARRANTY; without even the implied warranty of
#       MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#       GNU General Public License for more details.
#   
#       You should have received a copy of the GNU General Public License
#       along with this program. If not, see http://www.gnu.org/licenses/ or 
#       http://www.gnu.org/licenses/gpl.html .
#   
#       In addition to the terms of the GPL license to be adhered to in using this
#       program, the following additional terms are to be complied with:
#   
#   	1) All versions of this program, verbatim or modified must carry this 
#   	   Legal Notice.
#   
#   	2) Any misrepresentation of the origin of the material is prohibited. It 
#   	   is required that all modified versions of this material be marked in 
#   	   reasonable ways as different from the original version.
#   
#   	3) This license does not grant any rights to any user of the program 
#   	   with regards to rights under trademark law for use of the trade names 
#   	   or trademarks of eGovernments Foundation.
#   
#     In case of any queries, you can reach eGovernments Foundation at contact@egovernments.org.
#-------------------------------------------------------------------------------
<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<SCRIPT LANGUAGE="javascript">
var cWind;         // temporary window reference
var count=1;      // Counter which gives number of child windows opened
var cWindows=new Object();    //HashMap where we store child window
var mode="";
function onloadTasks()
		 {
			 PageValidator.addCalendars();
			 document.getElementById('receiptType').focus();

			var b=document.getElementById('receiptMode');
			var c=document.getElementById('titleMode');
			var a=document.getElementById('receiptType');
			var data=a.options[a.selectedIndex].text;
			if(data!='Property Tax' || data!='Other Tax'){
				b.style.visibility='hidden';
				c.style.visibility='hidden';
			}
			/* added by siddhu*/
			var tabRow=document.getElementById('mainTable');
			//document.getElementById('fundList').style.display="none";
			//tabRow.rows[2].style.display="none";
			PageManager.ListService.callListService();
			mode = PageManager.DataService.getQueryField('showMode');
	// added by iliyaraja
			PageManager.DataService.callDataService('finYearDate');

		 }
function ModeChange(){
	document.getElementById('fundList').style.display="block";

	/*Added by siddhu*/
	var tabRow=document.getElementById('mainTable');
	var a=document.getElementById('receiptType');
	var b=document.getElementById('receiptMode');
	var c=document.getElementById('titleMode');
	var table=document.getElementById('searchDetailGrid');
		table.style.display="none";
	for(var i=b.childNodes.length-1; i>=0; i--) b.removeChild(b.childNodes[i]);

	 var data=a.options[a.selectedIndex].text;
	if(data=="Property Tax")	{
		b.style.visibility='visible';
		c.style.visibility='visible';
		var opt1=document.createElement('option');
		opt1.innerHTML="All";
		b.appendChild(opt1);

		var opt2=document.createElement('option');
		opt2.innerHTML="Field"
		b.appendChild(opt2);
		var opt3=document.createElement('option');
		opt3.innerHTML="Office"
		b.appendChild(opt3);
		var opt4=document.createElement('option');
		opt4.innerHTML="Bank"
		b.appendChild(opt4);
	/* added by siddhu */
	tabRow.rows[2].style.display="block";
}
	else if(data=="Other Tax")
	{
		b.style.visibility='visible';
		c.style.visibility='visible';

		for(var i=b.childNodes.length-1; i>=0; i--) b.removeChild(b.childNodes[i]);

		var opt1=document.createElement('option');
		opt1.innerHTML="All";
		b.appendChild(opt1);
		var opt2=document.createElement('option');
		opt2.innerHTML="Field"
		b.appendChild(opt2);
		var opt3=document.createElement('option');
		opt3.innerHTML="Office"
		b.appendChild(opt3);
		tabRow.rows[2].style.display="block";
	}
	else if(data=="Other receipts" || data=="Bank Entries")
	{
		b.style.visibility='hidden';
		c.style.visibility='hidden';
		//tabRow.rows[2].style.display="none";

	}
	else
	{
		b.style.visibility='hidden';
		c.style.visibility='hidden';
		//tabRow.rows[2].style.display="none";

	}

}
function ButtonPress(){

	if(!PageValidator.validateForm())	return false;
	/*added by siddhu*/
	var wardList=document.getElementById("wardList");
	var wardId;
	if(wardList.selectedIndex!=-1){
		wardId=wardList.options[wardList.selectedIndex].value;
	}
	/*end*/
	PageManager.DataService.removeQueryField('receiptType');
	PageManager.DataService.removeQueryField('receiptMode');
	PageManager.DataService.removeQueryField('voucherNumberFrom');
	//PageManager.DataService.removeQueryField('voucherNumberTo');
	PageManager.DataService.removeQueryField('voucherDateFrom');
	PageManager.DataService.removeQueryField('voucherDateTo');
	PageManager.DataService.removeQueryField('fundID');
	PageManager.DataService.removeQueryField('wardid');
	var recepType=document.getElementById('receiptType').value;
	var a=document.getElementById('receiptMode');

	var recepMode;
	if(recepType=="Property Tax" || recepType=="Other Tax")
	{
		if(wardId && wardId.length>0){
			PageManager.DataService.setQueryField('wardid',wardId);

		}

		if(a && a.length!=0)
		{
			recepMode=a.options[a.selectedIndex].text;
			if(recepMode!='All')
				PageManager.DataService.setQueryField('receiptMode',recepMode);
		}
	}

	if(recepType.length!=0 && recepType!="All")
		PageManager.DataService.setQueryField('receiptType',recepType);

		var	voucherDateFrom=document.getElementById('voucherDateFrom').value;
		if(voucherDateFrom && voucherDateFrom.length!=0)
			PageManager.DataService.setQueryField('voucherDateFrom',formatDate1(voucherDateFrom));

		var	voucherDateTo=document.getElementById('voucherDateTo').value;
		if(voucherDateTo && voucherDateTo.length!=0)
			PageManager.DataService.setQueryField('voucherDateTo',formatDate1(voucherDateTo));

		var voucherNumberFrom=document.getElementById('voucherNumberFrom').value;
		if(voucherNumberFrom && voucherNumberFrom.length!=0)
		{
			PageManager.DataService.setQueryField('voucherNumberFrom',voucherNumberFrom);
		//	PageManager.DataService.setQueryField('voucherNumberTo',voucherNumberFrom);
		}

		var fundObj=document.getElementById('fundList');
		var fundID=fundObj.options[fundObj.selectedIndex].value;
		if(fundID&& fundID.length!=0)
			PageManager.DataService.setQueryField('fundID',fundID);



		/* if(voucherNumberFrom && voucherNumberFrom.length!=0 && voucherNumberTo && voucherNumberTo.length!=0){
			if(voucherNumberFrom.toLowerCase()>voucherNumberTo.toLowerCase()){
				alert('voucherNumberFrom And voucherNumberTo field must be Decreasing Order of Alphanumerics');
				return false;
				}
			}*/
			if( compareDate(formatDate6(voucherDateFrom),formatDate6(voucherDateTo)) == -1 ){
				alert('Start Date cannot be greater than End Date');
				document.getElementById('voucherDateFrom').focus();
				return false;
			}

		if(mode=="modify" )
		{
			var num=0;
			PageManager.DataService.setQueryField('statusNum',num);
			PageManager.DataService.callDataService('receiptSearchNew');
		}
		else if( mode=="edit")
		{
					var num=0;
					PageManager.DataService.setQueryField('statusNum',num);
					PageManager.DataService.callDataService('receiptSearchNewModify');
		}
		else
		PageManager.DataService.callDataService('receiptSearch');
		var table=document.getElementById('searchDetailGrid');
			table.style.display="block";


}

function beforeRefreshPage(dc){
		if(dc.values['serviceID']=='finYearDate')
		{
		var dt=dc.values['startFinDate']
		dt=formatDate2(dt);
		document.getElementById('voucherDateFrom').value=dt;
		}
		var tabObj=dc.grids['searchDetailGrid'];
		if(!tabObj)		return false;
		if(tabObj.length<2){
			alert("No Data");
		}
		for(var i=1;i<tabObj.length;i++){
				tabObj[i][2]=formatDate(tabObj[i][2]);
		}

		return true;
}
/*function formatDate(dateText){
	dateText=dateText.substring(0,10);
	var dateArray= dateText.split('-');
	var newDate=dateArray[2]+"-"+dateArray[1]+"-"+dateArray[0];
	return newDate;
}*/


function changeColor(){
	var table=document.getElementById('searchDetailGrid');
		for(var i=1;i<table.rows.length;i++)
		{
			var statusObj=PageManager.DataService.getControlInBranch(table.rows[i],"VoucherStatus");
			var status=statusObj.innerHTML;
			if(status=='Reversed')
			{
				var trObj=PageManager.DataService.getRow(statusObj);
				trObj.className='rowRev';

				}
			else if(status=='Reversal')
			{
				var trObj=PageManager.DataService.getRow(statusObj);
				trObj.className='rowRev2';

			}
			else
			{
				var trObj=PageManager.DataService.getRow(statusObj);
				trObj.className='normaltext';

			}
		}
}

function hideRepeatedItem(obj) //hiding repeated items in the list
{
	selectedIndx=null;
	try{
		for(var i=0;i<obj.length;i++)
		{
			for(var j=0;j<obj.length;j++)
			{
				if(obj.options[i].text == obj.options[obj.selectedIndex].text)
					selectedIndx=i;
				if(i!=j && obj.options[i].text == obj.options[j].text)
					obj.remove(j);
			}
		}
	   }catch(err) {}
	   obj.selectedIndex=selectedIndx;
}
function afterRefreshPage(dc)
{
	//hiding repeated item in the list
	var obj = document.getElementById('receiptMode');
	if((dc.values['serviceID'] == 'receiptSearchNewModify' && dc.values['showMode'] == 'edit') ||
		(dc.values['serviceID'] == 'receiptSearchNew' && dc.values['showMode'] == 'modify') )
		hideRepeatedItem(obj);


	addSlNo();
	changeColor();
	var voucherDateFrom=document.getElementById('voucherDateFrom').value;
			var voucherDateTo=document.getElementById('voucherDateTo').value;
			if(voucherDateFrom && voucherDateFrom.length!=0)
					{
					var VouDateFrom=dc.values['voucherDateFrom'];
					//alert("VouDateFrom"+formatDateToDDMMYYYY5(VouDateFrom)+" VouDateTo"+formatDateToDDMMYYYY5(VouDateTo));
					VouDateFrom=formatDateToDDMMYYYY5(VouDateFrom);
					document.getElementById('voucherDateFrom').value=VouDateFrom;
					}

				if(voucherDateTo && voucherDateTo.length!=0)
				{
					var VouDateTo=dc.values['voucherDateTo'];
					VouDateTo=formatDateToDDMMYYYY5(VouDateTo);
					document.getElementById('voucherDateTo').value=VouDateTo;
				}
	hideColumn(1);
	return true;
}
function addSlNo(){
	var slNo=1;
	var tabObj=document.getElementById("searchDetailGrid");
	for(var i=1;i<tabObj.rows.length;i++){
	var obj=PageManager.DataService.getControlInBranch(tabObj.rows[i],"slNo");
	obj.innerHTML=slNo;
	slNo++;
	}
}

function getDetails(obj){
	var row=PageManager.DataService.getRow(obj);
	var table=document.getElementById('searchDetailGrid');
	var cgn1=PageManager.DataService.getControlInBranch(table.rows[row.rowIndex],"cgNumber");
	cgn1=cgn1.innerHTML;
	var cgn2=cgn1.substring(0,3);
    var status1=PageManager.DataService.getControlInBranch(table.rows[row.rowIndex],'VoucherStatus');
    status1=status1.innerHTML;
	switch(cgn2){
	case 'MSR':
	//window.location="MiscReceipt.htm?cgNumber="+cgn1+"&showMode="+mode;
	//cWind=window.open("MiscReceipt.htm?cgNumber="+cgn1+"&showMode="+mode,"","height=650,width=900,scrollbars=yes,left=20,top=20,status=yes");
	if(status1=='Reversal')
				{

					cWind=window.open("VMC/JV_General_VMC.jsp?cgNumber="+cgn1+"&showMode="+mode,"","height=650,width=900,scrollbars=yes,left=20,top=20,status=yes");

				}
			else
				{
					cWind=window.open("VMC/miscReceipt_VMC.jsp?cgNumber="+cgn1+"&showMode="+mode,"","height=650,width=900,scrollbars=yes,left=20,top=20,status=yes");
	            }

	//cWind=window.open("VMC/miscReceipt_VMC.jsp?cgNumber="+cgn1+"&showMode="+mode,"","height=650,width=900,scrollbars=yes,left=20,top=20,status=yes");
	cWindows[count++]=cWind;
	break;
	case 'PRB' :
	case 'PRO' :
	case 'PRF' :
	//window.location="PT_Field.htm?cgNumber="+cgn1+"&showMode="+mode;
	if(status1=='Reversal')
			{
				cWind=window.open("VMC/JV_General_VMC.jsp?cgNumber="+cgn1+"&showMode="+mode,"","height=650,width=900,scrollbars=yes,left=20,top=20,status=yes");

			}
			else
			{
			    cWind=window.open("PT_Field.htm?cgNumber="+cgn1+"&showMode="+mode,"","height=650,width=900,scrollbars=yes,left=20,top=20,status=yes");
	        }

	//cWind=window.open("PT_Field.htm?cgNumber="+cgn1+"&showMode="+mode,"","height=650,width=900,scrollbars=yes,left=20,top=20,status=yes");
	cWindows[count++]=cWind;
	break;
	case 'OTF':
	//window.location="OT_Field.htm?cgNumber="+cgn1+"&showMode="+mode;
	if(status1=='Reversal')
			{
			  cWind=window.open("VMC/JV_General_VMC.jsp?cgNumber="+cgn1+"&showMode="+mode,"","height=650,width=900,scrollbars=yes,left=20,top=20,status=yes");
		       				}
			else
			{
		        cWind=window.open("OT_Field.htm?cgNumber="+cgn1+"&showMode="+mode,"","height=650,width=900,scrollbars=yes,left=20,top=20,status=yes");
	          }

	//cWind=window.open("OT_Field.htm?cgNumber="+cgn1+"&showMode="+mode,"","height=650,width=900,scrollbars=yes,left=20,top=20,status=yes");
	cWindows[count++]=cWind;
	break;
	case 'OTO':
	//window.location="OT_Office.htm?cgNumber="+cgn1+"&showMode="+mode;
	if(status1=='Reversal')
			{
							cWind=window.open("VMC/JV_General_VMC.jsp?cgNumber="+cgn1+"&showMode="+mode,"","height=650,width=900,scrollbars=yes,left=20,top=20,status=yes");
			}
			else
			{

		cWind=window.open("OT_Office.htm?cgNumber="+cgn1+"&showMode="+mode,"","height=650,width=900,scrollbars=yes,left=20,top=20,status=yes");
	}

	//cWind=window.open("OT_Office.htm?cgNumber="+cgn1+"&showMode="+mode,"","height=650,width=900,scrollbars=yes,left=20,top=20,status=yes");
	cWindows[count++]=cWind;
	break;
	}
}
function hideColumn(index){
	var table=document.getElementById('searchDetailGrid');
   	for(var i=0;i<table.rows.length;i++){
		table.rows[i].cells[index].style.display="none";
   	}
}
function chkMode()
{
   var mode=PageManager.DataService.getQueryField('showMode');
   if(mode.toLowerCase()=="view")
     newWindow('../HelpAssistance/View Receipts.htm')
   else if(mode.toLowerCase()=="modify")
     newWindow('../HelpAssistance/Reverse Receipts.htm')
}
</script>
</head>
<body bgcolor="#ffffff" bottommargin="0" topmargin="0" rightmargin="0" leftmargin="0" marginheight="0" marginwidth="0" onLoad="onloadTasks()" onbeforeunload="closeChilds(cWindows,count)" >
<!-- table><tr><td><div id="main"><div id="m2"><div id="m3" -->
<form name="journalVoucher">
<input type="hidden" name="startFinDate" id="startFinDate">

<table width="100%" border=0 cellpadding="3" cellspacing="0" id="mainTable">
	<tr >
		<td align="right" valign="center" width="25%"><div class="labelcell">Receipt Type</div></td>
		<td  width="25%" align="left"><span class="smallfieldcell">
			<select class="fieldcell" name="receiptType" id="receiptType"  width="20" onChange="ModeChange()";>
			<option value="">All</option>
			<option value="Property Tax">Property Tax</option>
			<option value="Other Tax">Other Tax</option>
			<option value="Other receipts">Other receipts</option>
			<option value="Bank Entry">Bank Entry</option>
			</select></span>
		</td>
		<td align="right" valign="center"  width="25%"><div  class=labelcell align="right" name="titleMode" id="titleMode">Receipt Mode</div></td>
		<td ><span class="smallfieldcell">
		<select class="fieldcell" name="receiptMode" id="receiptMode">
		</select></span>
		</td>
	</tr>
	<tr   style="display:none">
		<td align="right" valign="center"  width="25%"><div class="labelcell" align="right">Ward</div></td>
		<td  width="25%" ><span class="smallfieldcell">
			<select class="fieldinput" name="wardList" id="wardList"  width="20" exilListSource="billCollectorDetail_wardId">
			</select></span>
		</td>
		<td class="" width="25%">	&nbsp;	</td>
		<td class="" width="25%">	&nbsp;	</td>
	</tr>

	<tr >
		<td align="right" valign="center" ><div class="labelcell" align="right">Voucher Number </div></td>
		<td ><span class="fieldcell">
			<input class="fieldinput" name="voucherNumberFrom" id="voucherNumberFrom" exilDataType="exilAnyChar" size=20></span>
		</td>
		<td align="right" valign="center" width="25%"><div class="labelcell" align="right">Fund</div></td>
		<td  width="25%" ><span class="smallfieldcell">
			<select class="fieldinput" name="fundList" id="fundList"  width="20" exilListSource="fundNameList" >
			</select></span>
		</td>
	</tr>
	<tr >
		<td align="right" valign="center" ><div class="labelcell" align="right">Voucher Date From</div></td>
		<td ><span class="smallfieldcell">
			<input class=""  name="voucherDateFrom"  id="voucherDateFrom" onkeyup="DateFormat(this,this.value,event,false,'3')"  exilCalendar="true" size=20></span>
		</td>
		<td align="right" valign="center" ><div class="labelcell" align="right">To</div></td>
		<td ><span class="smallfieldcell">
			<input class="" name="voucherDateTo"  id="voucherDateTo" onkeyup="DateFormat(this,this.value,event,false,'3')"  exilCalendar="true" size=20></span>
		</td>
	</tr>
	<tr >
		<td colspan="4" align="middle">
			<table border="0" cellpadding="0" cellspacing="0" >
				<tr>
					<td ><input  type="button" class="button" value="Search" onclick="ButtonPress();"/><td>
				</tr>
			</table>
		</td>
	</tr>
</table>
<table  align="center"	 width="100%" border="1" cellpadding="0" cellspacing="0" name="searchDetailGrid" id="searchDetailGrid" style="DISPLAY:none">
	<tr class="thStlyle">
		<td width="5%" height="34" class=""><div align="center" class="">Sl No</div></td>
		<td width="15%" class=""><div align="center">CG Number</div></td>
		<td width="12%" class=""><div align="center">Date</div></td>
		<td width="20%" class=""><div align="center">Voucher Number</div></td>
		<td width="20%" class=""><div align="center">Amount</div></td>
		<td width="20%" class=""><div align="center">Mode of&nbsp; Collection</div></td>
		<td width="10%" class=""><div align="center">Status</div></td>

	 </tr>

	<tr class="smallfieldcell">
		<td>
		<div  align=center class="labelcell" id="slNo" name="slNo" exilTrimLength="8" style="width:50px; height: 22px">&nbsp;</div></td>
		<td><div class="labelcell" id="cgNumber" name="cgNumber"  exilTrimLength="10">&nbsp;</div></td>
		<td><div class="labelcell"  style="width=75px" id="voucherDate" name="voucherDate">&nbsp;</div></td>
		<td><A class=labelcell onClick="getDetails(this)" href="#" style="width=100px"><div id="voucherNumber" name="voucherNumber" exilTrimLength="15">&nbsp;</div></A></td>
		<td align=right ><div class=labelcell id="amount" name="amount" exilTrimLength="16" style="width=100px">&nbsp;</div></td>
		<td><div class="labelcell" id="modeOfCollection" name="modeOfCollection" exilTrimLength="10">&nbsp;</div></td>
		<td><div class="labelcell" id="VoucherStatus" name="VoucherStatus" exilTrimLength="15">&nbsp;</div></td>
	</tr>
</table>
</form>
<!-- /div></div></div></td></tr></table -->
</body>
</html>
