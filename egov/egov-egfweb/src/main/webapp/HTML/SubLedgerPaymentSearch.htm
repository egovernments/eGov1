#-------------------------------------------------------------------------------
# eGov suite of products aim to improve the internal efficiency,transparency, 
#      accountability and the service delivery of the government  organizations.
#   
#       Copyright (C) <2015>  eGovernments Foundation
#   
#       The updated version of eGov suite of products as by eGovernments Foundation 
#       is available at http://www.egovernments.org
#   
#       This program is free software: you can redistribute it and/or modify
#       it under the terms of the GNU General Public License as published by
#       the Free Software Foundation, either version 3 of the License, or
#       any later version.
#   
#       This program is distributed in the hope that it will be useful,
#       but WITHOUT ANY WARRANTY; without even the implied warranty of
#       MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#       GNU General Public License for more details.
#   
#       You should have received a copy of the GNU General Public License
#       along with this program. If not, see http://www.gnu.org/licenses/ or 
#       http://www.gnu.org/licenses/gpl.html .
#   
#       In addition to the terms of the GPL license to be adhered to in using this
#       program, the following additional terms are to be complied with:
#   
#   	1) All versions of this program, verbatim or modified must carry this 
#   	   Legal Notice.
#   
#   	2) Any misrepresentation of the origin of the material is prohibited. It 
#   	   is required that all modified versions of this material be marked in 
#   	   reasonable ways as different from the original version.
#   
#   	3) This license does not grant any rights to any user of the program 
#   	   with regards to rights under trademark law for use of the trade names 
#   	   or trademarks of eGovernments Foundation.
#   
#     In case of any queries, you can reach eGovernments Foundation at contact@egovernments.org.
#-------------------------------------------------------------------------------
<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta http-equiv="KEYWORDS" content="">
<meta http-equiv="DESCRIPTION" content="">
<!-- Inclusion of the CSS files that contains the styles -->
<link rel=stylesheet href="../exility/global.css" type="text/css">
<SCRIPT LANGUAGE="javascript" SRC="../exility/PageValidator.js"></SCRIPT>
<SCRIPT LANGUAGE="javascript" SRC="../exility/PageManager.js"></SCRIPT>
<SCRIPT LANGUAGE="javascript" SRC="../exility/ExilityParameters.js"></SCRIPT>
<SCRIPT LANGUAGE="javascript" SRC="../script/PaymentSearchFunc.js.htm"></SCRIPT>
<SCRIPT LANGUAGE="javascript" SRC="../script/jsCommonMethods.js"></Script>
  <SCRIPT type="text/javascript" src="../script/calendar.js" type="text/javascript" ></SCRIPT>
<SCRIPT LANGUAGE="javascript">
var cWind;         // temporary window reference
var count=1;      // Counter which gives number of child windows opened
var cWindows=new Object();    //HashMap where we store child window
var mode="";
var paymentType="";
function ButtonPress()
{
		if(PageValidator.validateForm())
		{
			PageManager.DataService.removeQueryField('payType');
			PageManager.DataService.removeQueryField('voucherNumber');
			PageManager.DataService.removeQueryField('fundID');
			PageManager.DataService.removeQueryField('voucherDateFrom');
			PageManager.DataService.removeQueryField('voucherDateTo');
			hideColumn(1);
			var type=null;
			var typeObj=document.getElementById('paymentType');
			if(typeObj.selectedIndex==-1)return;
			type=typeObj.options[typeObj.selectedIndex].value;
			paymentType=type;

				var voucherNumber=document.getElementById('voucherNumber').value;
				if(voucherNumber && voucherNumber.length!=0)
					PageManager.DataService.setQueryField('voucherNumber',voucherNumber);

				var voucherDateFrom=document.getElementById('voucherDateFrom').value;
				if(voucherDateFrom && voucherDateFrom.length!=0)
					PageManager.DataService.setQueryField('voucherDateFrom',formatDate1(voucherDateFrom));

				var voucherDateTo=document.getElementById('voucherDateTo').value;
				if(voucherDateTo && voucherDateTo.length!=0)
				PageManager.DataService.setQueryField('voucherDateTo',formatDate1(voucherDateTo));

				var fundID=document.getElementById('fund').value;
				if(fundID&& fundID.length!=0)
					PageManager.DataService.setQueryField('fundID',fundID);


				if( compareDate(formatDate6(voucherDateFrom),formatDate6(voucherDateTo)) == -1 )
				{
					alert('Start Date cannot be greater than End Date');
					document.getElementById('voucherDateFrom').focus();
					return false;
				}
			if(type && (type=="Bank Payment"))
			{
				if(mode=="modify")
				{
				var stat=0;
				PageManager.DataService.setQueryField('reverseNum',stat);
				var con=1;
				PageManager.DataService.setQueryField('confirmNum',con);

				}
				if(mode=="edit")
				{
				var stat=0;
				PageManager.DataService.setQueryField('reverseNum',stat);
				var con=0;
				PageManager.DataService.setQueryField('confirmNum',con);
				}
				PageManager.DataService.setQueryField('payType','Direct Bank Payment');
				PageManager.DataService.callDataService('bankPaymentSearch');

			}
			if(type && (type=="Bank Entry"))
			{
				if(mode=="modify")
				{
				var stat=0;
				PageManager.DataService.setQueryField('reverseNum',stat);
				var con=1;
				PageManager.DataService.setQueryField('confirmNum',con);

				}
				if(mode=="edit")
				{
				var stat=0;
				PageManager.DataService.setQueryField('reverseNum',stat);
				var con=0;
				PageManager.DataService.setQueryField('confirmNum',con);
				}
				PageManager.DataService.setQueryField('payType','Direct Bank Payment');
				PageManager.DataService.callDataService('bankEntrySearch');

			}
			if(type && (type=="Cash Payment"))
			{
				if(mode=="modify")
				{
				var stat=0;
				PageManager.DataService.setQueryField('reverseNum',stat);
				var con=1;
				PageManager.DataService.setQueryField('confirmNum',con);
				}
				if(mode=="edit")
				{
				var stat=0;
				PageManager.DataService.setQueryField('reverseNum',stat);
				var con=0;
				PageManager.DataService.setQueryField('confirmNum',con);
				}
				PageManager.DataService.setQueryField('payType','Direct Cash Payment');
				PageManager.DataService.callDataService('cashPaymentSearch');

			}
			if(type && (type=="Advance"))
			{
				if(mode=="modify")
				{
				var stat=0;
				PageManager.DataService.setQueryField('reverseNum',stat);
				var con=1;
				PageManager.DataService.setQueryField('confirmNum',con);
				}
				if(mode=="edit")
				{
				var stat=0;
				PageManager.DataService.setQueryField('reverseNum',stat);
				var con=0;
				PageManager.DataService.setQueryField('confirmNum',con);
				}
				PageManager.DataService.setQueryField('payType','Advance');
				PageManager.DataService.callDataService('advancePaymentSearch');

			}
			if(type && (type=="Subledger Payment"))
			{
				if(mode=="modify")
				{
				var stat=0;
				PageManager.DataService.setQueryField('reverseNum',stat);
				var con=1;
				PageManager.DataService.setQueryField('confirmNum',con);
				}
				if(mode=="edit")
				{
				var stat=0;
				PageManager.DataService.setQueryField('reverseNum',stat);
				var con=0;
				PageManager.DataService.setQueryField('confirmNum',con);
				}
				PageManager.DataService.setQueryField('payType','Supplier');
				PageManager.DataService.setQueryField('payType1','Contractor');
				PageManager.DataService.callDataService('subledgerPaymentSearch');
			}

			if(type && (type=="Salary"))
			{
				if(mode=="modify")
				{
				var stat=0;
				PageManager.DataService.setQueryField('reverseNum',stat);
				var con=1;
				PageManager.DataService.setQueryField('confirmNum',con);
				}
				if(mode=="edit")
				{
				var stat=0;
				PageManager.DataService.setQueryField('reverseNum',stat);
				var con=0;
				PageManager.DataService.setQueryField('confirmNum',con);
				}
				PageManager.DataService.setQueryField('payType','Salary');
				PageManager.DataService.callDataService('salaryPaymentSearch');

			}
			var table=document.getElementById('paymentSearchGrid');
			table.style.display="block";
		 }
}
function ModeChangeGrid()
{
	showAllColumns();
	if(paymentType=="Bank Payment")
	{
		hideColumn(8);
		document.getElementById('cheNo').innerHTML="ChequeNo";
	}
	if(paymentType=="Bank Entry")
	{
		hideColumn(8);
		document.getElementById('cheNo').innerHTML="Ref No";
	}
	if(paymentType=="Cash Payment")
	{
		hideColumn(7);
		hideColumn(8);
		document.getElementById('cheNo').innerHTML="ChequeNo";
	}
	if(paymentType=="Advance")
	{
		hideColumn(4);
		hideColumn(5);
		hideColumn(6);
		document.getElementById('cheNo').innerHTML="ChequeNo";
	}
	if(paymentType=="Subledger Payment")
	{
		hideColumn(4);
		hideColumn(5);
		hideColumn(6);
		document.getElementById('cheNo').innerHTML="ChequeNo";
	}
	if(paymentType=="Salary")
	{
		hideColumn(4);
		hideColumn(5);
		hideColumn(6);
		document.getElementById('cheNo').innerHTML="ChequeNo";
	}

}
function onloadTasks(){
	PageValidator.addCalendars();
	mode = PageManager.DataService.getQueryField('showMode');
	PageManager.ListService.callListService();
	PageManager.DataService.callDataService('finYearDate');
}
function ModeChange(){
		showAllColumns();
		var table=document.getElementById('paymentSearchGrid');
		var controlArray=new Array('slNo','cgNumber','voucherDate','voucherNumber','paidTo','passedAmount','billAmount','chequeNumber','paidAmount','status');

		var len=table.rows.length;
 		for (var j=2;j<len;j=j+1)
 		{
   			table.deleteRow(1);

   		}
   		if(len<2) return;
   		for (var j=0;j<controlArray.length;j++)
		{
			var row=PageManager.DataService.getControlInBranch(table.rows[1],controlArray[j]);
			row.innerHTML="&nbsp;";
			var trObj=PageManager.DataService.getRow(row);
				trObj.className='normaltext';
		}
}
function hideColumn(index){
	var table=document.getElementById('paymentSearchGrid');
   	for(var i=0;i<table.rows.length;i++){
		table.rows[i].cells[index].style.display="none";
   	}
}

function showColumn(index){
	var table=document.getElementById('paymentSearchGrid');
   	for(var i=0;i<table.rows.length;i++){
   		table.rows[i].cells[index].style.display="block";
   	}
}
function showAllColumns(){
	var table=document.getElementById('paymentSearchGrid');
   	for(var i=0;i<table.rows.length;i++){
   		for(var j=0;j<table.rows[i].cells.length;j++){
			table.rows[i].cells[j].style.display="block";
		}
   	}
}

function beforeRefreshPage(dc){
		if(dc.values['serviceID']=='finYearDate')
		{
		var dt=dc.values['startFinDate']
		dt=formatDate2(dt);
		document.getElementById('voucherDateFrom').value=dt;
		}
		var tabObj=dc.grids['paymentSearchGrid'];
		if(!tabObj)	return false;
		if(tabObj.length<2){
			alert("No Data");

		}
		for(var i=1;i<tabObj.length;i++){

				tabObj[i][2]=formatDate(tabObj[i][2]);

			}

	return true;
}

//added by rashmi
function changeColor(){
		var table=document.getElementById('paymentSearchGrid');
		for(var i=1;i<table.rows.length;i++){
			var statusObj=PageManager.DataService.getControlInBranch(table.rows[i],"status");
 			var status=statusObj.innerHTML;
			if(status=='Reversed')
			{
				var trObj=PageManager.DataService.getRow(statusObj);
				trObj.className='rowRev';
			}
			else if(status=='Reversal')
			{
				var trObj=PageManager.DataService.getRow(statusObj);
				trObj.className='rowRev2';
			}
			else
			{
				var trObj=PageManager.DataService.getRow(statusObj);
				trObj.className='normaltext';
			}

  	 	}
}
function afterRefreshPage(dc){
	addSlNo();
	changeColor();
	var voucherDateFrom=document.getElementById('voucherDateFrom').value;
		var voucherDateTo=document.getElementById('voucherDateTo').value;
		if(voucherDateFrom && voucherDateFrom.length!=0)
		{
				var VouDateFrom=dc.values['voucherDateFrom'];
				VouDateFrom=formatDateToDDMMYYYY5(VouDateFrom);
				document.getElementById('voucherDateFrom').value=VouDateFrom;
		}
		if(voucherDateTo && voucherDateTo.length!=0)
		{
			var VouDateTo=dc.values['voucherDateTo'];
			VouDateTo=formatDateToDDMMYYYY5(VouDateTo);
			document.getElementById('voucherDateTo').value=VouDateTo;
	}
	ModeChangeGrid();


}
function addSlNo(){
	var slNo=1;
	var tabObj=document.getElementById("paymentSearchGrid");
	for(var i=1;i<tabObj.rows.length;i++){
	var obj=PageManager.DataService.getControlInBranch(tabObj.rows[i],"slNo");
	obj.innerHTML=slNo;
	slNo++;
	}
}

function getDetails(obj){
	var row=PageManager.DataService.getRow(obj);
	var table=document.getElementById('paymentSearchGrid');
	var cgn1=PageManager.DataService.getControlInBranch(table.rows[row.rowIndex],"cgNumber");
	cgn1=cgn1.innerHTML;
	//alert("cgn1-------"+cgn1);
	var cgn2=cgn1.substring(0,3);
	var typeObj=document.getElementById('paymentType');
	type=typeObj.options[typeObj.selectedIndex].value;

	mode = PageManager.DataService.getQueryField('showMode');
	switch(cgn2){
	case 'SPH':
		//window.location="SubLedgerPayment.htm?drillDownCgn="+cgn1+"&showMode="+mode;
		cWind=window.open("SubLedgerPayment.htm?drillDownCgn="+cgn1+"&showMode="+mode,"","height=650,width=900,scrollbars=yes,left=20,top=20,status=yes");
		cWindows[count++]=cWind;
		break;
	case 'SSP' :
		//window.location="SubledgerSalaryPayment.htm?drillDownCgn="+cgn1+"&showMode="+mode;
		cWind=window.open("SubledgerSalaryPayment.htm?drillDownCgn="+cgn1+"&showMode="+mode,"","height=650,width=900,scrollbars=yes,left=20,top=20,status=yes");
		cWindows[count++]=cWind;
		break;
	case 'ASP' :
		//window.location="AdvanceJournal.htm?drillDownCgn="+cgn1+"&showMode="+mode;
		cWind=window.open("AdvanceJournal.htm?drillDownCgn="+cgn1+"&showMode="+mode,"","height=650,width=900,scrollbars=yes,left=20,top=20,status=yes");
		cWindows[count++]=cWind;
		break;
	case 'DBP':
		if(mode=="view")
		mode="viewBank";
		if(mode=="modify")
		mode="reverseBank";
		//window.location="DirectBankPayment.htm?cgNumber="+cgn1+"&showMode="+mode;
		cWind=window.open("DirectBankPayment.htm?cgNumber="+cgn1+"&showMode="+mode,"","height=650,width=900,scrollbars=yes,left=20,top=20,status=yes");
		cWindows[count++]=cWind;
		break;
	case 'DCP' :
		if(mode=="view")
		mode="viewCash";
		if(mode=="modify")
		mode="reverseCash";
		//window.location="DirectCashPayment.htm?cgNumber="+cgn1+"&showMode="+mode;
		cWind=window.open("DirectCashPayment.htm?cgNumber="+cgn1+"&showMode="+mode,"","height=650,width=900,scrollbars=yes,left=20,top=20,status=yes");
		cWindows[count++]=cWind;
		break;

	}
}

</SCRIPT>
</head>
<body bgcolor="#ffffff" bottommargin="0" topmargin="0" rightmargin="0" leftmargin="0" marginheight="0" marginwidth="0" onLoad="onloadTasks()" onbeforeunload="closeChilds(cWindows,count)"><!------------------ Header Begins Begins--------------------->
<form name="journalVoucher">
<input type="hidden" name="startFinDate" id="startFinDate">
	<table width="100%" border=0 cellpadding="3" cellspacing="0">
		<tr >
			<td class="rowheader" valign="center" colspan="4" width="100%"><span class="headerwhite2">
       Payments - Search</span></td>
		</tr>
		<tr name="type1" id="type1" class="row1" >
			<td width="25%"><div align="right" valign="center" class="normaltext" name="paymentLabel" id="paymentLabel">Payment Type<span class="leadon">*</span></div></td>
			<td width="25%">
				<!--select class="fieldinput" name="paymentType" id="paymentType" onChange="ModeChange()" exilListSource="paymentType" exilMustEnter="true"-->
				<select class="fieldinput" name="paymentType" id="paymentType" onChange="ModeChange()" exilMustEnter="true"  tabindex="1">
				<option value=""
        selected></option>
        			<option value="Bank Payment"> Bank</option>
        			<option value="Cash Payment"> Cash</option>
					<option value="Advance"> Advance</option>
					<option value="Subledger Payment">Subledger Payment</option>
					<option value="Salary"> Salary</option>
					<option value="Bank Entry">Bank Entry</option>


				</select>
			</td>

			<td width="25%" >&nbsp;</td>
			<td width="25%">&nbsp;
			</td>
		</tr>

		<tr class="row2">
			<td ><div align="right" valign="center" class="normaltext">Voucher Number</div></td>
			<td>
				<input class="fieldinput" name="voucherNumber" id="voucherNumber" exilDataType="exilAnyChar"  tabindex="2">
			</td>

			<td ><div align="right" valign="center" class="normaltext"> Fund&nbsp; </div></td>
			<td >
				<SELECT CLASS="fieldinput" NAME="fund" ID="fund" exilListSource="fundNameList" tabindex="3" > </SELECT>
			</td>
		</tr>

		<tr class="row1">
			<td ><div align="right" valign="center" class="normaltext">Voucher Date From</div></td>
			<td >
				<input class="datefieldinput"  name="voucherDateFrom"  id="voucherDateFrom" onkeyup="DateFormat(this,this.value,event,false,'3')"  exilCalendar="true" tabindex="4">
			</td>

			<td ><div align="right" valign="center" class="normaltext">To</div></td>
			<td>
				<input class="datefieldinput" name="voucherDateTo"  id="voucherDateTo" onkeyup="DateFormat(this,this.value,event,false,'3')"  exilCalendar="true" tabindex="5">
			</td>
		</tr>
		<tr class="row2">
			<td colspan="4" align="middle"><!-- Buttons Start Here -->
				<table border="0" cellpadding="0" cellspacing="0">
					<tr>
						<td align="right">
							<IMG height=18 src="/egi/resources/erp2/images/Button_leftside.gif" width=7></td>
						<td bgcolor="#fe0000" valign="center" nowrap><A class=buttonprimary onclick=ButtonPress() href="#" tabindex="6">Search</A></td>
						<td>
							<IMG height=18 src="/egi/resources/erp2/images/Button_rightside.gif" width=7></td>
					</tr>
				</table>
			</td>
		</tr>
	</table>

	<table width="100%" border="1" cellpadding="0" cellspacing="0" name="paymentSearchGrid" id="paymentSearchGrid" style="DISPLAY: none">
		<tr class="rowheader">
			<td width="5%" class="columnheader"><div align="center" class="columnheader">Sl No</div></td>
			<td width="10%" class="columnheader"><div align="center">CG Number</div></td>
			<td width="20%" class="columnheader"><div align="center">Voucher Date</div></td>
			<td width="15%" class="columnheader"><div align="center">Voucher Number</div></td>
			<td width="15%" class="columnheader"><div align="center">PaidTo</div></td>
			<td width="10%" class="columnheader"><div align="center">PassedAmt</div></td>
			<td width="10%" class="columnheader"><div align="center">BillAmt</div></td>
			<td width="15%" class="columnheader"><div align="center" id="cheNo">ChequeNo</div></td>
			<td width="15%" class="columnheader"><div align="center">Paid Amount</div></td>
			<td width="20%" class="columnheader"><div align="center">Status</div></td>
		</tr>

		<tr class="normaltext">
			<td><div id="slNo" name="slNo" exilTrimLength="8">&nbsp;</div></td>
			<td><div id="cgNumber" name="cgNumber" exilTrimLength="10">&nbsp;</div></td>
			<td><div id="voucherDate" name="voucherDate" >&nbsp;</div></td>
			<td><A onclick=getDetails(this) href="#"><div id="voucherNumber" name="voucherNumber" exilTrimLength="15">&nbsp;</div></A></td>
			<td><div id="paidTo" name="paidTo" exilTrimLength="20">&nbsp;</div></td>
			<td align=right><div id="passedAmount" name="passedAmount" exilTrimLength="16">&nbsp;</div></td>
			<td align=right style="BORDER-RIGHT-WIDTH: thick"><div id="billAmount" name="billAmount" exilTrimLength="16">&nbsp;</div></td>
			<td><div id="chequeNumber" name="chequeNumber" exilTrimLength="10">&nbsp;</div></td>
			<td><div id="paidAmount" name="paidAmount" exilTrimLength="16">&nbsp;</div></td>
			<td><div id="status" name="status"  exilTrimLength="13">&nbsp;</div></td>
		</tr>
	</table>
</form>
</body>
</html>
