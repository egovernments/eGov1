#-------------------------------------------------------------------------------
# eGov suite of products aim to improve the internal efficiency,transparency, 
#      accountability and the service delivery of the government  organizations.
#   
#       Copyright (C) <2015>  eGovernments Foundation
#   
#       The updated version of eGov suite of products as by eGovernments Foundation 
#       is available at http://www.egovernments.org
#   
#       This program is free software: you can redistribute it and/or modify
#       it under the terms of the GNU General Public License as published by
#       the Free Software Foundation, either version 3 of the License, or
#       any later version.
#   
#       This program is distributed in the hope that it will be useful,
#       but WITHOUT ANY WARRANTY; without even the implied warranty of
#       MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#       GNU General Public License for more details.
#   
#       You should have received a copy of the GNU General Public License
#       along with this program. If not, see http://www.gnu.org/licenses/ or 
#       http://www.gnu.org/licenses/gpl.html .
#   
#       In addition to the terms of the GPL license to be adhered to in using this
#       program, the following additional terms are to be complied with:
#   
#   	1) All versions of this program, verbatim or modified must carry this 
#   	   Legal Notice.
#   
#   	2) Any misrepresentation of the origin of the material is prohibited. It 
#   	   is required that all modified versions of this material be marked in 
#   	   reasonable ways as different from the original version.
#   
#   	3) This license does not grant any rights to any user of the program 
#   	   with regards to rights under trademark law for use of the trade names 
#   	   or trademarks of eGovernments Foundation.
#   
#     In case of any queries, you can reach eGovernments Foundation at contact@egovernments.org.
#-------------------------------------------------------------------------------
<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>

<SCRIPT LANGUAGE="javascript">
var financialYear_ID,flag='false',flag1;
var financialYear,detlTypeId,fin_year;
var flag = '0';
function selectData(){
		var detailTypeId=document.getElementById('detailTypeId').value;
		document.getElementById('isUsedInPosting').value='';
			var control= document.getElementById('financialYear_financialYear');
			var c=control.options[control.selectedIndex].value;
			PageManager.DataService.setQueryField('financialYear_ID',c);

		PageManager.DataService.callDataService('financialYearData');
	//	PageManager.DataService.setQueryField('detlTypeId',detailTypeId);
	//	PageManager.DataService.setQueryField('detlKeyId',c);
	//	PageManager.DataService.callDataService('checkForModification');
}
function getData(){
		 fin_year=PageManager.DataService.getQueryField('fin_year');
		if(fin_year){
			flag = '1';
			PageManager.DataService.setQueryField('fin_year',fin_year);
			PageManager.DataService.setQueryField('financialYear_ID',fin_year);
			PageManager.DataService.callDataService('getFinancialYrData');
			//selectData();
		}
		document.getElementById('financialYear_financialYear').focus();
		PageManager.ListService.callListService();
		//PageManager.DataService.callDataService('fy_detailData');
		//window.listRefresh=false;

		/*if(!window.listRefresh){
			window.listRefresh=true;
			selectList();
		}	*/
}

function selectList(){
		var a = PageManager.DataService.getQueryField('financialYear_ID');
		//alert('wait till loads');
		if(a != null || typeof(a)!='undefined'){
			var con = document.getElementById('financialYear_financialYear');
				for(var i=0;i<con.length;i++){
					if(con.options[i].text.toLowerCase() == a.toLowerCase()){
						con.options[i].selected=true;
						break;
					}
				}
			selectData();
		}
	}
/*function formatDate(dateText){
	var months = ["NA","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

	dateText=dateText.substring(0,10);
	var dateArray= dateText.split('-');
	var newDate=dateArray[2]+"-"+ months[parseInt(dateArray[1], 10)] +"-"+dateArray[0];
	return newDate;
}*/
function afterRefreshPage(dc){
		if(dc.values['serviceID']=='getFinancialYrData'){
			selectData();
		}
		if(flag == '1'){
			flag = '0';
			//alert(document.getElementById('fID').value);
			PageManager.DataService.setQueryField('financialYear_financialYear', document.getElementById('fID').value);
			PageManager.DataService.setQueryField('financialYear_ID', document.getElementById('fID').value);
			PageManager.DataService.callDataService('financialYearData');
		}
		var post=dc.values['posting'];
		if(post==1)
		  document.getElementById('fy_isActiveForPosting').innerHTML='Yes';
		else
		  document.getElementById('fy_isActiveForPosting').innerHTML='No';
		var financialYear_startingDate=dc.values['financialYear_startingDate'];
		if(!financialYear_startingDate)	return false;

		financialYear_startingDate=formatDate(financialYear_startingDate);
		document.getElementById('financialYear_startingDate').innerHTML=financialYear_startingDate;

		var financialYear_endingDate=dc.values['financialYear_endingDate'];
		if(!financialYear_endingDate)	return false;

		financialYear_endingDate=formatDate(financialYear_endingDate);
		document.getElementById('financialYear_endingDate').innerHTML=financialYear_endingDate;

		PageManager.DataService.removeQueryField('financialYear_financialYear');

	}

function beforeRefreshPage(dc){
		var tabObj=dc.grids['fiscalPeriodGrid'];
		if(!tabObj)	return true;
		for(var i=1;i<tabObj.length;i++){
			tabObj[i][1]=formatDate(tabObj[i][1]);
			tabObj[i][2]=formatDate(tabObj[i][2]);
		}
		return true;
}
function onClickNew(){
	window.location="FinancialYearAdd.htm?showMode=new";
}

function onClickModify(){

		var posting=document.getElementById('posting').value;
		var isclosed=document.getElementById('isclosed').value;
		if(posting==0 && isclosed==1) {
			alert('Closed Financial Year cannot be re-opened');
			return false;
			}
		var typeId=document.getElementById('isUsedInPosting').value;
		if(typeId != '')
			alert('Cannot Modify');
		else
			window.location="FinancialYearAdd.htm?showMode=edit&financialYear_ID="+document.getElementById('financialYear_financialYear').value;

}
</SCRIPT>
</head>
<body bgcolor="#ffffff" bottommargin="0" topmargin="0" rightmargin="0" leftmargin="0" marginheight="0" marginwidth="0" onLoad="getData();" onKeyDown ="CloseWindow(event);" style="text-align: right"><!------------------ Header Begins Begins--------------------->
<form name="financialYear">
<input type="hidden" name="fID" id="fID">
<input type="hidden" name="detailTypeId" id="detailTypeId">
<input  type="hidden" name="isUsedInPosting" id="isUsedInPosting">
<input  type="hidden" name="posting" id="posting">
<input  type="hidden" name="isclosed" id="isclosed">

	<table   width="100%" border=0 cellpadding="3" cellspacing="0">

		<tr >
					<td class="normalText" width="160" ></td>
					<td align="center" valign="center"  width="117"><div align="right" class="labelcell">Financial Year<span class="leadon">*</span></div>
					</td>
					<td align="center" valign="center" class="labelcell" width="153">
                    <div align="left" class="smallfieldcell">
                          <SELECT id="financialYear_financialYear"  name="financialYear_financialYear" class="fieldinput" exilListSource="financialYearList" onChange="selectData();"  exilMustEnter="true" >
                                  </SELECT></div>
					</td>
					<td align="right" valign="center" class="labelcell" width="454"></td>
					<td align="right" valign="center" class="labelcell" width="2"></td>
				</tr>
		<tr >
			<td width="160" ><div align="right" valign="center" class="labelcell">Starting Date</div></td>
			<td width="117" >
				<span class="displayData" name="financialYear_startingDate"  id="financialYear_startingDate" exilDataType="exilAnyDate"  0onclick="getDate();" size="20">
			</td>

			<td width="153" ><div align="right" valign="center" class="labelcell">Ending Date</div></td>
			<td width="454">
				<span align="left" class="displayData" name="financialYear_endingDate"  id="financialYear_endingDate" exilDataType="exilAnyDate" size="20">
			</td>
		</tr>

		<tr >
			<td width="120" ><div align="right" valign="center" class="labelcell">Open For Posting</div></td>
			<td width="180" >
				<!--<input class="datefieldinput" name="financialYear_startingDate"  id="financialYear_startingDate" exilDataType="exilAnyDate" exilCalendar="true" exilMustEnter="true" onclick="getStartDate();" size="20">-->
				<span   name="fy_isActiveForPosting"  id="fy_isActiveForPosting" class="displayData"></span>
			</td>
			<td></td>
			<td></td>
		</tr>

		   <tr >
				<td height="25" colspan="4" valign="bottom" class="smalltext" width="902"><p class="smalltext"></p>
				</td>
			</tr>

</table>

	<table width="636" border="1" cellpadding="0" cellspacing="0" name="fiscalPeriodGrid" id="fiscalPeriodGrid" height="37" align="center">
		<tr class="thStlyle">
			<td width="194"  height="13"><div align="center" >Fiscal Period Name</div></td>
			<td width="216"  height="13"><div align="center">Starting Date</div></td>
			<td width="218"  height="13"><div align="center">Ending Date</div></td>
		</tr>

		<tr class="labelcell">
			<td width="194" height="20">
            <div id="fiscalPeriod_name" name="fiscalPeriod_name" size="30" exilDataType="exilAnyChar"></div></td>
			<td width="216" height="20">
			<div  name="fiscalPeriod_startingDate" id="fiscalPeriod_startingDate" maxlength="11" size="30" readOnly></div></td>
			<td width="218" height="20"><div name="fiscalPeriod_endingDate" id="fiscalPeriod_endingDate" maxlength="11" size="30" ></div></td>
		</tr>
	        </table>
	        <table>
			<tr >
				<td height="25" colspan="4" valign="bottom" class="smalltext" width="884"><p class="smalltext"><span class="leadon">*</span>
						- Mandatory Fields</p>
				</td>
			</tr>

			<tr >
				<td colspan="4" align="middle"><!-- Buttons Start Here -->
					<table border="0" cellpadding="0" cellspacing="0" align="center">
						<tr>
							<td colspan=11> &nbsp;</td>
						</tr>
			<tr >
							<td colspan="4" align="middle" width="100%"><!-- Buttons Start Here -->
								<table align="center" border="0" cellpadding="0" cellspacing="0">
					 				<tr>
					 						<td width=100% align=center>
						 						<input type="button"  id="revsave" value="Modify" class="button" onclick="onClickModify();"/>
						 						<input type="button" id="revclose" value="New" class="button" onclick="onClickNew();" />
						 						<input type="button" id="revclose" value="Close" class="button" onclick="window.close();" />
					 						</td>

									</tr>
								</table>
					</td>
				</tr>

	</table>
</form>

</body>
</html>
