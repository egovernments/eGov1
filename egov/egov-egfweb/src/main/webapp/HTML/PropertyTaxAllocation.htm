#-------------------------------------------------------------------------------
# eGov suite of products aim to improve the internal efficiency,transparency, 
#      accountability and the service delivery of the government  organizations.
#   
#       Copyright (C) <2015>  eGovernments Foundation
#   
#       The updated version of eGov suite of products as by eGovernments Foundation 
#       is available at http://www.egovernments.org
#   
#       This program is free software: you can redistribute it and/or modify
#       it under the terms of the GNU General Public License as published by
#       the Free Software Foundation, either version 3 of the License, or
#       any later version.
#   
#       This program is distributed in the hope that it will be useful,
#       but WITHOUT ANY WARRANTY; without even the implied warranty of
#       MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#       GNU General Public License for more details.
#   
#       You should have received a copy of the GNU General Public License
#       along with this program. If not, see http://www.gnu.org/licenses/ or 
#       http://www.gnu.org/licenses/gpl.html .
#   
#       In addition to the terms of the GPL license to be adhered to in using this
#       program, the following additional terms are to be complied with:
#   
#   	1) All versions of this program, verbatim or modified must carry this 
#   	   Legal Notice.
#   
#   	2) Any misrepresentation of the origin of the material is prohibited. It 
#   	   is required that all modified versions of this material be marked in 
#   	   reasonable ways as different from the original version.
#   
#   	3) This license does not grant any rights to any user of the program 
#   	   with regards to rights under trademark law for use of the trade names 
#   	   or trademarks of eGovernments Foundation.
#   
#     In case of any queries, you can reach eGovernments Foundation at contact@egovernments.org.
#-------------------------------------------------------------------------------
<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
		<meta http-equiv="KEYWORDS" content="">
		<meta http-equiv="DESCRIPTION" content="">
		<!-- Inclusion of the CSS files that contains the styles -->
		<link rel=stylesheet href="../exility/global.css" type="text/css">
			<SCRIPT LANGUAGE="javascript" SRC="../exility/PageValidator.js"></SCRIPT>
			<script LANGUAGE="javascript" src="../script/jsCommonMethods.js"></script>
			<SCRIPT LANGUAGE="javascript" SRC="../exility/CookieManager.js"></Script>
			<SCRIPT LANGUAGE="javascript" SRC="../exility/PageManager.js"></SCRIPT>
			<SCRIPT LANGUAGE="javascript" SRC="../exility/ExilityParameters.js"></SCRIPT>
			<SCRIPT LANGUAGE="javascript" SRC="../script/predefinedAccCodes.js"></Script>

<script>
var pageMode="modify";
var fiscalPeriod;
function getData(){
		var fyText=PageManager.DataService.getQueryField('fyText');
		if(fyText){
		submitData();
		}
		PageManager.DataService.addNewRow('cessTable');
		document.getElementById('propertyTaxCess_fiscalPeriod').focus();
		PageManager.ListService.callListService();

}

function beforeRefreshPage(dc){
	 var count1 =dc.grids['cessTable'];
	 var tot=0;
	 if(count1){
	 for(var i=1;i<dc.grids['cessTable'].length;i++){
	 tot+=parseFloat(count1[i][2]);

	 }
	 document.getElementById('total').value = tot;
	}
 }

function afterRefreshPage(dc){
		PageManager.DataService.removeQueryField('propertyTaxCess_fiscalPeriod');
		PageManager.DataService.removeQueryField('fyText');
		var table = dc.grids['cessTable'];
		var count=1;
		if(table!=null)
			count = dc.grids['cessTable'].length;

		if(count==1){
			pageMode="add";
			document.getElementById('submitButton').innerHTML="Allocate";
			PageManager.DataService.addNewRow('cessTable');
		}

		if(count>1){
		pageMode="modify";
		document.getElementById('submitButton').innerHTML="Reallocate";

		//PageManager.DataService.removeQueryField('propertyTaxCess_fiscalPeriod');
	}
}

function submitData(){
		var fyText=PageManager.DataService.getQueryField('fyText');
		//if(control.selectedIndex==-1) return;
		if(fyText){
		var c=fyText;
		}else{
		var control= document.getElementById('propertyTaxCess_fiscalPeriod');
		var c=control.options[control.selectedIndex].text;
		}
		PageManager.DataService.setQueryField('fiscalPeriod',c);
		PageManager.DataService.callDataService('propertyTaxData');
}
function submitForm()
{
		//   ***1 only FO***,  ***2 FO***,  ***Admin, 3 All***    //
		if(!isValidUser(2, CookieManager.getCookie('userRole')) ) return false;

		document.getElementById('egUser_id').value = CookieManager.getCookie('currentUserId');

		var control= document.getElementById('propertyTaxCess_fiscalPeriod');
		if(!control.value){
		alert('You must select Financial Year');
		}
		else{
		fiscalPeriod=control.options[control.selectedIndex].text;
		window.location="PropertyTaxAllocationAdd.htm?propertyTaxCess_fiscalPeriod="+fiscalPeriod;
		}
}

function calculateTotal(name){
 		var a = document.getElementsByName(name);
 		count = 0;
 		for(var i = 0; i<=a.length-1;i++) if(a[i].value) count += parseFloat(a[i].value);
		document.getElementById('total').value = count;
 		}
 		function onClickCancel()
		{
			window.location="PropertyTaxAllocation.htm";
		}
   </script>

	</head>
	<body bgcolor="#ffffff" bottommargin="0" topmargin="0" rightmargin="0" leftmargin="0" marginheight="0" marginwidth="0" onLoad="getData();" onKeyDown ="CloseWindow(event);"><!------------------ Header Begins Begins--------------------->
		<form name="propertyTaxAllocation" method="post" >
		<input type="hidden" name="egUser_id" id="egUser_id">

	<table width="100%" height="74%" border="0" cellpadding="0" cellspacing="0">
			</table>
			<table width="100%" border="0" cellpadding="0" cellspacing="0" height="152">
				<tr>
					<td valign="top" class="normaltext" height="115"><!------------Content begins here ------------------>
						<table width="100%" border="0" cellpadding="3" cellspacing="0">
							<TBODY>
								<tr>
									<td class="rowheader" valign="center" colspan="4" width="894">
                                    <span class="headerwhite2">Property Tax Allocation</span></td>
								</tr>
								<tr class="row2">
					 </td>
				</tr>
				<tr class="row1">
					<td align="right" valign="center" class="normaltext" width="822"><div align="right">Financial Year<span class="leadon">*</span></div>
					</td>
					<td align="right" valign="center" class="normaltext" width="822">
                    <div align="left">
                                  <SELECT id="propertyTaxCess_fiscalPeriod"  name="propertyTaxCess_fiscalPeriod" class="fieldinput" onChange="submitData();" exilListSource="selectFinancialYear" exilMustEnter="true" >

                                  </SELECT></div>
					</td>

				</tr>
			</table>


				<table width="100%" border="0" cellpadding="0" cellspacing="0" ID="Table1">
				<tr>
					<td height="43">
						<table width="300" border="1" cellpadding="0" cellspacing="0" name="cessTable" id="cessTable" align="center" height="67">
							<tr class="rowheader">
								<td width="47" class="columnheader" height="15">
                                <div align="center" class="columnheader" style="width: 195; height: 15" >A/C Head</div> </td>
								<td width="179" class="columnheader" height="15"><div align="center" class="columnheader" >Percentage</div>
								</td>
							</tr>

							<tr class="normaltext">


					                <td width="159" height="20">
					                <input type="hidden" size="4" name="propertyTaxCess_ID" id="propertyTaxCess_ID">
									<input type="hidden" name="creditGlCodeId" id="creditGlCodeId">
					                <input type="hidden" name="debitGlCodeId" id="debitGlCodeId">
					                <input type="hidden" name="receivablesGlCodeId" id="receivablesGlCodeId">
                                <div class=fieldinput id=propertyTaxCess_accountHead  readOnly maxLength=50 align=center size=50 name=propertyTaxCess_accountHead exilDataType="exilAnyChar"></div>
                			     </td>
								<td class="columnheader" width="179" height="20">
		                           <div class=fieldinput-right id="propertyTaxCess_percentage" name="propertyTaxCess_percentage" size=18 onBlur="calculateTotal(this.name);" onKeyDown ="addNewRow('cessTable','propertyTaxCess_glCode');"
		                             exilDataType="exilUnsignedDecimal" exilMax="999999.99" exilMin="0"></div>
                				</td>
						      </tr>


   				</table>
					<tr><td height="26">
					<table width="343" border="1" cellpadding="0" cellspacing="0" ID="totTable" align="center" height="1">
					<tr class="row2">
								<td class="normaltext" align="right" colspan="2" width="411" height="1">Total</td>
								<td class="columnheader" width="139" height="1">
                                  <INPUT class=fieldinput-right id="total" name="total" disabled  exilDataType="exilUnsignedDecimal" exilMax="999999.99"  exilMin="0" size="20" > </td>
					</tr>
					</table></td>
					</tr>
					</td>
				</tr>
			</table></TD></TR><!--  Buttons for Request Form starts here -->
			<tr class="row2">
				<td colspan="4" align="middle" height="37"><!-- Buttons Start Here -->
					<table border="0" cellpadding="0" cellspacing="0" align="center">
						<tr>
							<td colspan=11> &nbsp;</td>
						</tr>
						<tr>
							<td align="right">
                            <IMG height=18 src="/egi/resources/erp2/images/Button_leftside.gif" width=7></td>
							<td bgcolor="#fe0000" valign="center" nowrap><A class=buttonprimary id=submitButton onclick=submitForm();  href="#" >Reallocate</A></td>
							<td>
                            <IMG height=18 src="/egi/resources/erp2/images/Button_rightside.gif" width=7></td>
							<td><IMG src="/egi/resources/erp2/images/spacer.gif" width=16></td>
							<td align="right">
                            <IMG height=18 src="/egi/resources/erp2/images/Button_second_leftside.gif" width=6></td>
							<td bgcolor="#ffffff" valign="center" nowrap background="/egi/resources/erp2/images/Button_second_middle.gif"><A class=buttonsecondary onclick="onClickCancel()" href="" >Cancel</A></td>
							<td>
                            <IMG height=18 src="/egi/resources/erp2/images/Button_second_rightside.gif" width=6></td>
							<td><IMG src="/egi/resources/erp2/images/spacer.gif" width=16></td>
							<td align="right">
                            <IMG height=18 src="/egi/resources/erp2/images/Button_second_leftside.gif" width=6></td>
							<td bgcolor="#ffffff" valign="center" nowrap background="/egi/resources/erp2/images/Button_second_middle.gif"><A class=buttonsecondary href="Home.htm">Close</A></td>
							<td>
                            <IMG height=18 src="/egi/resources/erp2/images/Button_second_rightside.gif" width=6></td>
                            <td><IMG src="/egi/resources/erp2/images/spacer.gif" width=16></td>
							<td align="right"></td>

						</tr>
					</table>
				</td>
			</tr></TBODY></TABLE><!------------ Content ends here ------------------></TD></TR></TABLE></TD><!------------Right Navigation Ends here------------------></TR></TABLE><!---------------- Footer begins here ----------><!---------------- Footer ends here ---------->
		</form>
	</table>
	</body>
</html>
